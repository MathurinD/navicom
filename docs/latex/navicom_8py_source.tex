\hypertarget{navicom_8py_source}{
\subsection{navicom/navicom.py}
}

\begin{DoxyCode}
00001 \textcolor{comment}{################################################################################}
00002 \textcolor{comment}{# navicom.py}
00003 \textcolor{comment}{# By Mathurin Dorel}
00004 \textcolor{comment}{# Import data from a file and create analyzed sets to export to NaviCell}
00005 \textcolor{comment}{################################################################################}
00006 
00007 \textcolor{keyword}{from} curie.navicell \textcolor{keyword}{import} *
00008 \textcolor{keyword}{from} .navidata \textcolor{keyword}{import} *
00009 \textcolor{keyword}{from} .displayConfig \textcolor{keyword}{import} *
00010 
00011 DEBUG\_NAVICOM = \textcolor{keyword}{True}
00012 VERBOSE\_NAVICOM = \textcolor{keyword}{True}
00013 
00014 \textcolor{keyword}{def }getLine(ll, split\_char="\(\backslash\)t"):
00015     ll = re.sub(\textcolor{stringliteral}{'\(\backslash\)"'}, \textcolor{stringliteral}{''}, ll.strip())
00016     ll = re.sub(\textcolor{stringliteral}{'\(\backslash\)tNA'}, \textcolor{stringliteral}{'\(\backslash\)tNaN'}, ll) \textcolor{comment}{# Python float can convert "NaN" -> nan but 
      not "NA" -> nan}
00017     ll = ll.split(split\_char)
00018     \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(ll)):
00019         \textcolor{keywordflow}{try}:
00020             ll[ii] = float(ll[ii])
00021         \textcolor{keywordflow}{except}:
00022             \textcolor{keywordflow}{pass}
00023     \textcolor{keywordflow}{return}(ll)
00024 
00025 \textcolor{keyword}{class }NaviCom():
00026     \textcolor{stringliteral}{"""}
00027 \textcolor{stringliteral}{    NaviComm class to handle data and display them in a standardized way on NaviC
      ell maps}
\hypertarget{navicom_8py_source_l00028}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom}{00028} \textcolor{stringliteral}{    """}
00029 
00030     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ae6133fe7ec63cf5643c1794f4f8e2349}{__init__}(self, map\_url='https://navicell.curie.fr/navicell/maps/cellcycle
      /master/index.php\textcolor{stringliteral}{', fname="", modules\_dict="", browser\_command="firefox %s", disp
      lay\_config=DisplayConfig()):}
00031 \textcolor{stringliteral}{        }\textcolor{stringliteral}{"""}
00032 \textcolor{stringliteral}{        Initialize a Navicell communication object.}
00033 \textcolor{stringliteral}{        Args:}
00034 \textcolor{stringliteral}{            map\_url (str): URL of the NaviCell map}
00035 \textcolor{stringliteral}{            fname (str): name of the data file to load}
00036 \textcolor{stringliteral}{            modules\_dict (str): name of the module definition file (.gmt) to load
      }
00037 \textcolor{stringliteral}{            browser\_command (str): command to open the browser}
\hypertarget{navicom_8py_source_l00038}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ae6133fe7ec63cf5643c1794f4f8e2349}{00038} \textcolor{stringliteral}{        """}
00039         \textcolor{comment}{# Build options for the navicell connexion}
00040         options = Options()
00041         options.map\_url = map\_url
00042         idx = options.map\_url.find(\textcolor{stringliteral}{'/navicell/'})
00043         options.proxy\_url = options.map\_url[0:idx] + \textcolor{stringliteral}{'/cgi-bin/nv\_proxy.php'}
00044         options.browser\_command = browser\_command \textcolor{comment}{# TODO Add user control}
00045         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv} = NaviCell(options)
00046         \textcolor{comment}{## Name of the dataset}
\hypertarget{navicom_8py_source_l00047}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{00047}         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} = \textcolor{stringliteral}{"no\_name"} 
00048         \textcolor{comment}{# NaviCell export control}
00049         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a3f78f9d3f194b32b14f1cfa154a26082}{_exported_annotations} = \textcolor{keyword}{False}
00050         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6f40767575f6ae749bd9275d462f1af2}{_browser_opened} = \textcolor{keyword}{False}
00051         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a53870501f47d416a35c6c743d3d222d2}{_biotypes} = dict()
00052         \textcolor{comment}{# Representation of the data}
00053         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config} = display\_config
00054         \textcolor{comment}{# Data, indexed by processing then type of data}
00055         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings} = PROCESSINGS
00056         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data} = dict() \textcolor{comment}{# All data}
00057         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data} = dict() \textcolor{comment}{# Whether data have been exported yet}
00058         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names} = dict() \textcolor{comment}{# Name of the exported data}
00059         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data} = dict() \textcolor{comment}{# Processing and method associated to each
       name}
00060         \textcolor{keywordflow}{for} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}:
00061             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing] = dict()
00062             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[processing] = dict()
00063             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing] = dict()
00064         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[\textcolor{stringliteral}{"uniform"}] = \textcolor{keyword}{False}
00065         \textcolor{comment}{## Annotations of the samples}
\hypertarget{navicom_8py_source_l00066}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{00066}         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations} = dict()
00067         \textcolor{comment}{## Composition of the modules}
\hypertarget{navicom_8py_source_l00068}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{00068}         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules} = dict()
00069         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules} = dict() \textcolor{comment}{# Number of modules each gene belong to
      }
00070         \textcolor{keywordflow}{if} (fname != \textcolor{stringliteral}{""}):
00071             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a10e8b8a4c06b4ecf09366ca6b69efff6}{loadData}(fname)
00072             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6411b52971f15bd11270942cb98eaa1a}{defineModules}(modules\_dict)
00073         \textcolor{comment}{# Remember how many samples and datatables were selected in NaviCell in t
      he heatmap and barplot editors}
00074         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abf768fde5caf68a79e19385b48ea0bcc}{_hsid} = 0
00075         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a095a4a928f1f09319fafc949f8580f78}{_hdid} = 0
00076         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a496d13fc4c8b73cef4f496b713d12b79}{_bid} = 0
00077 
00078     \textcolor{keyword}{def }listData(self):
00079         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Data available :"})
00080         \textcolor{keywordflow}{for} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}:
00081             \textcolor{keywordflow}{for} dname \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]:
00082                 \textcolor{keywordflow}{if} (dname.lower() \textcolor{keywordflow}{in} METHODS\_TYPE):
00083                     \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"\(\backslash\)t"} + processing + \textcolor{stringliteral}{" "} + dname + \textcolor{stringliteral}{": "} + METHODS\_TYPE[d
      name.lower()] + \textcolor{stringliteral}{" (biotype: "} + TYPES\_BIOTYPE[METHODS\_TYPE[dname.lower()]] + \textcolor{stringliteral}{")"})
      
00084                 \textcolor{keywordflow}{else}:
00085                     \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"\(\backslash\)t"} + processing + \textcolor{stringliteral}{" "} + dname)
00086 
00087     \textcolor{keyword}{def }listAnnotations(self):
00088         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Annotations available (values) :"})
00089         \textcolor{keywordflow}{for} annot \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.annotations:
00090             \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"\(\backslash\)t"} + annot + \textcolor{stringliteral}{" : "} + str(set(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}[annot])))
00091 
00092     \textcolor{keyword}{def }\_\_repr\_\_(self):
00093         rpr = \textcolor{stringliteral}{"NaviCom object with "} + str(len(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data})) + \textcolor{stringliteral}{" types of data:\(\backslash\)n"
      }
00094         \textcolor{keywordflow}{for} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}:
00095             rpr += method + \textcolor{stringliteral}{": "} + self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[method] + \textcolor{stringliteral}{"\(\backslash\)n"}
00096         rpr += \textcolor{stringliteral}{"and "} + str(len(self.moduleAverage)) + \textcolor{stringliteral}{" modules average:\(\backslash\)n"}
00097         \textcolor{keywordflow}{for} method \textcolor{keywordflow}{in} self.moduleAverage:
00098             rpr += method + \textcolor{stringliteral}{": "} + self.moduleAverage[method] + \textcolor{stringliteral}{"\(\backslash\)n"}
00099         \textcolor{keywordflow}{return}(repr)
00100     
00101     \textcolor{keyword}{def }\_nameData(self, method, processing="raw", name=""):
00102         \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{""}):
00103             name = method + \textcolor{stringliteral}{"\_"} + processing
00104         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing][method] = name
00105         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}[name] = (processing, method)
00106         \textcolor{keywordflow}{return} (name)
00107 
00108     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a51ecb41beebc7636bde73be2e1ffc407}{getDataName}(self, data\_name):
00109         \textcolor{stringliteral}{"""}
00110 \textcolor{stringliteral}{        Return the string identifier corresponding to the data name or tuple}
00111 \textcolor{stringliteral}{}
00112 \textcolor{stringliteral}{        Args:}
00113 \textcolor{stringliteral}{            data\_name (str or tuple): Identifier of the data}
\hypertarget{navicom_8py_source_l00114}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a51ecb41beebc7636bde73be2e1ffc407}{00114} \textcolor{stringliteral}{        """}
00115         dTuple = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad8ac5b74afb4ceb6ed094604787d4d19}{getDataTuple}(data\_name)
00116         \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[dTuple[0]][dTuple[1]])
00117 
00118     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad8ac5b74afb4ceb6ed094604787d4d19}{getDataTuple}(self, data\_name):
00119         \textcolor{stringliteral}{"""}
00120 \textcolor{stringliteral}{        Return tuple corresponding to the data name or tuple}
\hypertarget{navicom_8py_source_l00121}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad8ac5b74afb4ceb6ed094604787d4d19}{00121} \textcolor{stringliteral}{        """}
00122         \textcolor{keywordflow}{if} (isinstance(data\_name, str)):
00123             \textcolor{keywordflow}{if} (data\_name \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}):
00124                 \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}[data\_name])
00125             \textcolor{keywordflow}{elif} (data\_name + \textcolor{stringliteral}{"\_raw"} \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}):
00126                 \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}[data\_name + \textcolor{stringliteral}{"\_raw"}])
00127         \textcolor{keywordflow}{elif} (isinstance(data\_name, tuple) \textcolor{keywordflow}{and} len(data\_name) == 2):
00128             \textcolor{keywordflow}{if} (data\_name[0] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}):
00129                 \textcolor{keywordflow}{return}(data\_name)
00130             \textcolor{keywordflow}{elif} (data\_name[1] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}):
00131                 \textcolor{keywordflow}{return}((data\_name[1],data\_name[0]))
00132         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Invalid name or tuple for data: "} + str(data\_name))
00133 
00134     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad675e899836271ff4f2fd4bd17ea81d9}{getData}(self, data\_name):
00135         \textcolor{stringliteral}{"""}
00136 \textcolor{stringliteral}{        Return the NaviData entity corresponding to the data name or tuple}
00137 \textcolor{stringliteral}{}
00138 \textcolor{stringliteral}{        Args:}
00139 \textcolor{stringliteral}{            data\_name (str or tuple): Identifier of the data}
\hypertarget{navicom_8py_source_l00140}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad675e899836271ff4f2fd4bd17ea81d9}{00140} \textcolor{stringliteral}{        """}
00141         dTuple = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad8ac5b74afb4ceb6ed094604787d4d19}{getDataTuple}(data\_name)
00142         \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[dTuple[0]][dTuple[1]])
00143 
00144     \textcolor{comment}{# Load new data}
00145     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a10e8b8a4c06b4ecf09366ca6b69efff6}{loadData}(self, fname="data/Ovarian\_Serous\_Cystadenocarcinoma\_TCGA\_Nature\_
      2011.txt", keep\_mutations\_nan=False):
00146         \textcolor{stringliteral}{"""}
00147 \textcolor{stringliteral}{        Load data from a .txt or .ncc file containing several datas, or from a .t
      sv, .ncd or .nca file containing data from one method.}
00148 \textcolor{stringliteral}{}
00149 \textcolor{stringliteral}{        Args:}
00150 \textcolor{stringliteral}{            fname (str): name of the file from which the data should be loaded}
00151 \textcolor{stringliteral}{            keep\_mutations\_nan(str): whether nan in mutations data should be cons
      idered as no mutation (False) or missing value (True)}
\hypertarget{navicom_8py_source_l00152}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a10e8b8a4c06b4ecf09366ca6b69efff6}{00152} \textcolor{stringliteral}{        """}
00153         with open(fname) \textcolor{keyword}{as} file\_conn:
00154             ff = file\_conn.readlines()
00155             ll = 0
00156         \textcolor{comment}{# Name the dataset according to the filename, and issue a warning if the 
      name changes}
00157         dname = parseFilename(fname)[0]
00158         \textcolor{keywordflow}{if} (dname != self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} \textcolor{keywordflow}{and} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} != \textcolor{stringliteral}{"no\_name"}):
00159             warn(\textcolor{stringliteral}{"Name of the dataset "} + self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} + \textcolor{stringliteral}{" has been changed to "} + d
      name)
00160         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} = dname
00161 
00162         dataRegex = \textcolor{stringliteral}{"^M |^GENE"}
00163         annotRegex = \textcolor{stringliteral}{"^ANNOTATIONS|^NAME"}
00164         completeRegex = dataRegex + \textcolor{stringliteral}{"|"} + annotRegex
00165         methodFromFile = \textcolor{keyword}{False}
00166         \textcolor{keywordflow}{while} (ll < len(ff)):
00167             \textcolor{keywordflow}{if} (re.search(dataRegex, ff[ll])):
00168                 \textcolor{comment}{# Import data}
00169                 \textcolor{comment}{# Use the method and processing names if they are provided, other
      wise deduce them from the filename }
00170                 \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"^M "}, ff[ll])):
00171                     line = re.sub(\textcolor{stringliteral}{"^M"}, \textcolor{stringliteral}{""}, ff[ll].strip()).split(\textcolor{stringliteral}{"\(\backslash\)t"})
00172                     method = line[0].strip()
00173                     \textcolor{keywordflow}{if} (len(line) > 1 \textcolor{keywordflow}{and} line[1] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}):
00174                         processing = line[1].strip()
00175                     \textcolor{keywordflow}{else}:
00176                         processing = \textcolor{stringliteral}{"raw"}
00177                     samples = getLine(ff[ll+1])
00178                     \textcolor{keywordflow}{if} (samples[0] == \textcolor{stringliteral}{"GENE"}):
00179                         samples = samples[1:]
00180                     ll += 2
00181                 \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"^GENE"}, ff[ll])):
00182                     fname = os.path.split(fname)[1]
00183                     dname, processing, method = parseFilename(fname)
00184                     \textcolor{comment}{# Deduction cannot be performed}
00185                     \textcolor{keywordflow}{if} (methodFromFile):
00186                         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"A type of data must be provided when im
      porting several data in one file"})
00187                     \textcolor{keywordflow}{else}:
00188                         methodFromFile = \textcolor{keyword}{True}
00189                     samples = getLine(ff[ll])[1:]
00190                     ll += 1
00191                 \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Importing "} + method + \textcolor{stringliteral}{" data"})
00192                 profile\_data = dict()
00193                 profile\_data[\textcolor{stringliteral}{"samples"}] = oDict()
00194                 profile\_data[\textcolor{stringliteral}{"genes"}] = dict()
00195                 profile\_data[\textcolor{stringliteral}{"data"}] = list()
00196                 ii = 0
00197                 \textcolor{keywordflow}{for} el \textcolor{keywordflow}{in} samples:
00198                     profile\_data[\textcolor{stringliteral}{"samples"}][el] = ii
00199                     ii += 1
00200 
00201                 gid = 0
00202                 \textcolor{keywordflow}{while}(ll < len(ff) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} re.search(completeRegex, ff[ll])):
00203                     dl = getLine(ff[ll])
00204                     profile\_data[\textcolor{stringliteral}{"data"}].append(dl[1:]) \textcolor{comment}{# Data in a list at index
       gene\_name}
00205                     profile\_data[\textcolor{stringliteral}{"genes"}][dl[0]] = gid
00206                     gid += 1
00207 
00208                     ll += 1
00209                 \textcolor{keywordflow}{if} (processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data} \textcolor{keywordflow}{and} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]
      ):
00210                     warn(\textcolor{stringliteral}{"Overwriting data for method "} + method + \textcolor{stringliteral}{" with process
      ing "} + processing)
00211                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method] = NaviData(profile\_data[\textcolor{stringliteral}{"data"}], p
      rofile\_data[\textcolor{stringliteral}{"genes"}], profile\_data[\textcolor{stringliteral}{"samples"}], processing, method)
00212                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[processing][method] = \textcolor{keyword}{False}
00213                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5314c49d6b9749693519a4a86cbfde71}{quantifyMutations}(method)
00214                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a140128d0fd12930347cc2375c154072d}{_nameData}(method, processing)
00215                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} \textcolor{stringliteral}{"uniform"} \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}):
00216                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a4d9f00c3c5de8b0f2e938d7019450ffe}{_defineUniformData}(profile\_data[\textcolor{stringliteral}{"samples"}], profile\_data
      [\textcolor{stringliteral}{"genes"}])
00217             \textcolor{keywordflow}{elif} (re.search(annotRegex, ff[ll])):
00218                 \textcolor{comment}{# Import annotations}
00219                 \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Importing Annotations"})
00220                 \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"^ANNOTATIONS"}, ff[ll])):
00221                     annotations\_names = getLine(ff[ll+1])
00222                     \textcolor{keywordflow}{if} (annotations\_names[0] == \textcolor{stringliteral}{"NAME"}):
00223                         annotations\_names = annotations\_names[1:]
00224                     ll += 2
00225                 \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"^NAME"}, ff[ll])):
00226                     annotations\_names = getLine(ff[ll][1:])
00227                     ll += 1
00228                 annot = dict()
00229                 annot[\textcolor{stringliteral}{"names"}] = list()
00230                 annot[\textcolor{stringliteral}{"samples"}] = list()
00231                 annot[\textcolor{stringliteral}{"annot"}] = list()
00232                 not\_all = \textcolor{keywordflow}{not} \textcolor{stringliteral}{"all"} \textcolor{keywordflow}{in} annotations\_names
00233                 \textcolor{keywordflow}{if} (not\_all):
00234                     annot[\textcolor{stringliteral}{"names"}].append(\textcolor{stringliteral}{"all"})
00235                     annot[\textcolor{stringliteral}{"annot"}].append([1 \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(nb\_samples)])
00236                 \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} annotations\_names:
00237                     annot[\textcolor{stringliteral}{"names"}].append(name)
00238                 \textcolor{keywordflow}{while}(ll < len(ff) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} re.search(completeRegex, ff[ll])):
00239                     al = getLine(ff[ll])
00240                     \textcolor{comment}{# Gather each annotation for this sample and add all as the f
      irst column if necessary}
00241                     \textcolor{keywordflow}{if} (not\_all):
00242                         annot[\textcolor{stringliteral}{"annot"}].append([1] + al[1:])
00243                     \textcolor{keywordflow}{else}:
00244                         annot[\textcolor{stringliteral}{"annot"}].append(al[1:])
00245                     annot[\textcolor{stringliteral}{"samples"}].append(al[0])
00246 
00247                     ll = ll+1
00248                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations} = NaviAnnotations(annot[\textcolor{stringliteral}{"annot"}], annot[\textcolor{stringliteral}{"samples
      "}], annot[\textcolor{stringliteral}{"names"}], dType=\textcolor{stringliteral}{"annotations"})
00249             \textcolor{keywordflow}{else}:
00250                 \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Incorrect format, file must be a valid file for
       NaviCell or an aggregation of such files with headers to indicate the type of da
      ta"})
00251 
00252     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ae310adb1d4e8932f0b72b6d8b6ca6301}{bindNaviData}(self, navidata, method, processing):
00253         \textcolor{stringliteral}{"""}
00254 \textcolor{stringliteral}{        Bind a NaviData datatable to the NaviCom object in order to use it }
00255 \textcolor{stringliteral}{}
00256 \textcolor{stringliteral}{        Args:}
00257 \textcolor{stringliteral}{            navidata (NaviData): the NaviData datatable to bind}
00258 \textcolor{stringliteral}{            method (str): the method used to get the data}
00259 \textcolor{stringliteral}{            processing (str): the visualisation related processing applied to the
       data}
\hypertarget{navicom_8py_source_l00260}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ae310adb1d4e8932f0b72b6d8b6ca6301}{00260} \textcolor{stringliteral}{        """}
00261         \textcolor{keyword}{assert} isinstance(navidata, NaviData), \textcolor{stringliteral}{"navidata is not a NaviData object
      "}
00262         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_acf8b9094fa76cafefb910daeb68b7e5d}{_newProcessedData}(processing, method, navidata)
00263 
00264     \textcolor{keyword}{def }\_defineUniformData(self, samples, genes):
00265         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"uniform"}] = NaviData( np.array([[1] * len(samples) \textcolor{keywordflow}{for} nn \textcolor{keywordflow}{in} 
      genes]), genes, samples )
00266         \textcolor{comment}{# TODO change to 1.0 when < is changed to <= for continuous data}
00267 
00268     \textcolor{keyword}{def }\_newProcessedData(self, processing, method, data):
00269         \textcolor{stringliteral}{"""}
00270 \textcolor{stringliteral}{        Update adequate arrays when processed data are generated}
00271 \textcolor{stringliteral}{        """}
00272         \textcolor{keyword}{assert} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}, \textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{" is
       not handled"}
00273         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method] = data
00274         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[processing][method] = \textcolor{keyword}{False}
00275         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a140128d0fd12930347cc2375c154072d}{_nameData}(method, processing)
00276 
00277     \textcolor{comment}{# Process data}
00278     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5314c49d6b9749693519a4a86cbfde71}{quantifyMutations}(self, method, keep\_nan=False):
00279         \textcolor{stringliteral}{"""}
00280 \textcolor{stringliteral}{        Transform the qualitative mutation datas into a quantitative one, where 1
       means a mutation and 0 no mutation.}
00281 \textcolor{stringliteral}{        Args:}
00282 \textcolor{stringliteral}{            keep\_nan : Should nan values be converted to O (no mutations) or kept
       as missing data}
00283 \textcolor{stringliteral}{        """}
00284         \textcolor{keywordflow}{if} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}] \textcolor{keywordflow}{and} METHODS\_TYPE[method.lower()] == \textcolor{stringliteral}{"muta
      tions"}):
\hypertarget{navicom_8py_source_l00285}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5314c49d6b9749693519a4a86cbfde71}{00285}             mutations = NaviData(np.zeros(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method].data.shape), 
      self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method].rows\_names, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method].columns\_names, me
      thod)
00286             \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(len(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method].rows\_names)):
00287                 \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(len(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method].columns\_names)):
00288                     value = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method][rr][cc]
00289                     \textcolor{keywordflow}{if} ( re.match(\textcolor{stringliteral}{"nan|na"}, value.lower()) ):
00290                         \textcolor{keywordflow}{if} (keep\_nan):
00291                             mutations.data[rr][cc] = np.nan
00292                         \textcolor{keywordflow}{else}:
00293                             mutations.data[rr][cc] = 0
00294                     \textcolor{keywordflow}{elif} ( value == \textcolor{stringliteral}{""} ):
00295                         mutations.data[rr][cc] = 0
00296                     \textcolor{keywordflow}{else}:
00297                         mutations.data[rr][cc] = 1
00298             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_acf8b9094fa76cafefb910daeb68b7e5d}{_newProcessedData}(\textcolor{stringliteral}{"mutationQuantification"}, method, mutations)
00299 
00300     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6411b52971f15bd11270942cb98eaa1a}{defineModules}(self, modules\_dict=""):
00301         \textcolor{stringliteral}{"""}
00302 \textcolor{stringliteral}{        Defines the modules to use and which module each gene belongs to.}
00303 \textcolor{stringliteral}{}
00304 \textcolor{stringliteral}{        Args:}
00305 \textcolor{stringliteral}{            modules\_dict : Either a dict indexed by module name or a file name wi
      th the description of each module (.gmt file: tab delimited, first column module 
      name, second column description, then list of entities in the module)}
00306 \textcolor{stringliteral}{        """}
00307         \textcolor{comment}{# Gather the composition of each module}
\hypertarget{navicom_8py_source_l00308}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6411b52971f15bd11270942cb98eaa1a}{00308}         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules} = dict()
00309         \textcolor{keywordflow}{if} (isinstance(modules\_dict, dict)):
00310             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules} = modules\_dict 
00311         \textcolor{keywordflow}{elif} (isinstance(modules\_dict, str)):
00312             \textcolor{keywordflow}{if} (modules\_dict != \textcolor{stringliteral}{""}):
00313                 with open(modules\_dict) \textcolor{keyword}{as} ff:
00314                     \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} ff.readlines():
00315                         ll = line.strip().split(\textcolor{stringliteral}{"\(\backslash\)t"})
00316                         module\_name = ll[0]
00317                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}[module\_name] = ll[2:]
00318 
00319         \textcolor{comment}{# TODO add control that the genes in the modules have data}
00320         \textcolor{stringliteral}{"""}
00321 \textcolor{stringliteral}{        # Only keep genes with data}
00322 \textcolor{stringliteral}{        for module in self.modules:}
00323 \textcolor{stringliteral}{            keep = list()}
00324 \textcolor{stringliteral}{            for gene in self.modules[module]:}
00325 \textcolor{stringliteral}{                if (not gene in self.genes\_list):}
00326 \textcolor{stringliteral}{                    self.modules[module].remove(gene)}
00327 \textcolor{stringliteral}{        """}
00328         \textcolor{comment}{# Count the number of modules each gene belong to}
00329         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules} = dict()
00330         \textcolor{keywordflow}{for} module\_name \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}.keys():
00331             \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}[module\_name]:
00332                 \textcolor{keywordflow}{try}:
00333                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules}[gene].append(module\_name)
00334                 \textcolor{keywordflow}{except} KeyError:
00335                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules}[gene] = [module\_name]
00336 
00337     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afd1a299b687bc97e171cff0a738b7b73}{averageModule}(self, method):
00338         \textcolor{stringliteral}{"""}
00339 \textcolor{stringliteral}{        Perform module averaging for every modules for one data type}
00340 \textcolor{stringliteral}{        """}
00341         \textcolor{keyword}{assert} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}], \textcolor{stringliteral}{"This type of data is not present"}
\hypertarget{navicom_8py_source_l00342}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afd1a299b687bc97e171cff0a738b7b73}{00342}         \textcolor{keyword}{assert} len(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules})>0, \textcolor{stringliteral}{"No module have been defined"}
00343 
00344         \textcolor{comment}{# Calculate average expression for each module}
00345         data = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method]
00346         samples = list(data.samples.keys())
00347         module\_expression = dict()
00348         \textcolor{keywordflow}{for} module \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}:
00349             module\_expression[module] = [0 \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} samples]
00350             non\_nan = np.array([0 \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} samples])
00351             no\_data = list()
00352             \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}[module]:
00353                 \textcolor{keywordflow}{try}:
00354                     not\_nan = np.array([int(\textcolor{keywordflow}{not} np.isnan(dd)) \textcolor{keywordflow}{for} dd \textcolor{keywordflow}{in} data[gene
      ].data])
00355                     non\_nan += not\_nan
00356                     non\_nan\_data = data[gene].data * not\_nan
00357                     non\_nan\_data[np.isnan(non\_nan\_data)] = 0
00358                     module\_expression[module] += non\_nan\_data
00359                 \textcolor{keywordflow}{except} IndexError:
00360                     no\_data += [gene]
00361             \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} no\_data:
00362                 \textcolor{comment}{#self.modules[module].remove(gene)}
00363                 \textcolor{keywordflow}{if} (VERBOSE\_NAVICOM):
00364                     \textcolor{keywordflow}{print}(gene + \textcolor{stringliteral}{" from module "} + module + \textcolor{stringliteral}{" has no "} + method +
       \textcolor{stringliteral}{" data"})
00365             module\_expression[module] /= non\_nan
00366 
00367         \textcolor{comment}{# Calculate average module expression for each gene}
00368         gene\_module\_average = list()
00369         \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} data.genes:
00370             \textcolor{keywordflow}{if} gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules}:
00371                 gene\_module\_average.append(np.array([0. \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} data.sample
      s]))
00372                 \textcolor{keywordflow}{for} module \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules}[gene]:
00373                     gene\_module\_average[-1] += module\_expression[module] / len(se
      lf.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules}[gene])
00374             \textcolor{keywordflow}{else}:
00375                 gene\_module\_average.append(np.array(list(data[gene])))
00376                 \textcolor{keywordflow}{print}(gene)
00377 
00378         \textcolor{comment}{# Put the averaging in a NaviData structure}
00379         \textcolor{comment}{#self.\_data["moduleAverage"][method] = NaviData(list(module\_expression.va
      lues()), list(self.modules.keys()), samples) # Usefull if NaviCell allow modules 
      values one day}
00380         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_acf8b9094fa76cafefb910daeb68b7e5d}{_newProcessedData}(\textcolor{stringliteral}{"moduleAverage"}, method, NaviData(gene\_module\_aver
      age, list(data.genes), samples))
00381 
00382     \textcolor{keyword}{def }\_pcaComp(self, method, colors=["red", "green", "blue"]):
00383         \textcolor{stringliteral}{"""}
00384 \textcolor{stringliteral}{        Run pca on the data and create a color matrix with the 3 principal compon
      ents in the three main colors}
00385 \textcolor{stringliteral}{        """}
00386         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Not implemented yet"})
00387 
00388     \textcolor{comment}{# Export data and annotations}
00389     \textcolor{keyword}{def }\_exportData(self, method, processing="raw", name=""):
00390         \textcolor{stringliteral}{"""}
00391 \textcolor{stringliteral}{        Export data to NaviCell, can be processed data}
00392 \textcolor{stringliteral}{}
00393 \textcolor{stringliteral}{        Args:}
00394 \textcolor{stringliteral}{            method (str) : name of the method to export}
00395 \textcolor{stringliteral}{            processing (str) : "" to export raw data, processing method to export
       processed data. See 'averageModule' and '\_pcaComponent'}
00396 \textcolor{stringliteral}{        """}
00397         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab468a31a5f439bcae23f4c75b8c67f65}{_checkBrowser}() \textcolor{comment}{# TODO Perform processing if necessary}
00398         done\_export = \textcolor{keyword}{False}
00399 
00400         \textcolor{keywordflow}{if} (processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}):
00401             \textcolor{keywordflow}{if} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]):
00402                 \textcolor{keywordflow}{if}(method.lower() \textcolor{keywordflow}{in} METHODS\_TYPE):
00403                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[processing][method]):
00404                         name = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a140128d0fd12930347cc2375c154072d}{_nameData}(method, processing, name)
00405                         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Exporting "} + name + \textcolor{stringliteral}{" to NaviCell..."})
00406                         \textcolor{comment}{# Processing change the type of data, like discrete data 
      into continuous, or anything to color data}
00407                         biotype = getBiotype(method, processing)
00408                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.importDatatables(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].
      \_makeData(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.getHugoList()), name, biotype)
00409                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5bde750c01abc8e64338fb148c59b435}{_configureDisplay}(method, processing)
00410                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[processing][method] = \textcolor{keyword}{True}
00411                         done\_export = \textcolor{keyword}{True}
00412                 \textcolor{keywordflow}{elif} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{'distribution'}]):
00413                     \textcolor{keywordflow}{pass} \textcolor{comment}{# Avoid bug}
00414                 \textcolor{keywordflow}{else}:
00415                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Biotype of '"} + method + \textcolor{stringliteral}{"' is unknown"})
00416             \textcolor{keywordflow}{elif} (method == \textcolor{stringliteral}{"uniform"}): \textcolor{comment}{# Uniform data for glyphs}
00417                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[\textcolor{stringliteral}{"uniform"}]):
00418                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.importDatatables(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"uniform"}].\_makeData(sel
      f.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.getHugoList()), \textcolor{stringliteral}{"uniform"}, \textcolor{stringliteral}{"Discrete Copy number data"}) \textcolor{comment}{# Continuous is bet
      ter for grouping but posses problems with glyphs}
00419                     name = \textcolor{stringliteral}{"uniform"}
00420                     \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Exporting "} + name + \textcolor{stringliteral}{" to NaviCell..."})
00421                     done\_export = \textcolor{keyword}{True}
00422                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[\textcolor{stringliteral}{"uniform"}] = \textcolor{keyword}{True}
00423             \textcolor{keywordflow}{elif} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"distribution"}]):
00424                 \textcolor{keywordflow}{pass} \textcolor{comment}{# Exported on creation, to change for multiple NaviCell}
00425             \textcolor{keywordflow}{else}:
00426                 \textcolor{keywordflow}{raise} KeyError(\textcolor{stringliteral}{"Method '"} + method + \textcolor{stringliteral}{"' with processing '"} + proc
      essing + \textcolor{stringliteral}{"' does not exist"})
00427         \textcolor{keywordflow}{else}:
00428             \textcolor{keywordflow}{raise} KeyError(\textcolor{stringliteral}{"Processing '"} + processing + \textcolor{stringliteral}{"' does not exist"})
00429 
00430         \textcolor{comment}{# Uniform data have been defined when other datas have, but do not recqui
      re explicit export}
00431         \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[\textcolor{stringliteral}{"uniform"}]):
00432             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb8ef6988c65589c35ad11dcb8681787}{_exportData}(\textcolor{stringliteral}{"uniform"})
00433 
00434     \textcolor{keyword}{def }\_checkBrowser(self):
00435         \textcolor{stringliteral}{"""}
00436 \textcolor{stringliteral}{        Check if the browser is opened or open it}
00437 \textcolor{stringliteral}{        """}
00438         \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6f40767575f6ae749bd9275d462f1af2}{_browser_opened}):
00439             \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Launching browser..."})
00440             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.launchBrowser()
00441             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6f40767575f6ae749bd9275d462f1af2}{_browser_opened} = \textcolor{keyword}{True}
00442         \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6f40767575f6ae749bd9275d462f1af2}{_browser_opened})
00443 
00444     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a59edead26b5d02f17a60df055576f5}{exportAnnotations}(self):
00445         \textcolor{stringliteral}{"""}
00446 \textcolor{stringliteral}{        Export samples annotations to NaviCell}
00447 \textcolor{stringliteral}{        """}
00448         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab468a31a5f439bcae23f4c75b8c67f65}{_checkBrowser}()
00449 
00450         \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a3f78f9d3f194b32b14f1cfa154a26082}{_exported_annotations}):
00451             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.sampleAnnotationImport(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.\_makeData())
00452             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a3f78f9d3f194b32b14f1cfa154a26082}{_exported_annotations} = \textcolor{keyword}{True}
00453 
00454     \textcolor{keyword}{def }\_configureDisplay(self, method, processing="raw"):
\hypertarget{navicom_8py_source_l00455}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a59edead26b5d02f17a60df055576f5}{00455}         \textcolor{stringliteral}{"""}
00456 \textcolor{stringliteral}{        Changes the Color and Size Configuration for the datatable to the one pre
      cised by the user.}
00457 \textcolor{stringliteral}{        """}
00458         \textcolor{keywordflow}{if} (getBiotype(method, processing) \textcolor{keywordflow}{in} CONTINOUS\_BIOTYPES):
00459             \textcolor{comment}{## Color configuration}
00460             dname = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a51ecb41beebc7636bde73be2e1ffc407}{getDataName}((method, processing))
00461             \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Configuring display for "} + dname)
00462             step\_count = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.step\_count
00463             \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS]:
00464                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetStepCount(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG\_C
      OLOR, tab, step\_count-1) \textcolor{comment}{# NaviCell has one default step}
00465 
00466             dtable = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].data
00467             maxval = np.nanmax(dtable)
00468             minval = np.nanmin(dtable)
00469             \textcolor{comment}{# Use the same scales for positive and negative values, choose the sm
      allest to enhance contrast}
00470             \textcolor{keywordflow}{if} (minval * maxval < 0):
00471                 \textcolor{keywordflow}{if} (-minval > maxval):
00472                     minval = -maxval
00473                 \textcolor{keywordflow}{elif} (maxval > -minval):
00474                     maxval = -minval
00475             ftable = dtable.flatten()
00476             ftable.sort()
00477 
00478             \textcolor{keywordflow}{if} (len(ftable[np.isnan(ftable)]) > 0):
00479                 navicell\_offset = 1 \textcolor{comment}{# First value is nan}
00480                 \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS]:
00481                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG
      \_COLOR, tab, 0, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.na\_color)
00482             \textcolor{keywordflow}{else}:
00483                 navicell\_offset = 0
00484 
00485             \textcolor{keywordflow}{if} (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_zero\_color != \textcolor{stringliteral}{""}):
00486                 half\_count = step\_count//2
00487                 \textcolor{keywordflow}{if} (half\_count != 1):
00488                     \textcolor{comment}{# Negative values}
00489                     \textcolor{keywordflow}{if} (minval > 0): maxval = -1
00490                     step = -minval/half\_count
00491                     values\_list = [signif(val) \textcolor{keywordflow}{for} val \textcolor{keywordflow}{in} np.arange(minval, step/
      2, step)][:-1]
00492                     \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(half\_count):
00493                        value = values\_list[ii]
00494                        color = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_colors[ii]
00495                        \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GRO
      UPS]:
00496                            self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCell
      .CONFIG\_COLOR, tab, navicell\_offset + ii, value)
00497                            self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCell
      .CONFIG\_COLOR, tab, navicell\_offset + ii, color)
00498                     \textcolor{comment}{# Zero if present}
00499                     offset = half\_count
00500                     \textcolor{keywordflow}{if} (step\_count%2 == 1):
00501                         \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GR
      OUPS]:
00502                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCel
      l.CONFIG\_COLOR, tab, offset + navicell\_offset, 0)
00503                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCel
      l.CONFIG\_COLOR, tab, offset + navicell\_offset, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_colors[half\_
      count])
00504                         offset += 1
00505                     \textcolor{comment}{# Positive values}
00506                     \textcolor{keywordflow}{if} (maxval < 0): maxval = 1
00507                     step = maxval/half\_count
00508                     values\_list = [signif(val) \textcolor{keywordflow}{for} val \textcolor{keywordflow}{in} np.arange(0., maxval+st
      ep/2, step)][1:]
00509                     \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(half\_count):
00510                         value = values\_list[ii]
00511                         color = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_colors[offset + ii]
00512                         \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GR
      OUPS]:
00513                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCel
      l.CONFIG\_COLOR, tab, navicell\_offset + offset + ii, value)
00514                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCel
      l.CONFIG\_COLOR, tab, navicell\_offset + offset + ii, color)
00515                 \textcolor{keywordflow}{else}:
00516                     \textcolor{keywordflow}{if} (step\_count == 2):
00517                         values\_list = [minval, maxval]
00518                     \textcolor{keywordflow}{else}:
00519                         values\_list = [minval, 0, maxval]
00520                     \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS
      ]:
00521                         \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(values\_list)):
00522                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCel
      l.CONFIG\_COLOR, tab, navicell\_offset + ii, values\_list[ii])
00523                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCel
      l.CONFIG\_COLOR, tab, navicell\_offset + ii, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_colors[ii])
00524             \textcolor{keywordflow}{else}:
00525                 \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(step\_count):
00526                     value = np.percentile(dtable, ii*100/(step\_count-1))
00527                     \textcolor{keywordflow}{if} (ii==0): value = minval
00528                     \textcolor{keywordflow}{elif} (ii==(step\_count-1)): value = maxval
00529                     color = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_colors[ii]
00530                     \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS
      ]:
00531                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCell.CO
      NFIG\_COLOR, tab, navicell\_offset + ii, value)
00532                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCell.CO
      NFIG\_COLOR, tab, navicell\_offset + ii, color)
00533 
00534             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetSampleMethod(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG\_CO
      LOR, NaviCell.METHOD\_CONTINUOUS\_MEDIAN) \textcolor{comment}{# TODO change to MEAN when group mean is 
      corrected to <= instead of <}
00535             \textcolor{keywordflow}{if} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.use\_absolute\_values:
00536                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetSampleAbsoluteValue(\textcolor{stringliteral}{""}, dname, NaviCel
      l.CONFIG\_COLOR, \textcolor{keyword}{True})
00537             \textcolor{keywordflow}{else}:
00538                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetSampleAbsoluteValue(\textcolor{stringliteral}{""}, dname, NaviCel
      l.CONFIG\_COLOR, \textcolor{keyword}{False})
00539 
00540             \textcolor{comment}{## Size configuration TODO add zero if present}
00541             \textcolor{keywordflow}{for} glyph\_id \textcolor{keywordflow}{in} range(1, MAX\_GLYPHS):
00542                 \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS]:
00543                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetSizeAt(\textcolor{stringliteral}{""}, dname, NaviCell.CONFIG\_
      SIZE, tab, 0, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.na\_size)
00544 
00545             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigApply(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG\_COLOR)
00546         
00547     \textcolor{comment}{# Display data}
00548     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}(self, perform\_list, default\_samples="all: 1.0\textcolor{stringliteral}{", colors="}\textcolor{stringliteral}{", module
      ='', reset=True):}
00549 \textcolor{stringliteral}{        }\textcolor{stringliteral}{"""}
00550 \textcolor{stringliteral}{        Display data on the NaviCell map}
00551 \textcolor{stringliteral}{        Args :}
00552 \textcolor{stringliteral}{            perform\_list (list of 2-tuples): each tuple must contain the name of 
      the data to display and the mode of display ("glyphN\_(color|size|shape)", "barplo
      t", "heatmap" or "map\_staining"). Barplots and heatmaps cannot be displayed simul
      taneously. Several data types can be specified for heatmaps. Specifying "glyph" (
      without number) will automatically select a new glyph for each data using the sam
      e properties (shape, color or size) in glyphs (maximum of 5 glyphs).}
00553 \textcolor{stringliteral}{            colors : range of colors to use (NOT IMPLEMENTED YET)}
00554 \textcolor{stringliteral}{            default\_samples (str or list of str) : Samples to use. Only the first
       sample is used for glyphs and map staining, all default\_samples from the list ar
      e used for heatmaps and barplots. Use 'all\_samples' to use all default\_samples or
       ['annot1:...:annotn', 'all\_groups'] to use all groups corresponding to the combi
      nations of annot1...annotn.}
00555 \textcolor{stringliteral}{        """}
00556         \textcolor{comment}{# Correct if the user give a single tuple}
00557         \textcolor{keywordflow}{if} (isinstance(perform\_list, tuple)):
00558             perform\_list = [perform\_list]
00559         \textcolor{keyword}{assert} isinstance(perform\_list, list), \textcolor{stringliteral}{"perform list must be a list"}
00560         \textcolor{keyword}{assert} isinstance(perform\_list[0], tuple) \textcolor{keywordflow}{and} (len(perform\_list[0]) == 2 
      \textcolor{keywordflow}{or} len(perform\_list[0]) == 3), \textcolor{stringliteral}{"perform list must be a list of (2/3)-tuples"}
00561         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab468a31a5f439bcae23f4c75b8c67f65}{_checkBrowser}()
00562         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a59edead26b5d02f17a60df055576f5}{exportAnnotations}()
00563         \textcolor{keywordflow}{if} (reset):
00564             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a379f15a87ba5c41c3501e9f386102c05}{resetDisplay}()
\hypertarget{navicom_8py_source_l00565}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{00565} 
00566         \textcolor{comment}{# Preprocess the perform list to get valid data\_name, and export data tha
      t have not been exported yet}
00567         \textcolor{keywordflow}{if} (DEBUG\_NAVICOM):
00568             \textcolor{keywordflow}{print}(perform\_list)
00569         \textcolor{keywordflow}{for} perf\_id \textcolor{keywordflow}{in} range(len(perform\_list)):
00570             data\_name = perform\_list[perf\_id][0]
00571             perform = perform\_list[perf\_id]
00572             \textcolor{keywordflow}{if} (isinstance(data\_name, str)):
00573                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} data\_name \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}):
00574                     data\_name = data\_name + \textcolor{stringliteral}{"\_raw"}
00575                 data\_name = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}[data\_name]
00576             processing = data\_name[0]
00577             method = data\_name[1]
00578             \textcolor{keyword}{assert} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}, \textcolor{stringliteral}{"Processing "} + processing + 
      \textcolor{stringliteral}{" does not exist"}
00579             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb8ef6988c65589c35ad11dcb8681787}{_exportData}(method, processing)
00580             \textcolor{keywordflow}{if} (len(perform) >= 3 \textcolor{keywordflow}{and} perform[2] != default\_samples):
00581                 perform\_list[perf\_id] = (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing][method], pe
      rform[1], perform[2])
00582             \textcolor{keywordflow}{else}:
00583                 perform\_list[perf\_id] = (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing][method], pe
      rform[1], \textcolor{stringliteral}{''})
00584         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb8ef6988c65589c35ad11dcb8681787}{_exportData}(\textcolor{stringliteral}{"uniform"})
00585 
00586         \textcolor{comment}{# Control that the user does not try to display to many data or use sever
      al times the same display}
00587         \textcolor{keywordflow}{if} (\textcolor{keyword}{True}):
00588             \textcolor{keywordflow}{for} gtype \textcolor{keywordflow}{in} GLYPH\_TYPES:
00589                 glyph = \{gtype:[\textcolor{keyword}{False}] * MAX\_GLYPHS\}
00590             sample\_for\_glyph = [\textcolor{keyword}{False}] * MAX\_GLYPHS
00591             glyph\_samples = [\textcolor{stringliteral}{""}] * MAX\_GLYPHS
00592             glyph\_set = \textcolor{keyword}{False}
00593             heatmap = \textcolor{keyword}{False}
00594             barplot = \textcolor{keyword}{False}
00595             barplot\_data = \textcolor{stringliteral}{""}
00596             map\_staining = \textcolor{keyword}{False}
00597             default\_samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2acd087f6c61dc8c7e1bc5a3391ff982}{_processSampleSelection}(default\_samples)
00598             samples = default\_samples
00599             lastWasDefault = \textcolor{keyword}{True}
00600             valid\_default = (len(default\_samples) == 1 \textcolor{keywordflow}{and} default\_samples != \textcolor{stringliteral}{"al
      l\_groups"} \textcolor{keywordflow}{and} default\_samples != \textcolor{stringliteral}{"all\_samples"})
00601         \textcolor{comment}{# Perform the display depending of the selected mode}
00602         \textcolor{keywordflow}{for} perform \textcolor{keywordflow}{in} perform\_list:
00603             all\_samples = \textcolor{keyword}{False}
00604             all\_groups = \textcolor{keyword}{False}
00605             data\_name = perform[0]
00606             dmode = perform[1]
00607             dmode = dmode.lower()
00608             \textcolor{comment}{# Check groups in NaviCell and get a valid list of samples, reload de
      fault if not the last used}
00609             \textcolor{keywordflow}{if} (perform[2] == \textcolor{stringliteral}{''}):
00610                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} lastWasDefault):
00611                     samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2acd087f6c61dc8c7e1bc5a3391ff982}{_processSampleSelection}(default\_samples)
00612                     lastWasDefault = \textcolor{keyword}{True}
00613             \textcolor{keywordflow}{else}:
00614                 samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2acd087f6c61dc8c7e1bc5a3391ff982}{_processSampleSelection}(perform[2])
00615                 lastWasDefault = \textcolor{keyword}{False}
00616             \textcolor{keywordflow}{if} (samples == \textcolor{stringliteral}{"all\_groups"}):
00617                 all\_groups = \textcolor{keyword}{True}
00618             \textcolor{keywordflow}{elif} (samples == \textcolor{stringliteral}{"all\_samples"}):
00619                 all\_samples = \textcolor{keyword}{True}
00620 
00621             \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"^(glyph|color|size|shape)"}, dmode)):
00622                 glyph\_set = \textcolor{keyword}{True}
00623                 \textcolor{comment}{# Extract the glyph id and the setup}
00624                 parse\_setup = dmode.split(\textcolor{stringliteral}{"\_"})
00625                 glyph\_setup = parse\_setup
00626                 \textcolor{keywordflow}{if} (len(parse\_setup) == 2):
00627                     \textcolor{keywordflow}{try}:
00628                         glyph\_setup = [parse\_setup[1] + str(int(parse\_setup[0][-1
      ]))]
00629                     \textcolor{keywordflow}{except} ValueError:
00630                         glyph\_setup = [parse\_setup[1]]
00631                 \textcolor{keywordflow}{elif} (len(parse\_setup) != 1):
00632                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Glyph specification '"} + dmode + \textcolor{stringliteral}{"' incorre
      ct"})
00633                 \textcolor{keywordflow}{try}:
00634                     glyph\_number = int(glyph\_setup[0][-1])
00635                     glyph\_type = glyph\_setup[0][:-1]
00636                 \textcolor{keywordflow}{except} ValueError:
00637                     glyph\_type = glyph\_setup[0]
00638                     glyph\_number = 1
00639                     \textcolor{keywordflow}{while} (glyph[glyph\_type][glyph\_number-1]):
00640                         glyph\_number += 1
00641                 glyph\_id = glyph\_number - 1
00642                 
00643                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph\_number \textcolor{keywordflow}{in} range(1, MAX\_GLYPHS+1)):
00644                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Glyph number must be in [1,"} + str(MAX\_GLYP
      HS) + \textcolor{stringliteral}{"]"})
00645                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph\_type \textcolor{keywordflow}{in} GLYPH\_TYPES):
00646                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Glyph type must be one of "} + str(GLYPH\_TYP
      ES))
00647                 \textcolor{keywordflow}{if} (glyph[glyph\_type][glyph\_number-1]):
00648                     \textcolor{keywordflow}{raise} ValueError(glyph\_type + \textcolor{stringliteral}{" for glyph "} + str(glyph\_numbe
      r) + \textcolor{stringliteral}{" has already been specified"})
00649                 glyph[glyph\_type][glyph\_number-1] = \textcolor{keyword}{True}
00650                 \textcolor{keywordflow}{if} (len(samples) != 1 \textcolor{keywordflow}{or} samples == \textcolor{stringliteral}{"all\_groups"} \textcolor{keywordflow}{or} samples == \textcolor{stringliteral}{"a
      ll\_samples"}):
00651                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Only one group or sample can be used for gl
      yphs"})
00652 
00653                 \textcolor{keywordflow}{if} (lastWasDefault):
00654                     \textcolor{keywordflow}{pass}
00655                 \textcolor{keywordflow}{elif} (glyph\_samples[glyph\_id] == \textcolor{stringliteral}{""}):
00656                     glyph\_samples[glyph\_id] = samples[0]
00657                     sample\_for\_glyph[glyph\_id] = \textcolor{keyword}{True}
00658                 \textcolor{keywordflow}{elif} (glyph\_samples[glyph\_id] != samples[0]):
00659                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Only one sample can be specified per glyph"
      })
00660 
00661                 cmd=\textcolor{stringliteral}{"self.\_nv.glyphEditorSelect"} + glyph\_type.capitalize() + \textcolor{stringliteral}{"Dat
      atable('"} + module +  \textcolor{stringliteral}{"', "} + str(glyph\_number) + \textcolor{stringliteral}{", '"} + data\_name + \textcolor{stringliteral}{"')"}
00662                 \textcolor{keywordflow}{if} (DEBUG\_NAVICOM):
00663                     \textcolor{keywordflow}{print}(cmd)
00664                 exec(cmd)
00665             \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"map\_?staining"}, dmode)):
00666                 \textcolor{keyword}{assert} valid\_default, \textcolor{stringliteral}{"Only one sample can be used for map staini
      ng"}
00667                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} map\_staining):
00668                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.mapStainingEditorSelectDatatable(module, data\_name)
00669                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.mapStainingEditorSelectSample(module, samples[0])
00670                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.mapStainingEditorApply(module)
00671                     map\_staining = \textcolor{keyword}{True}
00672                 \textcolor{keywordflow}{else}:
00673                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Map staining can only be applied once, use 
      a separate call to the display function to change map staining"})
00674             \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"heatmap"}, dmode)):
00675                 \textcolor{keywordflow}{if} (barplot):
00676                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Heatmaps and barplots cannot be applied sim
      ultaneously, use a separate call to the display function to perform the heatmap"})
      
00677                 heatmap = \textcolor{keyword}{True}
00678                 \textcolor{comment}{# Select data}
00679                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorSelectDatatable(module, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a095a4a928f1f09319fafc949f8580f78}{_hdid}, data\_na
      me)
00680                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a095a4a928f1f09319fafc949f8580f78}{_hdid} += 1
00681                 \textcolor{comment}{# Select samples}
00682                 \textcolor{keywordflow}{if} (all\_samples):
00683                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorAllSamples(module)
00684                 \textcolor{keywordflow}{elif} (all\_groups):
00685                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorAllGroups(module)
00686                 \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abf768fde5caf68a79e19385b48ea0bcc}{_hsid} == 0):
00687                     \textcolor{keywordflow}{for} spl \textcolor{keywordflow}{in} samples:
00688                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorSelectSample(module, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abf768fde5caf68a79e19385b48ea0bcc}{_hsid}, sp
      l)
00689                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abf768fde5caf68a79e19385b48ea0bcc}{_hsid} += 1
00690                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorApply(module)
00691             \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"barplot"}, dmode)):
00692                 \textcolor{keywordflow}{if} (heatmap):
00693                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Heatmaps and barplots cannot be applied sim
      ultaneously, use a separate call to the display function to perform the barplot"})
      
00694                 \textcolor{comment}{# Check that it does not try to add new data, and simply adds sam
      ples # TODO Remove as samples cannot be added (resetDisplay at the beginning)}
00695                 \textcolor{keywordflow}{if} (barplot \textcolor{keywordflow}{and} data\_name != barplot\_data \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} re.search(\textcolor{stringliteral}{"all|
      groups|samples"}, data\_name)):
00696                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Barplot has already been set with different
       data, use a separate call to the display function to perform another barplot"})
00697                 barplot = \textcolor{keyword}{True}
00698                 barplot\_data = data\_name
00699                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorSelectDatatable(module, data\_name)
00700                 \textcolor{comment}{# Select samples}
00701                 \textcolor{keywordflow}{if} (all\_samples):
00702                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorAllSamples(module)
00703                 \textcolor{keywordflow}{elif} (all\_groups):
00704                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorAllGroups(module)
00705                 \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a496d13fc4c8b73cef4f496b713d12b79}{_bid} == 0):
00706                     \textcolor{keywordflow}{for} spl \textcolor{keywordflow}{in} samples:
00707                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorSelectSample(module, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a496d13fc4c8b73cef4f496b713d12b79}{_bid}, spl
      )
00708                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a496d13fc4c8b73cef4f496b713d12b79}{_bid} += 1
00709                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorApply(module)
00710             \textcolor{keywordflow}{else}:
00711                 \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"'"} + dmode + \textcolor{stringliteral}{"' drawing mode does not exist"})
00712 
00713         \textcolor{comment}{# Check that datatables are selected for all glyphs features (until defau
      lt has been added)}
00714         \textcolor{comment}{# or complete, then apply the glyphs configuration}
00715         default\_samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2acd087f6c61dc8c7e1bc5a3391ff982}{_processSampleSelection}(default\_samples)
00716         \textcolor{keywordflow}{if} (glyph\_set):
00717             \textcolor{keywordflow}{for} glyph\_id \textcolor{keywordflow}{in} range(MAX\_GLYPHS):
00718                 nsets = sum(1 \textcolor{keywordflow}{for} cs \textcolor{keywordflow}{in} GLYPH\_TYPES \textcolor{keywordflow}{if} glyph[cs][glyph\_id])
00719                 \textcolor{keywordflow}{if} (nsets > 0):
00720                     \textcolor{keywordflow}{if} (sample\_for\_glyph[glyph\_id]):
00721                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorSelectSample(module, glyph\_id+1, self
      .\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2acd087f6c61dc8c7e1bc5a3391ff982}{_processSampleSelection}(glyph\_samples[glyph\_id]))
00722                     \textcolor{keywordflow}{elif} (valid\_default):
00723                         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Using default sample for glyph "} + str(glyph\_id+1)
      )
00724                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorSelectSample(module, glyph\_id+1, defa
      ult\_samples[0])
00725                     \textcolor{keywordflow}{else}:
00726                         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"No samples specified for glyph "} + str(
      glyph\_id+1) + \textcolor{stringliteral}{" and default\_samples is invalid"})
00727                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph[\textcolor{stringliteral}{"color"}][glyph\_id]):
00728                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorSelectColorDatatable(module, glyph\_id
      +1, \textcolor{stringliteral}{"uniform"})
00729                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph[\textcolor{stringliteral}{"shape"}][glyph\_id]):
00730                        self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorSelectShapeDatatable(module, glyph\_id+
      1, \textcolor{stringliteral}{"uniform"})
00731                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph[\textcolor{stringliteral}{"size"}][glyph\_id]):
00732                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorSelectSizeDatatable(module, glyph\_id+
      1, \textcolor{stringliteral}{"uniform"})
00733                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorApply(module, glyph\_id+1)
00734 
00735     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a379f15a87ba5c41c3501e9f386102c05}{resetDisplay}(self):
00736         \textcolor{stringliteral}{"""}
00737 \textcolor{stringliteral}{        Reset the data and samples selections in NaviCell}
00738 \textcolor{stringliteral}{        """}
00739         \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a496d13fc4c8b73cef4f496b713d12b79}{_bid}):
00740             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorSelectSample(\textcolor{stringliteral}{''}, ii, \textcolor{stringliteral}{''})
00741         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorSelectDatatable(\textcolor{stringliteral}{''}, \textcolor{stringliteral}{''})
00742         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.drawingConfigSelectBarplot(\textcolor{stringliteral}{''}, \textcolor{keyword}{False})
00743 
00744         \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abf768fde5caf68a79e19385b48ea0bcc}{_hsid}):
00745             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorSelectSample(\textcolor{stringliteral}{''}, ii, \textcolor{stringliteral}{''})
00746         \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a095a4a928f1f09319fafc949f8580f78}{_hdid}):
00747             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorSelectDatatable(\textcolor{stringliteral}{''}, ii, \textcolor{stringliteral}{''})
\hypertarget{navicom_8py_source_l00748}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a379f15a87ba5c41c3501e9f386102c05}{00748}         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.drawingConfigSelectHeatmap(\textcolor{stringliteral}{''}, \textcolor{keyword}{False})
00749 
00750         \textcolor{keywordflow}{for} gid \textcolor{keywordflow}{in} range(1, MAX\_GLYPHS):
00751             \textcolor{keywordflow}{for} gt \textcolor{keywordflow}{in} GLYPH\_TYPES:
00752                 exec(\textcolor{stringliteral}{"self.\_nv.glyphEditorSelect"} + gt.capitalize() + \textcolor{stringliteral}{"Datatable(
      '', "} + str(gid) + \textcolor{stringliteral}{", '')"})
00753             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorSelectSample(\textcolor{stringliteral}{''}, gid, \textcolor{stringliteral}{''})
00754             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.drawingConfigSelectGlyph(\textcolor{stringliteral}{''}, gid, \textcolor{keyword}{False})
00755         
00756         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.drawingConfigSelectMapStaining(\textcolor{stringliteral}{''}, \textcolor{keyword}{False})
00757         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.drawingConfigApply(\textcolor{stringliteral}{''})
00758 
00759         \textcolor{comment}{# Reset the counters}
00760         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a496d13fc4c8b73cef4f496b713d12b79}{_bid} = 0
00761         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abf768fde5caf68a79e19385b48ea0bcc}{_hsid} = 0
00762         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a095a4a928f1f09319fafc949f8580f78}{_hdid} = 0
00763 
00764     \textcolor{keyword}{def }\_resetAnnotationsSelection(self, module=''):
00765         \textcolor{keywordflow}{for} annot \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.annotations:
00766             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.sampleAnnotationSelectAnnotation(module, annot, \textcolor{keyword}{False})
00767         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.sampleAnnotationApply(module)
00768 
00769     \textcolor{keyword}{def }\_selectAnnotations(self, annotations, module=''):
00770         \textcolor{stringliteral}{"""}
00771 \textcolor{stringliteral}{        Select annotations on the NaviCell map}
00772 \textcolor{stringliteral}{        """}
00773         \textcolor{keywordflow}{if} (isinstance(annotations, str)):
00774             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.sampleAnnotationSelectAnnotation(module, annotations, \textcolor{keyword}{True})
00775         \textcolor{keywordflow}{elif} (isinstance(annotations, list)):
00776             \textcolor{keywordflow}{for} annot \textcolor{keywordflow}{in} annotations:
00777                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.sampleAnnotationSelectAnnotation(module, annot, \textcolor{keyword}{True})
00778         \textcolor{keywordflow}{else}:
00779             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"'annotations' must be a string or a list"})
00780         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.sampleAnnotationApply(module)
00781 
00782     \textcolor{keyword}{def }\_processSampleSelection(self, current\_samples):
00783         \textcolor{stringliteral}{"""}
00784 \textcolor{stringliteral}{        Process a list of samples or groups to a list of samples/groups names exp
      ortable to NaviCell or to "all\_groups"/"all\_samples" for heatmap and barplot, and
       select the correct groups in NaviCell}
00785 \textcolor{stringliteral}{        """}
00786 
00787         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a26866ef971b6bcb8b00ca742d47d0ea9}{_resetAnnotationsSelection}()
00788         \textcolor{comment}{# Make sure current\_samples is a list}
00789         all\_groups = \textcolor{keyword}{False}
00790         \textcolor{keywordflow}{if} (isinstance(current\_samples, str)):
00791             current\_samples = [current\_samples]
00792 
00793         \textcolor{comment}{# It is possible to select all samples or all groups on heatmap and barpl
      ot}
00794         \textcolor{keywordflow}{if} (current\_samples[0] == \textcolor{stringliteral}{"all\_samples"} \textcolor{keywordflow}{or} current\_samples[0] == \textcolor{stringliteral}{"samples
      "}):
00795             \textcolor{keywordflow}{return} \textcolor{stringliteral}{"all\_samples"}
00796         \textcolor{keywordflow}{elif} (current\_samples[0] == \textcolor{stringliteral}{"all"} \textcolor{keywordflow}{or} current\_samples[0] == \textcolor{stringliteral}{"all: 1.0"}):
00797             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a7e1aa831f14b151b7b5787c8b6128cef}{_selectAnnotations}(\textcolor{stringliteral}{"all"})
00798             \textcolor{keywordflow}{return} [\textcolor{stringliteral}{"all: 1.0"}]
00799         \textcolor{keywordflow}{elif} (len(current\_samples) > 1 \textcolor{keywordflow}{and} (current\_samples[1] == \textcolor{stringliteral}{"all\_groups"} \textcolor{keywordflow}{or
      } current\_samples[1] == \textcolor{stringliteral}{"groups"})):
00800             all\_groups = \textcolor{keyword}{True}
00801 
00802         refGroupsList = []
00803         first\_groups = \textcolor{keyword}{True}
00804         \textcolor{comment}{# Select the groups that must be selected to produce the composite groups
       required}
00805         \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} current\_samples:
00806             groups = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1b8f14be167905533ab7e18294dd9100}{_processGroupsName}(sample)[0]
00807             \textcolor{comment}{# Check that all groups are compatible in the annotations selected (b
      ecause lower order composition are not generated). No check for individual sample
      s}
00808             \textcolor{keywordflow}{if} (len(groups) >= 1):
00809                 \textcolor{keywordflow}{if} (first\_groups): \textcolor{comment}{# Select the set of annotations for the first 
      group}
00810                     \textcolor{keywordflow}{if} (DEBUG\_NAVICOM):
00811                         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Selecting "} + str(groups))
00812                     \textcolor{keywordflow}{for} group \textcolor{keywordflow}{in} groups:
00813                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a7e1aa831f14b151b7b5787c8b6128cef}{_selectAnnotations}(group) 
00814                         refGroupsList.append(group)
00815                         first\_groups = \textcolor{keyword}{False}
00816                 \textcolor{keywordflow}{else}: \textcolor{comment}{# Control that all other groups are compatible}
00817                         \textcolor{keyword}{assert} len(group)==0 \textcolor{keywordflow}{or} len(refGroupsList)==0 \textcolor{keywordflow}{or} len(grou
      p)==len(refGroupsList), \textcolor{stringliteral}{"Groups combinations are not compatible, different number
       of groups"}
00818                         \textcolor{keywordflow}{for} group \textcolor{keywordflow}{in} groups:
00819                             \textcolor{keyword}{assert} group \textcolor{keywordflow}{in} refGroupsList, \textcolor{stringliteral}{"Groups combinations a
      re not compatibles as "} + group + \textcolor{stringliteral}{" is not in "} + str(refGroupsList)
00820 
00821         \textcolor{keywordflow}{if} (all\_groups):
00822             \textcolor{keywordflow}{return} \textcolor{stringliteral}{"all\_groups"}
00823         \textcolor{keywordflow}{return} current\_samples
00824 
00825     \textcolor{keyword}{def }\_processGroupsName(self, groupName):
00826         \textcolor{stringliteral}{"""}
00827 \textcolor{stringliteral}{        Process a group selection string and return the names of the individual g
      roups to select and the corresponding values selected.}
00828 \textcolor{stringliteral}{        """}
00829         selections = groupName.split(\textcolor{stringliteral}{";"})
00830         groups = list()
00831         values = list()
00832         \textcolor{keywordflow}{for} select \textcolor{keywordflow}{in} selections:
00833             subName = select.split(\textcolor{stringliteral}{":"})
00834             group = subName[0].strip()
00835             \textcolor{keywordflow}{if} (group \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.annotations):
00836                 value = subName[1].strip()
00837                 groups.append(group)
00838                 \textcolor{keywordflow}{try}:
00839                     values.append(float(value))
00840                 \textcolor{keywordflow}{except} ValueError:
00841                     values.append(value)
00842             \textcolor{keywordflow}{elif} (\textcolor{keywordflow}{not} (group \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.samples \textcolor{keywordflow}{or} re.match(\textcolor{stringliteral}{"sub"}, group
      ) \textcolor{keywordflow}{or} group == \textcolor{stringliteral}{"NaN"})):
00843                 \textcolor{keywordflow}{if} (len(subName) > 1):
00844                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Annotation "} + group + \textcolor{stringliteral}{" does not exist"})
00845                 \textcolor{keywordflow}{else}:
00846                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Sample "} + group + \textcolor{stringliteral}{" does not exist"})
00847         \textcolor{keywordflow}{return}((groups, values))
00848 
00849     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a018f936de625af8a5dd7e8250ede6483}{displayMethylome}(self, samples="all: 1.0\textcolor{stringliteral}{", processing="}raw\textcolor{stringliteral}{", background="
      }mRNA\textcolor{stringliteral}{", methylation="}glyph\textcolor{stringliteral}{"):}
00850 \textcolor{stringliteral}{        }\textcolor{stringliteral}{"""}
00851 \textcolor{stringliteral}{            Display the methylation data as glyphs or heatmap on the NaviCell map
      , with mRNA expression of gene CNV as map staining}
00852 \textcolor{stringliteral}{            Args:}
00853 \textcolor{stringliteral}{                background (str) : should genes, mRNA or no data be used for the 
      map staining}
00854 \textcolor{stringliteral}{                processing (str) : should the processed data be used}
00855 \textcolor{stringliteral}{        """}
00856         \textcolor{comment}{# Groups cannot be used for now because of limitations in NaviCell unless
       the median is taken as grouping operation}
00857         mrna\_alias = [\textcolor{stringliteral}{"MRNA"}] \textcolor{comment}{# TODO Define what to put here}
00858         gene\_alias = [\textcolor{stringliteral}{"CNV"}, \textcolor{stringliteral}{"CNA"}, \textcolor{stringliteral}{"CCNA"}, \textcolor{stringliteral}{"CCNV"}, \textcolor{stringliteral}{"DNA"}]
00859         background = background.upper()
00860         \textcolor{keyword}{assert} background \textcolor{keywordflow}{in} mrna\_alias + gene\_alias + [\textcolor{stringliteral}{"NO"}, \textcolor{stringliteral}{""}], \textcolor{stringliteral}{"Select either
       genes, mRNA or no data for the map staining"}
00861         \textcolor{keyword}{assert} methylation \textcolor{keywordflow}{in} [\textcolor{stringliteral}{"glyph"}, \textcolor{stringliteral}{"glyphs"}, \textcolor{stringliteral}{"heatmap"}, \textcolor{stringliteral}{"size"}, \textcolor{stringliteral}{"glyph\_size"
      }], \textcolor{stringliteral}{"Cannot use "} + methylation + \textcolor{stringliteral}{" to display methylation data"}
00862         \textcolor{keywordflow}{if} (methylation != \textcolor{stringliteral}{"heatmap"}): methylation=\textcolor{stringliteral}{"size"}
00863         \textcolor{keyword}{assert} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}, \textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{" does not 
      exist"}
00864 
00865         \textcolor{comment}{# Select all methylation data and display as heatmap}
00866         disp\_selection = list()
00867         \textcolor{keywordflow}{for} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]:
00868             included = method.lower() \textcolor{keywordflow}{in} METHODS\_TYPE
00869             \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"methylation"}, method.lower()) \textcolor{keywordflow}{or} (included \textcolor{keywordflow}{and} METHODS
      \_TYPE[method.lower()] == \textcolor{stringliteral}{"methylation"})):
00870                 disp\_selection.append((self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing][method], meth
      ylation)) \textcolor{comment}{# TODO Change to barplot when several datatables can be used}
\hypertarget{navicom_8py_source_l00871}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a018f936de625af8a5dd7e8250ede6483}{00871}         \textcolor{comment}{# Display mRNA or gene data as map staining}
00872         \textcolor{keywordflow}{if} (background \textcolor{keywordflow}{in} mrna\_alias):
00873             \textcolor{keywordflow}{for} mrna \textcolor{keywordflow}{in} TYPES\_SPEC[\textcolor{stringliteral}{"mRNA"}][0]:
00874                 \textcolor{keywordflow}{if} (mrna \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]):
00875                     disp\_selection.append((self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing][mrna], \textcolor{stringliteral}{"m
      ap\_staining"}))
00876                     \textcolor{keywordflow}{break}
00877         \textcolor{keywordflow}{elif} (background \textcolor{keywordflow}{in} gene\_alias):
00878             \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} TYPES\_SPEC[\textcolor{stringliteral}{"cCNA"}]+TYPES\_SPEC[\textcolor{stringliteral}{"dCNA"}]:
00879                 \textcolor{keywordflow}{if} (gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]):
00880                     disp\_selection.append((self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing][mrna], \textcolor{stringliteral}{"m
      ap\_staining"}))
00881                     \textcolor{keywordflow}{break}
00882         \textcolor{keywordflow}{if} (DEBUG\_NAVICOM):
00883             \textcolor{keywordflow}{print}(disp\_selection)
00884             \textcolor{keywordflow}{print}(samples)
00885         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}(disp\_selection, samples)
00886 
00887     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a001dadf6f3dc0c77ba5b14da621b110d}{displayTranscriptome}(self, dataName, group="all: 1.0\textcolor{stringliteral}{", samplesDisplay="}\textcolor{stringliteral}{",
       samples=list(), binsNb=10):}
00888 \textcolor{stringliteral}{        }\textcolor{stringliteral}{"""}
00889 \textcolor{stringliteral}{        Display one transcriptome data as map staining, with optionnaly some extr
      a displays (samples as heatmap or barplot, mutations as glyphs, a glyph for the m
      ost highly expressed genes)}
00890 \textcolor{stringliteral}{        Args:}
00891 \textcolor{stringliteral}{            dataName (str or tuple): name or identifier of the data.}
00892 \textcolor{stringliteral}{            group (str): Identifier of the group to display}
00893 \textcolor{stringliteral}{            samplesDisplay (str): Channel where the individual samples should be 
      displayed (heatmap or barplot)}
00894 \textcolor{stringliteral}{            samples (list or str): list of samples to display, or a string specif
      ying how such a list should be built ('quantiles' to get the distribution of valu
      es)}
00895 \textcolor{stringliteral}{            nbOfSamples (int): number of individual samples to display, ignored i
      f samples is a list}
00896 \textcolor{stringliteral}{        """}
00897         allowedDisplays = [\textcolor{stringliteral}{""}, \textcolor{stringliteral}{"heatmap"}, \textcolor{stringliteral}{"barplot"}]
00898         \textcolor{keyword}{assert} samplesDisplay \textcolor{keywordflow}{in} allowedDisplays, \textcolor{stringliteral}{"samplesDisplay must one of "} +
       str(allowedDisplays)
00899         dataName = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a51ecb41beebc7636bde73be2e1ffc407}{getDataName}(dataName)
00900         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}([(dataName, \textcolor{stringliteral}{"map\_staining"})], group)
00901         \textcolor{keywordflow}{if} (samplesDisplay != \textcolor{stringliteral}{""}):
00902             \textcolor{keywordflow}{if} (isinstance(samples, list)):
00903                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}([(dataName, samplesDisplay)], samples, reset=\textcolor{keyword}{False})
00904             \textcolor{keywordflow}{elif} (isinstance(samples, str)):
00905                 \textcolor{keywordflow}{if} (samples == \textcolor{stringliteral}{"quantiles"}):
00906                     distName, distSamples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a4d7a97aa1699c943238988b8d41b73e0}{_generateDistributionData}(dataNa
      me, group, binsNb)
00907                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"distribution"}][distName].exportToNaviCell(self.
      \hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}, TYPES\_BIOTYPE[\textcolor{stringliteral}{'mRNA'}], distName)
00908                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}([(distName, samplesDisplay)], distSamples, reset
      =\textcolor{keyword}{False})
00909                 \textcolor{keywordflow}{else}:
00910                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}([(dataName, samplesDisplay)], [samples], reset=\textcolor{keyword}{F
      alse})
00911 
\hypertarget{navicom_8py_source_l00912}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a001dadf6f3dc0c77ba5b14da621b110d}{00912}     \textcolor{keyword}{def }\_generateDistributionData(self, dataName, group, binsNb=10):
00913         \textcolor{stringliteral}{"""}
00914 \textcolor{stringliteral}{        Compute distribution of values for all genes for one type of data. Use th
      e same scale for all genes. The distribution is centered on 0 if it is included, 
      so that it is easy to see if a gene is over- or under-expressed.}
00915 \textcolor{stringliteral}{        """}
00916         groups, values = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1b8f14be167905533ab7e18294dd9100}{_processGroupsName}(group)
00917         \textcolor{keywordflow}{if} (len(groups) < 1):
00918             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Cannot generate a distribution without a valid grou
      p"})
00919         \textcolor{comment}{# Each distribution }
00920         distName = \textcolor{stringliteral}{"distribution\_"} + dataName + \textcolor{stringliteral}{"\_"} + re.sub(\textcolor{stringliteral}{" "}, \textcolor{stringliteral}{"\_"}, group) + \textcolor{stringliteral}{"
      \_"} + str(binsNb)
00921         distSamples = [\textcolor{stringliteral}{"sub"} + str(ii) \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(binsNb)] + [\textcolor{stringliteral}{"NaN"}]
00922         \textcolor{keywordflow}{if} (distName \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"distribution"}]):
00923             \textcolor{keywordflow}{return}(distName)
00924 
00925         \textcolor{comment}{# Identify the samples selected by the group definition}
00926         samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.samplesPerCategory[groups[0]][values[0]]
00927         \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} range(1, len(groups)):
00928             to\_drop = list()
00929             \textcolor{keywordflow}{for} spl \textcolor{keywordflow}{in} samples:
00930                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} spl \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.samplesPerCategory[groups[idx]][v
      alues[idx]]):
00931                     to\_drop.append(spl)
00932             \textcolor{keywordflow}{for} spl \textcolor{keywordflow}{in} to\_drop:
00933                 samples.remove(spl)
00934 
00935         \textcolor{comment}{# Build the distribution dataset}
00936         data = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad675e899836271ff4f2fd4bd17ea81d9}{getData}(dataName)[samples]
00937         minq = np.nanmin(data.data)
00938         maxq = np.nanmax(data.data)
00939         step = (maxq-minq)/binsNb
00940         \textcolor{keywordflow}{if} (minq * maxq < 0):
00941             step = max(-minq/(binsNb/2), maxq/(binsNb/2))
00942         qseq = np.arange(minq, maxq + step * 1.01, step)
00943         newData = list()
00944         \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} data.genes:
00945             newData.append([0 \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(binsNb+1)])
00946             \textcolor{keywordflow}{for} value \textcolor{keywordflow}{in} data[gene]:
00947                 \textcolor{keywordflow}{if} (np.isnan(value)):
00948                     newData[-1][binsNb] += 1
00949                 \textcolor{keywordflow}{else}:
00950                     idx = 0
00951                     \textcolor{keywordflow}{while} (value > qseq[idx+1]):
00952                         idx += 1
00953                     newData[-1][idx] += 1
00954         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"distribution"}][distName] = NaviData(newData, data.genes, dist
      Samples)
00955         \textcolor{comment}{# Fill the dictionnaries to avoid display bugs}
00956         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[\textcolor{stringliteral}{'distribution'}][distName] = distName
00957         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}[distName] = (\textcolor{stringliteral}{'distribution'}, distName)
00958 
00959         \textcolor{keywordflow}{return}(distName, distSamples)
00960 
00961     \textcolor{keyword}{def }\_colorsOverlay(self, red="uniform", green="uniform", blue="uniform", proc
      essing=""):
00962         \textcolor{stringliteral}{"""}
00963 \textcolor{stringliteral}{        Create a dataset where values are colors. The color is calculated accordi
      ng to three datasets.}
00964 \textcolor{stringliteral}{}
00965 \textcolor{stringliteral}{        Args:}
00966 \textcolor{stringliteral}{            red : data name or tuple (processing, method)}
00967 \textcolor{stringliteral}{            green : data name or tuple (processing, method)}
00968 \textcolor{stringliteral}{            blue : data name or tuple (processing, method)}
00969 \textcolor{stringliteral}{        """}
00970         \textcolor{keyword}{assert} red != \textcolor{stringliteral}{"uniform"} \textcolor{keywordflow}{or} green != \textcolor{stringliteral}{"uniform"} \textcolor{keywordflow}{or} blue != \textcolor{stringliteral}{"uniform"}, \textcolor{stringliteral}{"You 
      must choose a datatable"}
00971         \textcolor{comment}{# TODO export to NaviCell and display}
00972         colors = [red, green, blue]
00973         mset = \textcolor{stringliteral}{""}
00974         \textcolor{comment}{# Empty string table}
00975         dims = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"uniform"}].data.shape
00976         dataset = np.zeros(dims, \textcolor{stringliteral}{'<U7'})
00977         \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(dims[0]):
00978             \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(dims[1]):
00979                 dataset[rr,cc] = \textcolor{stringliteral}{"#"}
00980         \textcolor{keywordflow}{for} col \textcolor{keywordflow}{in} colors:
00981             \textcolor{keywordflow}{if} (col == \textcolor{stringliteral}{"uniform"}):
00982                 \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(dims[0]):
00983                     \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(dims[1]):
00984                         dataset[rr,cc] += \textcolor{stringliteral}{"00"} \textcolor{comment}{# Default to black}
00985             \textcolor{keywordflow}{else}:
00986                 \textcolor{comment}{# Pick the datatable}
00987                 \textcolor{keywordflow}{if} (processing == \textcolor{stringliteral}{""}):
00988                     processing, method = getDataTuple(col)
00989                 \textcolor{keywordflow}{elif} (\textcolor{keywordflow}{not} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}):
00990                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{" does not exis
      t"})
00991                 \textcolor{keywordflow}{elif} (\textcolor{keywordflow}{not} col \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]):
00992                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Method \(\backslash\)""} + col + \textcolor{stringliteral}{"\(\backslash\)" does not exist with 
      processing \(\backslash\)""} + processing + \textcolor{stringliteral}{"\(\backslash\)""})
00993                 \textcolor{keywordflow}{else}:
00994                     method = col
00995                 \textcolor{keywordflow}{if} (processing != \textcolor{stringliteral}{"raw"}):
00996                     mset += processing + \textcolor{stringliteral}{"\_"}
00997                 mset += method + \textcolor{stringliteral}{"\_"}
00998                 \textcolor{comment}{# Input the value in the new dataset}
00999                 minval = np.nanmin(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].data)
01000                 maxval = np.nanmax(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].data)
01001                 \textcolor{keywordflow}{if} (np.isnan(minval) \textcolor{keywordflow}{or} np.isnan(maxval)):
01002                     warn(\textcolor{stringliteral}{"Datatable ("} + processing + \textcolor{stringliteral}{", "} + method + \textcolor{stringliteral}{") does not
       contain any value."})
01003                     \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(dims[0]):
01004                         \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(dims[1]):
01005                             dataset[rr,cc] = \textcolor{stringliteral}{"00"}
01006                 \textcolor{keywordflow}{else}:
01007                     \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(dims[0]):
01008                         \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(dims[1]):
01009                             value = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].data[rr,cc]
01010                             \textcolor{keywordflow}{if} (np.isnan(value)):
01011                                 value = minval
01012                             intensity = re.sub(\textcolor{stringliteral}{"0x"}, \textcolor{stringliteral}{""}, hex(int( 16 * (value - m
      inval) / (maxval-minval) )) )
01013                             \textcolor{keywordflow}{if} (len(intensity) == 0):
01014                                 intensity = \textcolor{stringliteral}{"0"} + intensity
01015                             dataset[rr,cc] += intensity
01016         mset = re.sub(\textcolor{stringliteral}{"\_$"}, \textcolor{stringliteral}{""}, mset)
01017         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"colors"}][mset] = NaviData(dataset, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][met
      hod].rows, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].columns, processing=\textcolor{stringliteral}{"colors"}, method=\textcolor{stringliteral}{"u
      nknown"})
01018 
01019     \textcolor{comment}{# Saving data}
01020     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab539e16bff0a424ebd2753c153ff4e53}{saveAllData}(self, folder=""):
01021         \textcolor{stringliteral}{"""}
01022 \textcolor{stringliteral}{        Save all data in an .ncc file. Does not save the distribution nor color d
      ata.}
01023 \textcolor{stringliteral}{        """}
01024         \textcolor{keywordflow}{if} (folder != \textcolor{stringliteral}{""}):
01025             folder = re.sub(\textcolor{stringliteral}{"/?$"}, \textcolor{stringliteral}{"/"}, folder)
01026         fname = folder + self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} + \textcolor{stringliteral}{".ncc"}
01027         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Saving as "} + fname)
01028         ff = open(fname, \textcolor{stringliteral}{"w"})
01029         ff.close()
01030         allProcessings = list(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data})
01031         allProcessings.remove(\textcolor{stringliteral}{"uniform"})
01032         allProcessings.remove(\textcolor{stringliteral}{"distribution"})
01033         allProcessings.remove(\textcolor{stringliteral}{"color"})
01034         \textcolor{keywordflow}{for} processing \textcolor{keywordflow}{in} allProcessings:
01035             \textcolor{keywordflow}{for} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]:
01036                 \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Saving "} + processing + \textcolor{stringliteral}{", "} + method)\textcolor{comment}{# + ", " + str(self.
      \_data[processing][method]))}
01037                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].saveData(fname, \textcolor{stringliteral}{"a"})
01038         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Saving Annotations"})
01039         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.saveData(fname, \textcolor{stringliteral}{"a"})
01040 
01041     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac53d9dc53ca0af44586a55fb1bffe8bd}{saveData}(self, method, processing="raw", folder="./"):
01042         \textcolor{stringliteral}{"""}
\hypertarget{navicom_8py_source_l01043}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab539e16bff0a424ebd2753c153ff4e53}{01043} \textcolor{stringliteral}{        Save the data in a file that can be exported to NaviCell or imported in N
      aviCom}
01044 \textcolor{stringliteral}{        """}
01045         \textcolor{comment}{# TODO authorize to provide a list to save a custom dataset}
01046         \textcolor{keywordflow}{if} (folder != \textcolor{stringliteral}{""}):
01047             folder = re.sub(\textcolor{stringliteral}{"/?$"}, \textcolor{stringliteral}{"/"}, folder)
01048         \textcolor{keywordflow}{if} (processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}):
01049             \textcolor{keywordflow}{if} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]):
01050                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].saveData(baseName=folder+self.
      \hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name})
01051             \textcolor{keywordflow}{else}:
01052                 \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Method "} + method + \textcolor{stringliteral}{" does not exist with proce
      ssing "} + processing)
01053         \textcolor{keywordflow}{else}:
01054             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{" does not exist"})
01055 
\end{DoxyCode}
