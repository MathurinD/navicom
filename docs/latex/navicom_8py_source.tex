\hypertarget{navicom_8py_source}{
\subsection{navicom/navicom.py}
}

\begin{DoxyCode}
00001 \textcolor{comment}{################################################################################}
00002 \textcolor{comment}{# navicom.py}
00003 \textcolor{comment}{# By Mathurin Dorel}
00004 \textcolor{comment}{# Import data from a file and create analyzed sets to export to NaviCell}
00005 \textcolor{comment}{################################################################################}
00006 
00007 \textcolor{keyword}{from} curie.navicell \textcolor{keyword}{import} *
00008 \textcolor{keyword}{from} .navidata \textcolor{keyword}{import} *
00009 \textcolor{keyword}{from} .displayConfig \textcolor{keyword}{import} *
00010 
00011 DEBUG\_NAVICOM = \textcolor{keyword}{True}
00012 VERBOSE\_NAVICOM = \textcolor{keyword}{True}
00013 
00014 \textcolor{keyword}{def }getLine(ll, split\_char="\(\backslash\)t"):
00015     ll = re.sub(\textcolor{stringliteral}{'\(\backslash\)"'}, \textcolor{stringliteral}{''}, ll.strip())
00016     ll = re.sub(\textcolor{stringliteral}{'\(\backslash\)tNA'}, \textcolor{stringliteral}{'\(\backslash\)tNaN'}, ll) \textcolor{comment}{# Python float can convert "NaN" -> nan but 
      not "NA" -> nan}
00017     ll = ll.split(split\_char)
00018     \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(ll)):
00019         \textcolor{keywordflow}{try}:
00020             ll[ii] = float(ll[ii])
00021         \textcolor{keywordflow}{except}:
00022             \textcolor{keywordflow}{pass}
00023     \textcolor{keywordflow}{return}(ll)
00024 
00025 \textcolor{keyword}{class }NaviCom():
00026     \textcolor{stringliteral}{"""}
00027 \textcolor{stringliteral}{    NaviComm class to handle data and display them in a standardized way on NaviC
      ell maps}
\hypertarget{navicom_8py_source_l00028}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom}{00028} \textcolor{stringliteral}{    """}
00029 
00030     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ae6133fe7ec63cf5643c1794f4f8e2349}{__init__}(self, map\_url='https://navicell.curie.fr/navicell/maps/cellcycle
      /master/index.php\textcolor{stringliteral}{', fname="", modules\_dict="", browser\_command="firefox %s", disp
      lay\_config=DisplayConfig()):}
00031 \textcolor{stringliteral}{        }\textcolor{stringliteral}{"""}
00032 \textcolor{stringliteral}{        Initialize a Navicell communication object.}
00033 \textcolor{stringliteral}{        Args:}
00034 \textcolor{stringliteral}{            map\_url (str): URL of the NaviCell map}
00035 \textcolor{stringliteral}{            fname (str): name of the data file to load}
00036 \textcolor{stringliteral}{            modules\_dict (str): name of the module definition file (.gmt) to load
      }
00037 \textcolor{stringliteral}{            browser\_command (str): command to open the browser}
\hypertarget{navicom_8py_source_l00038}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ae6133fe7ec63cf5643c1794f4f8e2349}{00038} \textcolor{stringliteral}{        """}
00039         \textcolor{comment}{# Build options for the navicell connexion}
00040         options = Options()
00041         options.map\_url = map\_url
00042         idx = options.map\_url.find(\textcolor{stringliteral}{'/navicell/'})
00043         options.proxy\_url = options.map\_url[0:idx] + \textcolor{stringliteral}{'/cgi-bin/nv\_proxy.php'}
00044         options.browser\_command = browser\_command \textcolor{comment}{# TODO Add user control}
00045         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv} = NaviCell(options)
00046         \textcolor{comment}{# Name of the dataset}
00047         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} = \textcolor{stringliteral}{"no\_name"}
00048         \textcolor{comment}{# NaviCell export control}
00049         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aff54ed91d1f335cea31829f59d4efb81}{exported_annotations} = \textcolor{keyword}{False}
00050         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a32c1346193b73ea8558dd0318ae6932c}{browser_opened} = \textcolor{keyword}{False}
00051         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a48c57d5aca173ba7167dbc51501fb1ac}{biotypes} = dict()
00052         \textcolor{comment}{# Representation of the data}
00053         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56628d774db59cb8b06af3801fb6306c}{display_config} = display\_config
00054         \textcolor{comment}{# Data, indexed by processing then type of data}
00055         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a255d56e997ddcc653d8f06c741ea13}{processings} = PROCESSINGS
00056         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data} = dict() \textcolor{comment}{# All data}
00057         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5995e07de24daa015b8b44b1ae0cada7}{exported_data} = dict() \textcolor{comment}{# Whether data have been exported yet}
00058         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a68646454fe1481b0065d2f43548319df}{data_names} = dict() \textcolor{comment}{# Name of the exported data}
00059         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1d7072ae29e32d7ddd1da9cc5def7199}{associated_data} = dict() \textcolor{comment}{# Processing and method associated to each 
      name}
00060         \textcolor{keywordflow}{for} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a255d56e997ddcc653d8f06c741ea13}{processings}:
00061             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing] = dict()
00062             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5995e07de24daa015b8b44b1ae0cada7}{exported_data}[processing] = dict()
00063             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a68646454fe1481b0065d2f43548319df}{data_names}[processing] = dict()
00064         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5995e07de24daa015b8b44b1ae0cada7}{exported_data}[\textcolor{stringliteral}{"uniform"}] = \textcolor{keyword}{False}
00065         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations} = dict() \textcolor{comment}{# Annotations of the samples}
00066         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules} = dict() \textcolor{comment}{# Composition of each module}
00067         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a9f3e4dbfabe319967c14bf61eaf8d022}{associated_modules} = dict() \textcolor{comment}{# Number of modules each gene belong to}
00068         \textcolor{keywordflow}{if} (fname != \textcolor{stringliteral}{""}):
00069             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a10e8b8a4c06b4ecf09366ca6b69efff6}{loadData}(fname)
00070             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6411b52971f15bd11270942cb98eaa1a}{defineModules}(modules\_dict)
00071         \textcolor{comment}{# Remember how many samples and datatables were selected in NaviCell in t
      he heatmap and barplot editors}
00072         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac8b826435d1ae69420151967b3a872eb}{hsid} = 0
00073         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a35fe0d421abe7e1b08fc92ca58b689db}{hdid} = 0
00074         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1f652094a5c16ca0b721856f5e5aadf2}{bid} = 0
00075 
00076     \textcolor{keyword}{def }listData(self):
00077         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Data available :"})
00078         \textcolor{keywordflow}{for} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a255d56e997ddcc653d8f06c741ea13}{processings}:
00079             \textcolor{keywordflow}{for} dname \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing]:
00080                 \textcolor{keywordflow}{if} (dname.lower() \textcolor{keywordflow}{in} METHODS\_TYPE):
00081                     \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"\(\backslash\)t"} + processing + \textcolor{stringliteral}{" "} + dname + \textcolor{stringliteral}{": "} + METHODS\_TYPE[d
      name.lower()] + \textcolor{stringliteral}{" (biotype: "} + TYPES\_BIOTYPE[METHODS\_TYPE[dname.lower()]] + \textcolor{stringliteral}{")"})
      
00082                 \textcolor{keywordflow}{else}:
00083                     \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"\(\backslash\)t"} + processing + \textcolor{stringliteral}{" "} + dname)
00084 
00085     \textcolor{keyword}{def }listAnnotations(self):
00086         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Annotations available (values) :"})
00087         \textcolor{keywordflow}{for} annot \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.annotations:
00088             \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"\(\backslash\)t"} + annot + \textcolor{stringliteral}{" : "} + str(set(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}[annot])))
00089 
00090     \textcolor{keyword}{def }\_\_repr\_\_(self):
00091         rpr = \textcolor{stringliteral}{"NaviCom object with "} + str(len(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data})) + \textcolor{stringliteral}{" types of data:\(\backslash\)n"}
00092         \textcolor{keywordflow}{for} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}:
00093             rpr += method + \textcolor{stringliteral}{": "} + self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[method] + \textcolor{stringliteral}{"\(\backslash\)n"}
00094         rpr += \textcolor{stringliteral}{"and "} + str(len(self.moduleAverage)) + \textcolor{stringliteral}{" modules average:\(\backslash\)n"}
00095         \textcolor{keywordflow}{for} method \textcolor{keywordflow}{in} self.moduleAverage:
00096             rpr += method + \textcolor{stringliteral}{": "} + self.moduleAverage[method] + \textcolor{stringliteral}{"\(\backslash\)n"}
00097         \textcolor{keywordflow}{return}(repr)
00098     
00099     \textcolor{keyword}{def }nameData(self, method, processing="raw", name=""):
00100         \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{""}):
00101             name = method + \textcolor{stringliteral}{"\_"} + processing
00102         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a68646454fe1481b0065d2f43548319df}{data_names}[processing][method] = name
00103         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1d7072ae29e32d7ddd1da9cc5def7199}{associated_data}[name] = (processing, method)
00104         \textcolor{keywordflow}{return} (name)
00105 
00106     \textcolor{keyword}{def }getDataName(self, data\_name):
00107         dTuple = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad8ac5b74afb4ceb6ed094604787d4d19}{getDataTuple}(data\_name)
00108         \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a68646454fe1481b0065d2f43548319df}{data_names}[dTuple[0]][dTuple[1]])
00109 
00110     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad8ac5b74afb4ceb6ed094604787d4d19}{getDataTuple}(self, data\_name):
00111         \textcolor{stringliteral}{"""}
00112 \textcolor{stringliteral}{        Return tuple corresponding to the data name or tuple}
\hypertarget{navicom_8py_source_l00113}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad8ac5b74afb4ceb6ed094604787d4d19}{00113} \textcolor{stringliteral}{        """}
00114         \textcolor{keywordflow}{if} (isinstance(data\_name, str)):
00115             \textcolor{keywordflow}{if} (data\_name \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1d7072ae29e32d7ddd1da9cc5def7199}{associated_data}):
00116                 \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1d7072ae29e32d7ddd1da9cc5def7199}{associated_data}[data\_name])
00117             \textcolor{keywordflow}{elif} (data\_name + \textcolor{stringliteral}{"\_raw"} \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1d7072ae29e32d7ddd1da9cc5def7199}{associated_data}):
00118                 \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1d7072ae29e32d7ddd1da9cc5def7199}{associated_data}[data\_name + \textcolor{stringliteral}{"\_raw"}])
00119         \textcolor{keywordflow}{elif} (isinstance(data\_name, tuple) \textcolor{keywordflow}{and} len(data\_name) == 2):
00120             \textcolor{keywordflow}{if} (data\_name[0] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a255d56e997ddcc653d8f06c741ea13}{processings}):
00121                 \textcolor{keywordflow}{return}(data\_name)
00122             \textcolor{keywordflow}{elif} (data\_name[1] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a255d56e997ddcc653d8f06c741ea13}{processings}):
00123                 \textcolor{keywordflow}{return}((data\_name[1],data\_name[0]))
00124         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Invalid name or tuple for data: "} + str(data\_name))
00125 
00126     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad675e899836271ff4f2fd4bd17ea81d9}{getData}(self, data\_name):
00127         \textcolor{stringliteral}{"""}
00128 \textcolor{stringliteral}{        Return the NaviData entity corresponding to the data name or tuple}
\hypertarget{navicom_8py_source_l00129}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad675e899836271ff4f2fd4bd17ea81d9}{00129} \textcolor{stringliteral}{        """}
00130         dTuple = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad8ac5b74afb4ceb6ed094604787d4d19}{getDataTuple}(data\_name)
00131         \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[dTuple[0]][dTuple[1]])
00132 
00133     \textcolor{comment}{# Load new data}
00134     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a10e8b8a4c06b4ecf09366ca6b69efff6}{loadData}(self, fname="data/Ovarian\_Serous\_Cystadenocarcinoma\_TCGA\_Nature\_
      2011.txt", keep\_mutations\_nan=False):
00135         \textcolor{stringliteral}{"""}
00136 \textcolor{stringliteral}{        Load data from a .txt or .ncc file containing several datas, or from a .t
      sv, .ncd or .nca file containing data from one method.}
00137 \textcolor{stringliteral}{}
00138 \textcolor{stringliteral}{        Args:}
00139 \textcolor{stringliteral}{            fname (str): name of the file from which the data should be loaded}
00140 \textcolor{stringliteral}{            keep\_mutations\_nan(str): whether nan in mutations data should be cons
      idered as no mutation (False) or missing value (True)}
\hypertarget{navicom_8py_source_l00141}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a10e8b8a4c06b4ecf09366ca6b69efff6}{00141} \textcolor{stringliteral}{        """}
00142         with open(fname) \textcolor{keyword}{as} file\_conn:
00143             ff = file\_conn.readlines()
00144             ll = 0
00145         \textcolor{comment}{# Name the dataset according to the filename, and issue a warning if the 
      name changes}
00146         dname = parseFilename(fname)[0]
00147         \textcolor{keywordflow}{if} (dname != self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} \textcolor{keywordflow}{and} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} != \textcolor{stringliteral}{"no\_name"}):
00148             warn(\textcolor{stringliteral}{"Name of the dataset "} + self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} + \textcolor{stringliteral}{" has been changed to "} + d
      name)
00149         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} = dname
00150 
00151         dataRegex = \textcolor{stringliteral}{"^M |^GENE"}
00152         annotRegex = \textcolor{stringliteral}{"^ANNOTATIONS|^NAME"}
00153         completeRegex = dataRegex + \textcolor{stringliteral}{"|"} + annotRegex
00154         methodFromFile = \textcolor{keyword}{False}
00155         \textcolor{keywordflow}{while} (ll < len(ff)):
00156             \textcolor{keywordflow}{if} (re.search(dataRegex, ff[ll])):
00157                 \textcolor{comment}{# Import data}
00158                 \textcolor{comment}{# Use the method and processing names if they are provided, other
      wise deduce them from the filename }
00159                 \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"^M "}, ff[ll])):
00160                     line = re.sub(\textcolor{stringliteral}{"^M"}, \textcolor{stringliteral}{""}, ff[ll].strip()).split(\textcolor{stringliteral}{"\(\backslash\)t"})
00161                     method = line[0].strip()
00162                     \textcolor{keywordflow}{if} (len(line) > 1 \textcolor{keywordflow}{and} line[1] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a255d56e997ddcc653d8f06c741ea13}{processings}):
00163                         processing = line[1].strip()
00164                     \textcolor{keywordflow}{else}:
00165                         processing = \textcolor{stringliteral}{"raw"}
00166                     samples = getLine(ff[ll+1])
00167                     \textcolor{keywordflow}{if} (samples[0] == \textcolor{stringliteral}{"GENE"}):
00168                         samples = samples[1:]
00169                     ll += 2
00170                 \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"^GENE"}, ff[ll])):
00171                     fname = os.path.split(fname)[1]
00172                     dname, processing, method = parseFilename(fname)
00173                     \textcolor{comment}{# Deduction cannot be performed}
00174                     \textcolor{keywordflow}{if} (methodFromFile):
00175                         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"A type of data must be provided when im
      porting several data in one file"})
00176                     \textcolor{keywordflow}{else}:
00177                         methodFromFile = \textcolor{keyword}{True}
00178                     samples = getLine(ff[ll])[1:]
00179                     ll += 1
00180                 \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Importing "} + method + \textcolor{stringliteral}{" data"})
00181                 profile\_data = dict()
00182                 profile\_data[\textcolor{stringliteral}{"samples"}] = oDict()
00183                 profile\_data[\textcolor{stringliteral}{"genes"}] = dict()
00184                 profile\_data[\textcolor{stringliteral}{"data"}] = list()
00185                 ii = 0
00186                 \textcolor{keywordflow}{for} el \textcolor{keywordflow}{in} samples:
00187                     profile\_data[\textcolor{stringliteral}{"samples"}][el] = ii
00188                     ii += 1
00189 
00190                 gid = 0
00191                 \textcolor{keywordflow}{while}(ll < len(ff) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} re.search(completeRegex, ff[ll])):
00192                     dl = getLine(ff[ll])
00193                     profile\_data[\textcolor{stringliteral}{"data"}].append(dl[1:]) \textcolor{comment}{# Data in a list at index
       gene\_name}
00194                     profile\_data[\textcolor{stringliteral}{"genes"}][dl[0]] = gid
00195                     gid += 1
00196 
00197                     ll += 1
00198                 \textcolor{keywordflow}{if} (processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data} \textcolor{keywordflow}{and} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing]):
      
00199                     warn(\textcolor{stringliteral}{"Overwriting data for method "} + method + \textcolor{stringliteral}{" with process
      ing "} + processing)
00200                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing][method] = NaviData(profile\_data[\textcolor{stringliteral}{"data"}], pr
      ofile\_data[\textcolor{stringliteral}{"genes"}], profile\_data[\textcolor{stringliteral}{"samples"}], processing, method)
00201                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5995e07de24daa015b8b44b1ae0cada7}{exported_data}[processing][method] = \textcolor{keyword}{False}
00202                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5314c49d6b9749693519a4a86cbfde71}{quantifyMutations}(method)
00203                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a8e735eed992a5cf92616113d47eea6ee}{nameData}(method, processing)
00204                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} \textcolor{stringliteral}{"uniform"} \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}):
00205                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a628c6252226b65dca80237d6783c08c6}{defineUniformData}(profile\_data[\textcolor{stringliteral}{"samples"}], profile\_data[
      \textcolor{stringliteral}{"genes"}])
00206             \textcolor{keywordflow}{elif} (re.search(annotRegex, ff[ll])):
00207                 \textcolor{comment}{# Import annotations}
00208                 \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Importing Annotations"})
00209                 \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"^ANNOTATIONS"}, ff[ll])):
00210                     annotations\_names = getLine(ff[ll+1])
00211                     \textcolor{keywordflow}{if} (annotations\_names[0] == \textcolor{stringliteral}{"NAME"}):
00212                         annotations\_names = annotations\_names[1:]
00213                     ll += 2
00214                 \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"^NAME"}, ff[ll])):
00215                     annotations\_names = getLine(ff[ll][1:])
00216                     ll += 1
00217                 annot = dict()
00218                 annot[\textcolor{stringliteral}{"names"}] = list()
00219                 annot[\textcolor{stringliteral}{"samples"}] = list()
00220                 annot[\textcolor{stringliteral}{"annot"}] = list()
00221                 not\_all = \textcolor{keywordflow}{not} \textcolor{stringliteral}{"all"} \textcolor{keywordflow}{in} annotations\_names
00222                 \textcolor{keywordflow}{if} (not\_all):
00223                     annot[\textcolor{stringliteral}{"names"}].append(\textcolor{stringliteral}{"all"})
00224                     annot[\textcolor{stringliteral}{"annot"}].append([1 \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(nb\_samples)])
00225                 \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} annotations\_names:
00226                     annot[\textcolor{stringliteral}{"names"}].append(name)
00227                 \textcolor{keywordflow}{while}(ll < len(ff) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} re.search(completeRegex, ff[ll])):
00228                     al = getLine(ff[ll])
00229                     \textcolor{comment}{# Gather each annotation for this sample and add all as the f
      irst column if necessary}
00230                     \textcolor{keywordflow}{if} (not\_all):
00231                         annot[\textcolor{stringliteral}{"annot"}].append([1] + al[1:])
00232                     \textcolor{keywordflow}{else}:
00233                         annot[\textcolor{stringliteral}{"annot"}].append(al[1:])
00234                     annot[\textcolor{stringliteral}{"samples"}].append(al[0])
00235 
00236                     ll = ll+1
00237                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations} = NaviAnnotations(annot[\textcolor{stringliteral}{"annot"}], annot[\textcolor{stringliteral}{"samples
      "}], annot[\textcolor{stringliteral}{"names"}], dType=\textcolor{stringliteral}{"annotations"})
00238             \textcolor{keywordflow}{else}:
00239                 \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Incorrect format, file must be a valid file for
       NaviCell or an aggregation of such files with headers to indicate the type of da
      ta"})
00240 
00241     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ae310adb1d4e8932f0b72b6d8b6ca6301}{bindNaviData}(self, navidata, method, processing):
00242         \textcolor{stringliteral}{"""}
00243 \textcolor{stringliteral}{        Bind NaviData to the NaviCom object in order to use it }
\hypertarget{navicom_8py_source_l00244}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ae310adb1d4e8932f0b72b6d8b6ca6301}{00244} \textcolor{stringliteral}{        """}
00245         \textcolor{keyword}{assert} isinstance(navidata, NaviData), \textcolor{stringliteral}{"navidata is not a NaviData object
      "}
00246         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a42c3198667c80bbf3d61a3d57b39a883}{newProcessedData}(processing, method, navidata)
00247 
00248     \textcolor{keyword}{def }defineUniformData(self, samples, genes):
00249         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"uniform"}] = NaviData( np.array([[1] * len(samples) \textcolor{keywordflow}{for} nn \textcolor{keywordflow}{in} g
      enes]), genes, samples )
00250         \textcolor{comment}{# TODO change to 1.0 when < is changed to <= for continuous data}
00251 
00252     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a42c3198667c80bbf3d61a3d57b39a883}{newProcessedData}(self, processing, method, data):
00253         \textcolor{stringliteral}{"""}
00254 \textcolor{stringliteral}{        Update adequate arrays when processed data are generated}
\hypertarget{navicom_8py_source_l00255}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a42c3198667c80bbf3d61a3d57b39a883}{00255} \textcolor{stringliteral}{        """}
00256         \textcolor{keyword}{assert} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a255d56e997ddcc653d8f06c741ea13}{processings}, \textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{" is 
      not handled"}
00257         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing][method] = data
00258         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5995e07de24daa015b8b44b1ae0cada7}{exported_data}[processing][method] = \textcolor{keyword}{False}
00259         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a8e735eed992a5cf92616113d47eea6ee}{nameData}(method, processing)
00260 
00261     \textcolor{comment}{# Process data}
00262     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5314c49d6b9749693519a4a86cbfde71}{quantifyMutations}(self, method, keep\_nan=False):
00263         \textcolor{stringliteral}{"""}
00264 \textcolor{stringliteral}{        Transform the qualitative mutation datas into a quantitative one, where 1
       means a mutation and 0 no mutation.}
00265 \textcolor{stringliteral}{        Args:}
00266 \textcolor{stringliteral}{            keep\_nan : Should nan values be converted to O (no mutations) or kept
       as missing data}
\hypertarget{navicom_8py_source_l00267}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5314c49d6b9749693519a4a86cbfde71}{00267} \textcolor{stringliteral}{        """}
00268         \textcolor{keywordflow}{if} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"raw"}] \textcolor{keywordflow}{and} METHODS\_TYPE[method.lower()] == \textcolor{stringliteral}{"mutat
      ions"}):
00269             mutations = NaviData(np.zeros(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"raw"}][method].data.shape), s
      elf.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"raw"}][method].rows\_names, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"raw"}][method].columns\_names, metho
      d)
00270             \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(len(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"raw"}][method].rows\_names)):
00271                 \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(len(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"raw"}][method].columns\_names)):
00272                     value = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"raw"}][method][rr][cc]
00273                     \textcolor{keywordflow}{if} ( re.match(\textcolor{stringliteral}{"nan|na"}, value.lower()) ):
00274                         \textcolor{keywordflow}{if} (keep\_nan):
00275                             mutations.data[rr][cc] = np.nan
00276                         \textcolor{keywordflow}{else}:
00277                             mutations.data[rr][cc] = 0
00278                     \textcolor{keywordflow}{elif} ( value == \textcolor{stringliteral}{""} ):
00279                         mutations.data[rr][cc] = 0
00280                     \textcolor{keywordflow}{else}:
00281                         mutations.data[rr][cc] = 1
00282             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a42c3198667c80bbf3d61a3d57b39a883}{newProcessedData}(\textcolor{stringliteral}{"mutationQuantification"}, method, mutations)
00283 
00284     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6411b52971f15bd11270942cb98eaa1a}{defineModules}(self, modules\_dict=""):
00285         \textcolor{stringliteral}{"""}
00286 \textcolor{stringliteral}{        Defines the modules to use and which module each gene belongs to.}
00287 \textcolor{stringliteral}{}
00288 \textcolor{stringliteral}{        Args:}
00289 \textcolor{stringliteral}{            modules\_dict : Either a dict indexed by module name or a file name wi
      th the description of each module (.gmt file: tab delimited, first column module 
      name, second column description, then list of entities in the module)}
\hypertarget{navicom_8py_source_l00290}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6411b52971f15bd11270942cb98eaa1a}{00290} \textcolor{stringliteral}{        """}
00291         \textcolor{comment}{# Gather the composition of each module}
00292         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules} = dict()
00293         \textcolor{keywordflow}{if} (isinstance(modules\_dict, dict)):
00294             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules} = modules\_dict 
00295         \textcolor{keywordflow}{elif} (isinstance(modules\_dict, str)):
00296             \textcolor{keywordflow}{if} (modules\_dict != \textcolor{stringliteral}{""}):
00297                 with open(modules\_dict) \textcolor{keyword}{as} ff:
00298                     \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} ff.readlines():
00299                         ll = line.strip().split(\textcolor{stringliteral}{"\(\backslash\)t"})
00300                         module\_name = ll[0]
00301                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}[module\_name] = ll[2:]
00302 
00303         \textcolor{comment}{# TODO add control that the genes in the modules have data}
00304         \textcolor{stringliteral}{"""}
00305 \textcolor{stringliteral}{        # Only keep genes with data}
00306 \textcolor{stringliteral}{        for module in self.modules:}
00307 \textcolor{stringliteral}{            keep = list()}
00308 \textcolor{stringliteral}{            for gene in self.modules[module]:}
00309 \textcolor{stringliteral}{                if (not gene in self.genes\_list):}
00310 \textcolor{stringliteral}{                    self.modules[module].remove(gene)}
00311 \textcolor{stringliteral}{        """}
00312         \textcolor{comment}{# Count the number of modules each gene belong to}
00313         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a9f3e4dbfabe319967c14bf61eaf8d022}{associated_modules} = dict()
00314         \textcolor{keywordflow}{for} module\_name \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}.keys():
00315             \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}[module\_name]:
00316                 \textcolor{keywordflow}{try}:
00317                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a9f3e4dbfabe319967c14bf61eaf8d022}{associated_modules}[gene].append(module\_name)
00318                 \textcolor{keywordflow}{except} KeyError:
00319                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a9f3e4dbfabe319967c14bf61eaf8d022}{associated_modules}[gene] = [module\_name]
00320 
00321     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afd1a299b687bc97e171cff0a738b7b73}{averageModule}(self, method):
00322         \textcolor{stringliteral}{"""}
00323 \textcolor{stringliteral}{        Perform module averaging for every modules for one data type}
\hypertarget{navicom_8py_source_l00324}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afd1a299b687bc97e171cff0a738b7b73}{00324} \textcolor{stringliteral}{        """}
00325         \textcolor{keyword}{assert} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"raw"}], \textcolor{stringliteral}{"This type of data is not present"}
00326         \textcolor{keyword}{assert} len(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules})>0, \textcolor{stringliteral}{"No module have been defined"}
00327 
00328         \textcolor{comment}{# Calculate average expression for each module}
00329         data = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"raw"}][method]
00330         samples = list(data.samples.keys())
00331         module\_expression = dict()
00332         \textcolor{keywordflow}{for} module \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}:
00333             module\_expression[module] = [0 \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} samples]
00334             non\_nan = np.array([0 \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} samples])
00335             no\_data = list()
00336             \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}[module]:
00337                 \textcolor{keywordflow}{try}:
00338                     not\_nan = np.array([int(\textcolor{keywordflow}{not} np.isnan(dd)) \textcolor{keywordflow}{for} dd \textcolor{keywordflow}{in} data[gene
      ].data])
00339                     non\_nan += not\_nan
00340                     non\_nan\_data = data[gene].data * not\_nan
00341                     non\_nan\_data[np.isnan(non\_nan\_data)] = 0
00342                     module\_expression[module] += non\_nan\_data
00343                 \textcolor{keywordflow}{except} IndexError:
00344                     no\_data += [gene]
00345             \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} no\_data:
00346                 \textcolor{comment}{#self.modules[module].remove(gene)}
00347                 \textcolor{keywordflow}{if} (VERBOSE\_NAVICOM):
00348                     \textcolor{keywordflow}{print}(gene + \textcolor{stringliteral}{" from module "} + module + \textcolor{stringliteral}{" has no "} + method +
       \textcolor{stringliteral}{" data"})
00349             module\_expression[module] /= non\_nan
00350 
00351         \textcolor{comment}{# Calculate average module expression for each gene}
00352         gene\_module\_average = list()
00353         \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} data.genes:
00354             \textcolor{keywordflow}{if} gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a9f3e4dbfabe319967c14bf61eaf8d022}{associated_modules}:
00355                 gene\_module\_average.append(np.array([0. \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} data.sample
      s]))
00356                 \textcolor{keywordflow}{for} module \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a9f3e4dbfabe319967c14bf61eaf8d022}{associated_modules}[gene]:
00357                     gene\_module\_average[-1] += module\_expression[module] / len(se
      lf.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a9f3e4dbfabe319967c14bf61eaf8d022}{associated_modules}[gene])
00358             \textcolor{keywordflow}{else}:
00359                 gene\_module\_average.append(np.array(list(data[gene])))
00360                 \textcolor{keywordflow}{print}(gene)
00361 
00362         \textcolor{comment}{# Put the averaging in a NaviData structure}
00363         \textcolor{comment}{#self.data["moduleAverage"][method] = NaviData(list(module\_expression.val
      ues()), list(self.modules.keys()), samples) # Usefull if NaviCell allow modules v
      alues one day}
00364         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a42c3198667c80bbf3d61a3d57b39a883}{newProcessedData}(\textcolor{stringliteral}{"moduleAverage"}, method, NaviData(gene\_module\_avera
      ge, list(data.genes), samples))
00365 
00366     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a369bba5d2dc39a565880bc6f853f0da1}{pcaComp}(self, method, colors=["red", "green", "blue"]):
00367         \textcolor{stringliteral}{"""}
00368 \textcolor{stringliteral}{        Run pca on the data and create a color matrix with the 3 principal compon
      ents in the three main colors}
\hypertarget{navicom_8py_source_l00369}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a369bba5d2dc39a565880bc6f853f0da1}{00369} \textcolor{stringliteral}{        """}
00370         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Not implemented yet"})
00371 
00372     \textcolor{comment}{# Export data and annotations}
00373     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a7395c2253695b46bf95cd48ed1be6d3e}{exportData}(self, method, processing="raw", name=""):
00374         \textcolor{stringliteral}{"""}
00375 \textcolor{stringliteral}{        Export data to NaviCell, can be processed data}
00376 \textcolor{stringliteral}{}
00377 \textcolor{stringliteral}{        Args:}
00378 \textcolor{stringliteral}{            method (str) : name of the method to export}
00379 \textcolor{stringliteral}{            processing (str) : "" to export raw data, processing method to export
       processed data. See 'averageModule' and 'pcaComponent'}
\hypertarget{navicom_8py_source_l00380}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a7395c2253695b46bf95cd48ed1be6d3e}{00380} \textcolor{stringliteral}{        """}
00381         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa7aadc5d33a24f0fd5705e363c0fedcb}{checkBrowser}() \textcolor{comment}{# TODO Perform processing if necessary}
00382         done\_export = \textcolor{keyword}{False}
00383 
00384         \textcolor{keywordflow}{if} (processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a255d56e997ddcc653d8f06c741ea13}{processings}):
00385             \textcolor{keywordflow}{if} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing]):
00386                 \textcolor{keywordflow}{if}(method.lower() \textcolor{keywordflow}{in} METHODS\_TYPE):
00387                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5995e07de24daa015b8b44b1ae0cada7}{exported_data}[processing][method]):
00388                         name = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a8e735eed992a5cf92616113d47eea6ee}{nameData}(method, processing, name)
00389                         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Exporting "} + name + \textcolor{stringliteral}{" to NaviCell..."})
00390                         \textcolor{comment}{# Processing change the type of data, like discrete data 
      into continuous, or anything to color data}
00391                         biotype = getBiotype(method, processing)
00392                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.importDatatables(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing][method].ma
      keData(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.getHugoList()), name, biotype)
00393                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5b6fef64cb29988c7a4c07138c03b5c1}{configureDisplay}(method, processing)
00394                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5995e07de24daa015b8b44b1ae0cada7}{exported_data}[processing][method] = \textcolor{keyword}{True}
00395                         done\_export = \textcolor{keyword}{True}
00396                 \textcolor{keywordflow}{elif} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{'distribution'}]):
00397                     \textcolor{keywordflow}{pass} \textcolor{comment}{# Avoid bug}
00398                 \textcolor{keywordflow}{else}:
00399                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Biotype of '"} + method + \textcolor{stringliteral}{"' is unknown"})
00400             \textcolor{keywordflow}{elif} (method == \textcolor{stringliteral}{"uniform"}): \textcolor{comment}{# Uniform data for glyphs}
00401                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5995e07de24daa015b8b44b1ae0cada7}{exported_data}[\textcolor{stringliteral}{"uniform"}]):
00402                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.importDatatables(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"uniform"}].makeData(self.
      \hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.getHugoList()), \textcolor{stringliteral}{"uniform"}, \textcolor{stringliteral}{"Discrete Copy number data"}) \textcolor{comment}{# Continuous is better
       for grouping but posses problems with glyphs}
00403                     name = \textcolor{stringliteral}{"uniform"}
00404                     \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Exporting "} + name + \textcolor{stringliteral}{" to NaviCell..."})
00405                     done\_export = \textcolor{keyword}{True}
00406                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5995e07de24daa015b8b44b1ae0cada7}{exported_data}[\textcolor{stringliteral}{"uniform"}] = \textcolor{keyword}{True}
00407             \textcolor{keywordflow}{elif} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"distribution"}]):
00408                 \textcolor{keywordflow}{pass} \textcolor{comment}{# Exported on creation, to change for multiple NaviCell}
00409             \textcolor{keywordflow}{else}:
00410                 \textcolor{keywordflow}{raise} KeyError(\textcolor{stringliteral}{"Method '"} + method + \textcolor{stringliteral}{"' with processing '"} + proc
      essing + \textcolor{stringliteral}{"' does not exist"})
00411         \textcolor{keywordflow}{else}:
00412             \textcolor{keywordflow}{raise} KeyError(\textcolor{stringliteral}{"Processing '"} + processing + \textcolor{stringliteral}{"' does not exist"})
00413 
00414         \textcolor{comment}{# Uniform data have been defined when other datas have, but do not recqui
      re explicit export}
00415         \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5995e07de24daa015b8b44b1ae0cada7}{exported_data}[\textcolor{stringliteral}{"uniform"}]):
00416             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a7395c2253695b46bf95cd48ed1be6d3e}{exportData}(\textcolor{stringliteral}{"uniform"})
00417 
00418     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa7aadc5d33a24f0fd5705e363c0fedcb}{checkBrowser}(self):
00419         \textcolor{stringliteral}{"""}
00420 \textcolor{stringliteral}{        Check if the browser is opened or open it}
\hypertarget{navicom_8py_source_l00421}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa7aadc5d33a24f0fd5705e363c0fedcb}{00421} \textcolor{stringliteral}{        """}
00422         \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a32c1346193b73ea8558dd0318ae6932c}{browser_opened}):
00423             \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Launching browser..."})
00424             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.launchBrowser()
00425             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a32c1346193b73ea8558dd0318ae6932c}{browser_opened} = \textcolor{keyword}{True}
00426         \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a32c1346193b73ea8558dd0318ae6932c}{browser_opened})
00427 
00428     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a59edead26b5d02f17a60df055576f5}{exportAnnotations}(self):
00429         \textcolor{stringliteral}{"""}
00430 \textcolor{stringliteral}{        Export samples annotations to NaviCell}
\hypertarget{navicom_8py_source_l00431}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a59edead26b5d02f17a60df055576f5}{00431} \textcolor{stringliteral}{        """}
00432         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa7aadc5d33a24f0fd5705e363c0fedcb}{checkBrowser}()
00433 
00434         \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aff54ed91d1f335cea31829f59d4efb81}{exported_annotations}):
00435             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.sampleAnnotationImport(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.makeData())
00436             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aff54ed91d1f335cea31829f59d4efb81}{exported_annotations} = \textcolor{keyword}{True}
00437 
00438     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5b6fef64cb29988c7a4c07138c03b5c1}{configureDisplay}(self, method, processing="raw"):
00439         \textcolor{stringliteral}{"""}
00440 \textcolor{stringliteral}{        Changes the Color and Size Configuration for the datatable to the one pre
      cised by the user.}
\hypertarget{navicom_8py_source_l00441}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5b6fef64cb29988c7a4c07138c03b5c1}{00441} \textcolor{stringliteral}{        """}
00442         \textcolor{keywordflow}{if} (getBiotype(method, processing) \textcolor{keywordflow}{in} CONTINOUS\_BIOTYPES):
00443             \textcolor{comment}{## Color configuration}
00444             dname = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a51ecb41beebc7636bde73be2e1ffc407}{getDataName}((method, processing))
00445             \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Configuring display for "} + dname)
00446             step\_count = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56628d774db59cb8b06af3801fb6306c}{display_config}.step\_count
00447             \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS]:
00448                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetStepCount(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG\_CO
      LOR, tab, step\_count-1) \textcolor{comment}{# NaviCell has one default step}
00449 
00450             dtable = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing][method].data
00451             maxval = np.nanmax(dtable)
00452             minval = np.nanmin(dtable)
00453             \textcolor{comment}{# Use the same scales for positive and negative values, choose the sm
      allest to enhance contrast}
00454             \textcolor{keywordflow}{if} (minval * maxval < 0):
00455                 \textcolor{keywordflow}{if} (-minval > maxval):
00456                     minval = -maxval
00457                 \textcolor{keywordflow}{elif} (maxval > -minval):
00458                     maxval = -minval
00459             ftable = dtable.flatten()
00460             ftable.sort()
00461 
00462             \textcolor{keywordflow}{if} (len(ftable[np.isnan(ftable)]) > 0):
00463                 navicell\_offset = 1 \textcolor{comment}{# First value is nan}
00464                 \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS]:
00465                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG\_
      COLOR, tab, 0, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56628d774db59cb8b06af3801fb6306c}{display_config}.na\_color)
00466             \textcolor{keywordflow}{else}:
00467                 navicell\_offset = 0
00468 
00469             \textcolor{keywordflow}{if} (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56628d774db59cb8b06af3801fb6306c}{display_config}.zero\_color != \textcolor{stringliteral}{""}):
00470                 half\_count = step\_count//2
00471                 \textcolor{keywordflow}{if} (half\_count != 1):
00472                     \textcolor{comment}{# Negative values}
00473                     \textcolor{keywordflow}{if} (minval > 0): maxval = -1
00474                     step = -minval/half\_count
00475                     values\_list = [signif(val) \textcolor{keywordflow}{for} val \textcolor{keywordflow}{in} np.arange(minval, step/
      2, step)][:-1]
00476                     \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(half\_count):
00477                        value = values\_list[ii]
00478                        color = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56628d774db59cb8b06af3801fb6306c}{display_config}.colors[ii]
00479                        \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GRO
      UPS]:
00480                            self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCell.
      CONFIG\_COLOR, tab, navicell\_offset + ii, value)
00481                            self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCell.
      CONFIG\_COLOR, tab, navicell\_offset + ii, color)
00482                     \textcolor{comment}{# Zero if present}
00483                     offset = half\_count
00484                     \textcolor{keywordflow}{if} (step\_count%2 == 1):
00485                         \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GR
      OUPS]:
00486                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCell
      .CONFIG\_COLOR, tab, offset + navicell\_offset, 0)
00487                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCell
      .CONFIG\_COLOR, tab, offset + navicell\_offset, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56628d774db59cb8b06af3801fb6306c}{display_config}.colors[half\_cou
      nt])
00488                         offset += 1
00489                     \textcolor{comment}{# Positive values}
00490                     \textcolor{keywordflow}{if} (maxval < 0): maxval = 1
00491                     step = maxval/half\_count
00492                     values\_list = [signif(val) \textcolor{keywordflow}{for} val \textcolor{keywordflow}{in} np.arange(0., maxval+st
      ep/2, step)][1:]
00493                     \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(half\_count):
00494                         value = values\_list[ii]
00495                         color = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56628d774db59cb8b06af3801fb6306c}{display_config}.colors[offset + ii]
00496                         \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GR
      OUPS]:
00497                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCell
      .CONFIG\_COLOR, tab, navicell\_offset + offset + ii, value)
00498                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCell
      .CONFIG\_COLOR, tab, navicell\_offset + offset + ii, color)
00499                 \textcolor{keywordflow}{else}:
00500                     \textcolor{keywordflow}{if} (step\_count == 2):
00501                         values\_list = [minval, maxval]
00502                     \textcolor{keywordflow}{else}:
00503                         values\_list = [minval, 0, maxval]
00504                     \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS
      ]:
00505                         \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(values\_list)):
00506                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCell
      .CONFIG\_COLOR, tab, navicell\_offset + ii, values\_list[ii])
00507                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCell
      .CONFIG\_COLOR, tab, navicell\_offset + ii, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56628d774db59cb8b06af3801fb6306c}{display_config}.colors[ii])
00508             \textcolor{keywordflow}{else}:
00509                 \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(step\_count):
00510                     value = np.percentile(dtable, ii*100/(step\_count-1))
00511                     \textcolor{keywordflow}{if} (ii==0): value = minval
00512                     \textcolor{keywordflow}{elif} (ii==(step\_count-1)): value = maxval
00513                     color = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56628d774db59cb8b06af3801fb6306c}{display_config}.colors[ii]
00514                     \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS
      ]:
00515                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCell.CON
      FIG\_COLOR, tab, navicell\_offset + ii, value)
00516                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCell.CON
      FIG\_COLOR, tab, navicell\_offset + ii, color)
00517 
00518             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetSampleMethod(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG\_COL
      OR, NaviCell.METHOD\_CONTINUOUS\_MEDIAN) \textcolor{comment}{# TODO change to MEAN when group mean is c
      orrected to <= instead of <}
00519             \textcolor{keywordflow}{if} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56628d774db59cb8b06af3801fb6306c}{display_config}.use\_absolute\_values:
00520                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetSampleAbsoluteValue(\textcolor{stringliteral}{""}, dname, NaviCell
      .CONFIG\_COLOR, \textcolor{keyword}{True})
00521             \textcolor{keywordflow}{else}:
00522                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetSampleAbsoluteValue(\textcolor{stringliteral}{""}, dname, NaviCell
      .CONFIG\_COLOR, \textcolor{keyword}{False})
00523 
00524             \textcolor{comment}{## Size configuration TODO add zero if present}
00525             \textcolor{keywordflow}{for} glyph\_id \textcolor{keywordflow}{in} range(1, MAX\_GLYPHS):
00526                 \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS]:
00527                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigSetSizeAt(\textcolor{stringliteral}{""}, dname, NaviCell.CONFIG\_S
      IZE, tab, 0, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56628d774db59cb8b06af3801fb6306c}{display_config}.na\_size)
00528 
00529             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.datatableConfigApply(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG\_COLOR)
00530         
00531     \textcolor{comment}{# Display data}
00532     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}(self, perform\_list, default\_samples="all: 1.0\textcolor{stringliteral}{", colors="}\textcolor{stringliteral}{", module
      ='', reset=True):}
00533 \textcolor{stringliteral}{        }\textcolor{stringliteral}{"""}
00534 \textcolor{stringliteral}{        Display data on the NaviCell map}
00535 \textcolor{stringliteral}{        Args :}
00536 \textcolor{stringliteral}{            perform\_list (list of 2-tuples): each tuple must contain the name of 
      the data to display and the mode of display ("glyphN\_(color|size|shape)", "barplo
      t", "heatmap" or "map\_staining"). Barplots and heatmaps cannot be displayed simul
      taneously. Several data types can be specified for heatmaps. Specifying "glyph" (
      without number) will automatically select a new glyph for each data using the sam
      e properties (shape, color or size) in glyphs (maximum of 5 glyphs).}
00537 \textcolor{stringliteral}{            colors : range of colors to use (NOT IMPLEMENTED YET)}
00538 \textcolor{stringliteral}{            default\_samples (str or list of str) : Samples to use. Only the first
       sample is used for glyphs and map staining, all default\_samples from the list ar
      e used for heatmaps and barplots. Use 'all\_samples' to use all default\_samples or
       ['annot1:...:annotn', 'all\_groups'] to use all groups corresponding to the combi
      nations of annot1...annotn.}
\hypertarget{navicom_8py_source_l00539}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{00539} \textcolor{stringliteral}{        """}
00540         \textcolor{comment}{# Correct if the user give a single tuple}
00541         \textcolor{keywordflow}{if} (isinstance(perform\_list, tuple)):
00542             perform\_list = [perform\_list]
00543         \textcolor{keyword}{assert} isinstance(perform\_list, list), \textcolor{stringliteral}{"perform list must be a list"}
00544         \textcolor{keyword}{assert} isinstance(perform\_list[0], tuple) \textcolor{keywordflow}{and} (len(perform\_list[0]) == 2 
      \textcolor{keywordflow}{or} len(perform\_list[0]) == 3), \textcolor{stringliteral}{"perform list must be a list of (2/3)-tuples"}
00545         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa7aadc5d33a24f0fd5705e363c0fedcb}{checkBrowser}()
00546         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a59edead26b5d02f17a60df055576f5}{exportAnnotations}()
00547         \textcolor{keywordflow}{if} (reset):
00548             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a379f15a87ba5c41c3501e9f386102c05}{resetDisplay}()
00549 
00550         \textcolor{comment}{# Preprocess the perform list to get valid data\_name, and export data tha
      t have not been exported yet}
00551         \textcolor{keywordflow}{if} (DEBUG\_NAVICOM):
00552             \textcolor{keywordflow}{print}(perform\_list)
00553         \textcolor{keywordflow}{for} perf\_id \textcolor{keywordflow}{in} range(len(perform\_list)):
00554             data\_name = perform\_list[perf\_id][0]
00555             perform = perform\_list[perf\_id]
00556             \textcolor{keywordflow}{if} (isinstance(data\_name, str)):
00557                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} data\_name \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1d7072ae29e32d7ddd1da9cc5def7199}{associated_data}):
00558                     data\_name = data\_name + \textcolor{stringliteral}{"\_raw"}
00559                 data\_name = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1d7072ae29e32d7ddd1da9cc5def7199}{associated_data}[data\_name]
00560             processing = data\_name[0]
00561             method = data\_name[1]
00562             \textcolor{keyword}{assert} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a255d56e997ddcc653d8f06c741ea13}{processings}, \textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{"
       does not exist"}
00563             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a7395c2253695b46bf95cd48ed1be6d3e}{exportData}(method, processing)
00564             \textcolor{keywordflow}{if} (len(perform) >= 3 \textcolor{keywordflow}{and} perform[2] != default\_samples):
00565                 perform\_list[perf\_id] = (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a68646454fe1481b0065d2f43548319df}{data_names}[processing][method], per
      form[1], perform[2])
00566             \textcolor{keywordflow}{else}:
00567                 perform\_list[perf\_id] = (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a68646454fe1481b0065d2f43548319df}{data_names}[processing][method], per
      form[1], \textcolor{stringliteral}{''})
00568         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a7395c2253695b46bf95cd48ed1be6d3e}{exportData}(\textcolor{stringliteral}{"uniform"})
00569 
00570         \textcolor{comment}{# Control that the user does not try to display to many data or use sever
      al times the same display}
00571         \textcolor{keywordflow}{if} (\textcolor{keyword}{True}):
00572             \textcolor{keywordflow}{for} gtype \textcolor{keywordflow}{in} GLYPH\_TYPES:
00573                 glyph = \{gtype:[\textcolor{keyword}{False}] * MAX\_GLYPHS\}
00574             sample\_for\_glyph = [\textcolor{keyword}{False}] * MAX\_GLYPHS
00575             glyph\_samples = [\textcolor{stringliteral}{""}] * MAX\_GLYPHS
00576             glyph\_set = \textcolor{keyword}{False}
00577             heatmap = \textcolor{keyword}{False}
00578             barplot = \textcolor{keyword}{False}
00579             barplot\_data = \textcolor{stringliteral}{""}
00580             map\_staining = \textcolor{keyword}{False}
00581             default\_samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6536cf86235df90cb7443c23f11870e4}{processSampleSelection}(default\_samples)
00582             samples = default\_samples
00583             lastWasDefault = \textcolor{keyword}{True}
00584             valid\_default = (len(default\_samples) == 1 \textcolor{keywordflow}{and} default\_samples != \textcolor{stringliteral}{"al
      l\_groups"} \textcolor{keywordflow}{and} default\_samples != \textcolor{stringliteral}{"all\_samples"})
00585         \textcolor{comment}{# Perform the display depending of the selected mode}
00586         \textcolor{keywordflow}{for} perform \textcolor{keywordflow}{in} perform\_list:
00587             all\_samples = \textcolor{keyword}{False}
00588             all\_groups = \textcolor{keyword}{False}
00589             data\_name = perform[0]
00590             dmode = perform[1]
00591             dmode = dmode.lower()
00592             \textcolor{comment}{# Check groups in NaviCell and get a valid list of samples, reload de
      fault if not the last used}
00593             \textcolor{keywordflow}{if} (perform[2] == \textcolor{stringliteral}{''}):
00594                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} lastWasDefault):
00595                     samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6536cf86235df90cb7443c23f11870e4}{processSampleSelection}(default\_samples)
00596                     lastWasDefault = \textcolor{keyword}{True}
00597             \textcolor{keywordflow}{else}:
00598                 samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6536cf86235df90cb7443c23f11870e4}{processSampleSelection}(perform[2])
00599                 lastWasDefault = \textcolor{keyword}{False}
00600             \textcolor{keywordflow}{if} (samples == \textcolor{stringliteral}{"all\_groups"}):
00601                 all\_groups = \textcolor{keyword}{True}
00602             \textcolor{keywordflow}{elif} (samples == \textcolor{stringliteral}{"all\_samples"}):
00603                 all\_samples = \textcolor{keyword}{True}
00604 
00605             \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"^(glyph|color|size|shape)"}, dmode)):
00606                 glyph\_set = \textcolor{keyword}{True}
00607                 \textcolor{comment}{# Extract the glyph id and the setup}
00608                 parse\_setup = dmode.split(\textcolor{stringliteral}{"\_"})
00609                 glyph\_setup = parse\_setup
00610                 \textcolor{keywordflow}{if} (len(parse\_setup) == 2):
00611                     \textcolor{keywordflow}{try}:
00612                         glyph\_setup = [parse\_setup[1] + str(int(parse\_setup[0][-1
      ]))]
00613                     \textcolor{keywordflow}{except} ValueError:
00614                         glyph\_setup = [parse\_setup[1]]
00615                 \textcolor{keywordflow}{elif} (len(parse\_setup) != 1):
00616                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Glyph specification '"} + dmode + \textcolor{stringliteral}{"' incorre
      ct"})
00617                 \textcolor{keywordflow}{try}:
00618                     glyph\_number = int(glyph\_setup[0][-1])
00619                     glyph\_type = glyph\_setup[0][:-1]
00620                 \textcolor{keywordflow}{except} ValueError:
00621                     glyph\_type = glyph\_setup[0]
00622                     glyph\_number = 1
00623                     \textcolor{keywordflow}{while} (glyph[glyph\_type][glyph\_number-1]):
00624                         glyph\_number += 1
00625                 glyph\_id = glyph\_number - 1
00626                 
00627                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph\_number \textcolor{keywordflow}{in} range(1, MAX\_GLYPHS+1)):
00628                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Glyph number must be in [1,"} + str(MAX\_GLYP
      HS) + \textcolor{stringliteral}{"]"})
00629                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph\_type \textcolor{keywordflow}{in} GLYPH\_TYPES):
00630                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Glyph type must be one of "} + str(GLYPH\_TYP
      ES))
00631                 \textcolor{keywordflow}{if} (glyph[glyph\_type][glyph\_number-1]):
00632                     \textcolor{keywordflow}{raise} ValueError(glyph\_type + \textcolor{stringliteral}{" for glyph "} + str(glyph\_numbe
      r) + \textcolor{stringliteral}{" has already been specified"})
00633                 glyph[glyph\_type][glyph\_number-1] = \textcolor{keyword}{True}
00634                 \textcolor{keywordflow}{if} (len(samples) != 1 \textcolor{keywordflow}{or} samples == \textcolor{stringliteral}{"all\_groups"} \textcolor{keywordflow}{or} samples == \textcolor{stringliteral}{"a
      ll\_samples"}):
00635                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Only one group or sample can be used for gl
      yphs"})
00636 
00637                 \textcolor{keywordflow}{if} (lastWasDefault):
00638                     \textcolor{keywordflow}{pass}
00639                 \textcolor{keywordflow}{elif} (glyph\_samples[glyph\_id] == \textcolor{stringliteral}{""}):
00640                     glyph\_samples[glyph\_id] = samples[0]
00641                     sample\_for\_glyph[glyph\_id] = \textcolor{keyword}{True}
00642                 \textcolor{keywordflow}{elif} (glyph\_samples[glyph\_id] != samples[0]):
00643                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Only one sample can be specified per glyph"
      })
00644 
00645                 cmd=\textcolor{stringliteral}{"self.nv.glyphEditorSelect"} + glyph\_type.capitalize() + \textcolor{stringliteral}{"Data
      table('"} + module +  \textcolor{stringliteral}{"', "} + str(glyph\_number) + \textcolor{stringliteral}{", '"} + data\_name + \textcolor{stringliteral}{"')"}
00646                 \textcolor{keywordflow}{if} (DEBUG\_NAVICOM):
00647                     \textcolor{keywordflow}{print}(cmd)
00648                 exec(cmd)
00649             \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"map\_?staining"}, dmode)):
00650                 \textcolor{keyword}{assert} valid\_default, \textcolor{stringliteral}{"Only one sample can be used for map staini
      ng"}
00651                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} map\_staining):
00652                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.mapStainingEditorSelectDatatable(module, data\_name)
00653                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.mapStainingEditorSelectSample(module, samples[0])
00654                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.mapStainingEditorApply(module)
00655                     map\_staining = \textcolor{keyword}{True}
00656                 \textcolor{keywordflow}{else}:
00657                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Map staining can only be applied once, use 
      a separate call to the display function to change map staining"})
00658             \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"heatmap"}, dmode)):
00659                 \textcolor{keywordflow}{if} (barplot):
00660                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Heatmaps and barplots cannot be applied sim
      ultaneously, use a separate call to the display function to perform the heatmap"})
      
00661                 heatmap = \textcolor{keyword}{True}
00662                 \textcolor{comment}{# Select data}
00663                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.heatmapEditorSelectDatatable(module, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a35fe0d421abe7e1b08fc92ca58b689db}{hdid}, data\_name
      )
00664                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a35fe0d421abe7e1b08fc92ca58b689db}{hdid} += 1
00665                 \textcolor{comment}{# Select samples}
00666                 \textcolor{keywordflow}{if} (all\_samples):
00667                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.heatmapEditorAllSamples(module)
00668                 \textcolor{keywordflow}{elif} (all\_groups):
00669                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.heatmapEditorAllGroups(module)
00670                 \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac8b826435d1ae69420151967b3a872eb}{hsid} == 0):
00671                     \textcolor{keywordflow}{for} spl \textcolor{keywordflow}{in} samples:
00672                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.heatmapEditorSelectSample(module, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac8b826435d1ae69420151967b3a872eb}{hsid}, spl)
      
00673                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac8b826435d1ae69420151967b3a872eb}{hsid} += 1
00674                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.heatmapEditorApply(module)
00675             \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"barplot"}, dmode)):
00676                 \textcolor{keywordflow}{if} (heatmap):
00677                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Heatmaps and barplots cannot be applied sim
      ultaneously, use a separate call to the display function to perform the barplot"})
      
00678                 \textcolor{comment}{# Check that it does not try to add new data, and simply adds sam
      ples # TODO Remove as samples cannot be added (resetDisplay at the beginning)}
00679                 \textcolor{keywordflow}{if} (barplot \textcolor{keywordflow}{and} data\_name != barplot\_data \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} re.search(\textcolor{stringliteral}{"all|
      groups|samples"}, data\_name)):
00680                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Barplot has already been set with different
       data, use a separate call to the display function to perform another barplot"})
00681                 barplot = \textcolor{keyword}{True}
00682                 barplot\_data = data\_name
00683                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.barplotEditorSelectDatatable(module, data\_name)
00684                 \textcolor{comment}{# Select samples}
00685                 \textcolor{keywordflow}{if} (all\_samples):
00686                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.barplotEditorAllSamples(module)
00687                 \textcolor{keywordflow}{elif} (all\_groups):
00688                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.barplotEditorAllGroups(module)
00689                 \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1f652094a5c16ca0b721856f5e5aadf2}{bid} == 0):
00690                     \textcolor{keywordflow}{for} spl \textcolor{keywordflow}{in} samples:
00691                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.barplotEditorSelectSample(module, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1f652094a5c16ca0b721856f5e5aadf2}{bid}, spl)
00692                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1f652094a5c16ca0b721856f5e5aadf2}{bid} += 1
00693                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.barplotEditorApply(module)
00694             \textcolor{keywordflow}{else}:
00695                 \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"'"} + dmode + \textcolor{stringliteral}{"' drawing mode does not exist"})
00696 
00697         \textcolor{comment}{# Check that datatables are selected for all glyphs features (until defau
      lt has been added)}
00698         \textcolor{comment}{# or complete, then apply the glyphs configuration}
00699         default\_samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6536cf86235df90cb7443c23f11870e4}{processSampleSelection}(default\_samples)
00700         \textcolor{keywordflow}{if} (glyph\_set):
00701             \textcolor{keywordflow}{for} glyph\_id \textcolor{keywordflow}{in} range(MAX\_GLYPHS):
00702                 nsets = sum(1 \textcolor{keywordflow}{for} cs \textcolor{keywordflow}{in} GLYPH\_TYPES \textcolor{keywordflow}{if} glyph[cs][glyph\_id])
00703                 \textcolor{keywordflow}{if} (nsets > 0):
00704                     \textcolor{keywordflow}{if} (sample\_for\_glyph[glyph\_id]):
00705                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.glyphEditorSelectSample(module, glyph\_id+1, self.
      \hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6536cf86235df90cb7443c23f11870e4}{processSampleSelection}(glyph\_samples[glyph\_id]))
00706                     \textcolor{keywordflow}{elif} (valid\_default):
00707                         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Using default sample for glyph "} + str(glyph\_id+1)
      )
00708                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.glyphEditorSelectSample(module, glyph\_id+1, defau
      lt\_samples[0])
00709                     \textcolor{keywordflow}{else}:
00710                         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"No samples specified for glyph "} + str(
      glyph\_id+1) + \textcolor{stringliteral}{" and default\_samples is invalid"})
00711                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph[\textcolor{stringliteral}{"color"}][glyph\_id]):
00712                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.glyphEditorSelectColorDatatable(module, glyph\_id+
      1, \textcolor{stringliteral}{"uniform"})
00713                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph[\textcolor{stringliteral}{"shape"}][glyph\_id]):
00714                        self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.glyphEditorSelectShapeDatatable(module, glyph\_id+1
      , \textcolor{stringliteral}{"uniform"})
00715                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph[\textcolor{stringliteral}{"size"}][glyph\_id]):
00716                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.glyphEditorSelectSizeDatatable(module, glyph\_id+1
      , \textcolor{stringliteral}{"uniform"})
00717                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.glyphEditorApply(module, glyph\_id+1)
00718 
00719     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a379f15a87ba5c41c3501e9f386102c05}{resetDisplay}(self):
00720         \textcolor{stringliteral}{"""}
00721 \textcolor{stringliteral}{        Reset the data and samples selections in NaviCell}
\hypertarget{navicom_8py_source_l00722}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a379f15a87ba5c41c3501e9f386102c05}{00722} \textcolor{stringliteral}{        """}
00723         \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1f652094a5c16ca0b721856f5e5aadf2}{bid}):
00724             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.barplotEditorSelectSample(\textcolor{stringliteral}{''}, ii, \textcolor{stringliteral}{''})
00725         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.barplotEditorSelectDatatable(\textcolor{stringliteral}{''}, \textcolor{stringliteral}{''})
00726         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.drawingConfigSelectBarplot(\textcolor{stringliteral}{''}, \textcolor{keyword}{False})
00727 
00728         \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac8b826435d1ae69420151967b3a872eb}{hsid}):
00729             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.heatmapEditorSelectSample(\textcolor{stringliteral}{''}, ii, \textcolor{stringliteral}{''})
00730         \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a35fe0d421abe7e1b08fc92ca58b689db}{hdid}):
00731             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.heatmapEditorSelectDatatable(\textcolor{stringliteral}{''}, ii, \textcolor{stringliteral}{''})
00732         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.drawingConfigSelectHeatmap(\textcolor{stringliteral}{''}, \textcolor{keyword}{False})
00733 
00734         \textcolor{keywordflow}{for} gid \textcolor{keywordflow}{in} range(1, MAX\_GLYPHS):
00735             \textcolor{keywordflow}{for} gt \textcolor{keywordflow}{in} GLYPH\_TYPES:
00736                 exec(\textcolor{stringliteral}{"self.nv.glyphEditorSelect"} + gt.capitalize() + \textcolor{stringliteral}{"Datatable('
      ', "} + str(gid) + \textcolor{stringliteral}{", '')"})
00737             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.glyphEditorSelectSample(\textcolor{stringliteral}{''}, gid, \textcolor{stringliteral}{''})
00738             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.drawingConfigSelectGlyph(\textcolor{stringliteral}{''}, gid, \textcolor{keyword}{False})
00739         
00740         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.drawingConfigSelectMapStaining(\textcolor{stringliteral}{''}, \textcolor{keyword}{False})
00741         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.drawingConfigApply(\textcolor{stringliteral}{''})
00742 
00743         \textcolor{comment}{# Reset the counters}
00744         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1f652094a5c16ca0b721856f5e5aadf2}{bid} = 0
00745         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac8b826435d1ae69420151967b3a872eb}{hsid} = 0
00746         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a35fe0d421abe7e1b08fc92ca58b689db}{hdid} = 0
00747 
00748     \textcolor{keyword}{def }resetAnnotations(self, module=''):
00749         \textcolor{keywordflow}{for} annot \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.annotations:
00750             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.sampleAnnotationSelectAnnotation(module, annot, \textcolor{keyword}{False})
00751         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.sampleAnnotationApply(module)
00752 
00753     \textcolor{keyword}{def }selectAnnotations(self, annotations, module=''):
00754         \textcolor{keywordflow}{if} (isinstance(annotations, str)):
00755             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.sampleAnnotationSelectAnnotation(module, annotations, \textcolor{keyword}{True})
00756         \textcolor{keywordflow}{elif} (isinstance(annotations, list)):
00757             \textcolor{keywordflow}{for} annot \textcolor{keywordflow}{in} annotations:
00758                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.sampleAnnotationSelectAnnotation(module, annot, \textcolor{keyword}{True})
00759         \textcolor{keywordflow}{else}:
00760             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"'annotations' must be a string or a list"})
00761         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv}.sampleAnnotationApply(module)
00762 
00763     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6536cf86235df90cb7443c23f11870e4}{processSampleSelection}(self, current\_samples):
00764         \textcolor{stringliteral}{"""}
00765 \textcolor{stringliteral}{        Process a list of samples or groups to a list of samples/groups names exp
      ortable to NaviCell or to "all\_groups"/"all\_samples" for heatmap and barplot, and
       select the correct groups in NaviCell}
\hypertarget{navicom_8py_source_l00766}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6536cf86235df90cb7443c23f11870e4}{00766} \textcolor{stringliteral}{        """}
00767 
00768         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab92b6e95417e01126d9d73903acc2a3b}{resetAnnotations}()
00769         \textcolor{comment}{# Make sure current\_samples is a list}
00770         all\_groups = \textcolor{keyword}{False}
00771         \textcolor{keywordflow}{if} (isinstance(current\_samples, str)):
00772             current\_samples = [current\_samples]
00773 
00774         \textcolor{comment}{# It is possible to select all samples or all groups on heatmap and barpl
      ot}
00775         \textcolor{keywordflow}{if} (current\_samples[0] == \textcolor{stringliteral}{"all\_samples"} \textcolor{keywordflow}{or} current\_samples[0] == \textcolor{stringliteral}{"samples
      "}):
00776             \textcolor{keywordflow}{return} \textcolor{stringliteral}{"all\_samples"}
00777         \textcolor{keywordflow}{elif} (current\_samples[0] == \textcolor{stringliteral}{"all"} \textcolor{keywordflow}{or} current\_samples[0] == \textcolor{stringliteral}{"all: 1.0"}):
00778             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad298207a958acd2cee82c7df7eace0d3}{selectAnnotations}(\textcolor{stringliteral}{"all"})
00779             \textcolor{keywordflow}{return} [\textcolor{stringliteral}{"all: 1.0"}]
00780         \textcolor{keywordflow}{elif} (len(current\_samples) > 1 \textcolor{keywordflow}{and} (current\_samples[1] == \textcolor{stringliteral}{"all\_groups"} \textcolor{keywordflow}{or
      } current\_samples[1] == \textcolor{stringliteral}{"groups"})):
00781             all\_groups = \textcolor{keyword}{True}
00782 
00783         refGroupsList = []
00784         first\_groups = \textcolor{keyword}{True}
00785         \textcolor{comment}{# Select the groups that must be selected to produce the composite groups
       required}
00786         \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} current\_samples:
00787             groups = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af04ea16f3ccb0d883f5b01471c0c1a6f}{processGroupsName}(sample)[0]
00788             \textcolor{comment}{# Check that all groups are compatible in the annotations selected (b
      ecause lower order composition are not generated). No check for individual sample
      s}
00789             \textcolor{keywordflow}{if} (len(groups) >= 1):
00790                 \textcolor{keywordflow}{if} (first\_groups): \textcolor{comment}{# Select the set of annotations for the first 
      group}
00791                     \textcolor{keywordflow}{if} (DEBUG\_NAVICOM):
00792                         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Selecting "} + str(groups))
00793                     \textcolor{keywordflow}{for} group \textcolor{keywordflow}{in} groups:
00794                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad298207a958acd2cee82c7df7eace0d3}{selectAnnotations}(group) 
00795                         refGroupsList.append(group)
00796                         first\_groups = \textcolor{keyword}{False}
00797                 \textcolor{keywordflow}{else}: \textcolor{comment}{# Control that all other groups are compatible}
00798                         \textcolor{keyword}{assert} len(group)==0 \textcolor{keywordflow}{or} len(refGroupsList)==0 \textcolor{keywordflow}{or} len(grou
      p)==len(refGroupsList), \textcolor{stringliteral}{"Groups combinations are not compatible, different number
       of groups"}
00799                         \textcolor{keywordflow}{for} group \textcolor{keywordflow}{in} groups:
00800                             \textcolor{keyword}{assert} group \textcolor{keywordflow}{in} refGroupsList, \textcolor{stringliteral}{"Groups combinations a
      re not compatibles as "} + group + \textcolor{stringliteral}{" is not in "} + str(refGroupsList)
00801 
00802         \textcolor{keywordflow}{if} (all\_groups):
00803             \textcolor{keywordflow}{return} \textcolor{stringliteral}{"all\_groups"}
00804         \textcolor{keywordflow}{return} current\_samples
00805 
00806     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af04ea16f3ccb0d883f5b01471c0c1a6f}{processGroupsName}(self, groupName):
00807         \textcolor{stringliteral}{"""}
00808 \textcolor{stringliteral}{        Process a group selection string and return the names of the individual g
      roups to select and the corresponding values selected.}
\hypertarget{navicom_8py_source_l00809}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af04ea16f3ccb0d883f5b01471c0c1a6f}{00809} \textcolor{stringliteral}{        """}
00810         selections = groupName.split(\textcolor{stringliteral}{";"})
00811         groups = list()
00812         values = list()
00813         \textcolor{keywordflow}{for} select \textcolor{keywordflow}{in} selections:
00814             subName = select.split(\textcolor{stringliteral}{":"})
00815             group = subName[0].strip()
00816             \textcolor{keywordflow}{if} (group \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.annotations):
00817                 value = subName[1].strip()
00818                 groups.append(group)
00819                 \textcolor{keywordflow}{try}:
00820                     values.append(float(value))
00821                 \textcolor{keywordflow}{except} ValueError:
00822                     values.append(value)
00823             \textcolor{keywordflow}{elif} (\textcolor{keywordflow}{not} (group \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.samples \textcolor{keywordflow}{or} re.match(\textcolor{stringliteral}{"sub"}, group
      ) \textcolor{keywordflow}{or} group == \textcolor{stringliteral}{"NaN"})):
00824                 \textcolor{keywordflow}{if} (len(subName) > 1):
00825                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Annotation "} + group + \textcolor{stringliteral}{" does not exist"})
00826                 \textcolor{keywordflow}{else}:
00827                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Sample "} + group + \textcolor{stringliteral}{" does not exist"})
00828         \textcolor{keywordflow}{return}((groups, values))
00829 
00830     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a018f936de625af8a5dd7e8250ede6483}{displayMethylome}(self, samples="all: 1.0\textcolor{stringliteral}{", processing="}raw\textcolor{stringliteral}{", background="
      }mRNA\textcolor{stringliteral}{", methylation="}glyph\textcolor{stringliteral}{"):}
00831 \textcolor{stringliteral}{        }\textcolor{stringliteral}{"""}
00832 \textcolor{stringliteral}{            Display the methylation data as glyphs or heatmap on the NaviCell map
      , with mRNA expression of gene CNV as map staining}
00833 \textcolor{stringliteral}{            Args:}
00834 \textcolor{stringliteral}{                background (str) : should genes, mRNA or no data be used for the 
      map staining}
00835 \textcolor{stringliteral}{                processing (str) : should the processed data be used}
\hypertarget{navicom_8py_source_l00836}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a018f936de625af8a5dd7e8250ede6483}{00836} \textcolor{stringliteral}{        """}
00837         \textcolor{comment}{# Groups cannot be used for now because of limitations in NaviCell unless
       the median is taken as grouping operation}
00838         mrna\_alias = [\textcolor{stringliteral}{"MRNA"}] \textcolor{comment}{# TODO Define what to put here}
00839         gene\_alias = [\textcolor{stringliteral}{"CNV"}, \textcolor{stringliteral}{"CNA"}, \textcolor{stringliteral}{"CCNA"}, \textcolor{stringliteral}{"CCNV"}, \textcolor{stringliteral}{"DNA"}]
00840         background = background.upper()
00841         \textcolor{keyword}{assert} background \textcolor{keywordflow}{in} mrna\_alias + gene\_alias + [\textcolor{stringliteral}{"NO"}, \textcolor{stringliteral}{""}], \textcolor{stringliteral}{"Select either
       genes, mRNA or no data for the map staining"}
00842         \textcolor{keyword}{assert} methylation \textcolor{keywordflow}{in} [\textcolor{stringliteral}{"glyph"}, \textcolor{stringliteral}{"glyphs"}, \textcolor{stringliteral}{"heatmap"}, \textcolor{stringliteral}{"size"}, \textcolor{stringliteral}{"glyph\_size"
      }], \textcolor{stringliteral}{"Cannot use "} + methylation + \textcolor{stringliteral}{" to display methylation data"}
00843         \textcolor{keywordflow}{if} (methylation != \textcolor{stringliteral}{"heatmap"}): methylation=\textcolor{stringliteral}{"size"}
00844         \textcolor{keyword}{assert} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}, \textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{" does not e
      xist"}
00845 
00846         \textcolor{comment}{# Select all methylation data and display as heatmap}
00847         disp\_selection = list()
00848         \textcolor{keywordflow}{for} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing]:
00849             included = method.lower() \textcolor{keywordflow}{in} METHODS\_TYPE
00850             \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"methylation"}, method.lower()) \textcolor{keywordflow}{or} (included \textcolor{keywordflow}{and} METHODS
      \_TYPE[method.lower()] == \textcolor{stringliteral}{"methylation"})):
00851                 disp\_selection.append((self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a68646454fe1481b0065d2f43548319df}{data_names}[processing][method], methy
      lation)) \textcolor{comment}{# TODO Change to barplot when several datatables can be used}
00852         \textcolor{comment}{# Display mRNA or gene data as map staining}
00853         \textcolor{keywordflow}{if} (background \textcolor{keywordflow}{in} mrna\_alias):
00854             \textcolor{keywordflow}{for} mrna \textcolor{keywordflow}{in} TYPES\_SPEC[\textcolor{stringliteral}{"mRNA"}][0]:
00855                 \textcolor{keywordflow}{if} (mrna \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing]):
00856                     disp\_selection.append((self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a68646454fe1481b0065d2f43548319df}{data_names}[processing][mrna], \textcolor{stringliteral}{"ma
      p\_staining"}))
00857                     \textcolor{keywordflow}{break}
00858         \textcolor{keywordflow}{elif} (background \textcolor{keywordflow}{in} gene\_alias):
00859             \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} TYPES\_SPEC[\textcolor{stringliteral}{"cCNA"}]+TYPES\_SPEC[\textcolor{stringliteral}{"dCNA"}]:
00860                 \textcolor{keywordflow}{if} (gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing]):
00861                     disp\_selection.append((self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a68646454fe1481b0065d2f43548319df}{data_names}[processing][mrna], \textcolor{stringliteral}{"ma
      p\_staining"}))
00862                     \textcolor{keywordflow}{break}
00863         \textcolor{keywordflow}{if} (DEBUG\_NAVICOM):
00864             \textcolor{keywordflow}{print}(disp\_selection)
00865             \textcolor{keywordflow}{print}(samples)
00866         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}(disp\_selection, samples)
00867 
00868     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a001dadf6f3dc0c77ba5b14da621b110d}{displayTranscriptome}(self, dataName, group="all: 1.0\textcolor{stringliteral}{", samplesDisplay="}\textcolor{stringliteral}{",
       samples=list(), binsNb=10):}
00869 \textcolor{stringliteral}{        }\textcolor{stringliteral}{"""}
00870 \textcolor{stringliteral}{        Display one transcriptome data as map staining, with optionnaly some extr
      a displays (samples as heatmap or barplot, mutations as glyphs, a glyph for the m
      ost highly expressed genes)}
00871 \textcolor{stringliteral}{        Args:}
00872 \textcolor{stringliteral}{            - dataName (str or tuple): name or identifier of the data.}
00873 \textcolor{stringliteral}{            - group (str): Identifier of the group to display}
00874 \textcolor{stringliteral}{            - samplesDisplay (str): Channel where the individual samples should b
      e displayed (heatmap or barplot)}
00875 \textcolor{stringliteral}{            - samples (list or str): list of samples to display, or a string spec
      ifying how such a list should be built ('quantiles' to get the distribution of va
      lues)}
00876 \textcolor{stringliteral}{            - nbOfSamples (int): number of individual samples to display, ignored
       if samples is a list}
\hypertarget{navicom_8py_source_l00877}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a001dadf6f3dc0c77ba5b14da621b110d}{00877} \textcolor{stringliteral}{        """}
00878         allowedDisplays = [\textcolor{stringliteral}{""}, \textcolor{stringliteral}{"heatmap"}, \textcolor{stringliteral}{"barplot"}]
00879         \textcolor{keyword}{assert} samplesDisplay \textcolor{keywordflow}{in} allowedDisplays, \textcolor{stringliteral}{"samplesDisplay must one of "} +
       str(allowedDisplays)
00880         dataName = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a51ecb41beebc7636bde73be2e1ffc407}{getDataName}(dataName)
00881         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}([(dataName, \textcolor{stringliteral}{"map\_staining"})], group)
00882         \textcolor{keywordflow}{if} (samplesDisplay != \textcolor{stringliteral}{""}):
00883             \textcolor{keywordflow}{if} (isinstance(samples, list)):
00884                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}([(dataName, samplesDisplay)], samples, reset=\textcolor{keyword}{False})
00885             \textcolor{keywordflow}{elif} (isinstance(samples, str)):
00886                 \textcolor{keywordflow}{if} (samples == \textcolor{stringliteral}{"quantiles"}):
00887                     distName, distSamples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a8d417589ac7fb5ab3c26ccd025938504}{generateDistributionData}(dataNam
      e, group, binsNb)
00888                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"distribution"}][distName].exportToNaviCell(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af740fe52f9f3cfc076ae88ca696bd05e}{nv},
       TYPES\_BIOTYPE[\textcolor{stringliteral}{'mRNA'}], distName)
00889                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}([(distName, samplesDisplay)], distSamples, reset
      =\textcolor{keyword}{False})
00890                 \textcolor{keywordflow}{else}:
00891                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}([(dataName, samplesDisplay)], [samples], reset=\textcolor{keyword}{F
      alse})
00892 
00893     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a8d417589ac7fb5ab3c26ccd025938504}{generateDistributionData}(self, dataName, group, binsNb=10):
00894         \textcolor{stringliteral}{"""}
00895 \textcolor{stringliteral}{        Compute distribution of values for all genes for one type of data. Use th
      e same scale for all genes. The distribution is centered on 0 if it is included, 
      so that it is easy to see if a gene is over- or under-expressed.}
\hypertarget{navicom_8py_source_l00896}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a8d417589ac7fb5ab3c26ccd025938504}{00896} \textcolor{stringliteral}{        """}
00897         groups, values = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_af04ea16f3ccb0d883f5b01471c0c1a6f}{processGroupsName}(group)
00898         \textcolor{keywordflow}{if} (len(groups) < 1):
00899             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Cannot generate a distribution without a valid grou
      p"})
00900         \textcolor{comment}{# Each distribution }
00901         distName = \textcolor{stringliteral}{"distribution\_"} + dataName + \textcolor{stringliteral}{"\_"} + re.sub(\textcolor{stringliteral}{" "}, \textcolor{stringliteral}{"\_"}, group) + \textcolor{stringliteral}{"
      \_"} + str(binsNb)
00902         distSamples = [\textcolor{stringliteral}{"sub"} + str(ii) \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(binsNb)] + [\textcolor{stringliteral}{"NaN"}]
00903         \textcolor{keywordflow}{if} (distName \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"distribution"}]):
00904             \textcolor{keywordflow}{return}(distName)
00905 
00906         \textcolor{comment}{# Identify the samples selected by the group definition}
00907         samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.samplesPerCategory[groups[0]][values[0]]
00908         \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} range(1, len(groups)):
00909             to\_drop = list()
00910             \textcolor{keywordflow}{for} spl \textcolor{keywordflow}{in} samples:
00911                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} spl \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.samplesPerCategory[groups[idx]][v
      alues[idx]]):
00912                     to\_drop.append(spl)
00913             \textcolor{keywordflow}{for} spl \textcolor{keywordflow}{in} to\_drop:
00914                 samples.remove(spl)
00915 
00916         \textcolor{comment}{# Build the distribution dataset}
00917         data = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad675e899836271ff4f2fd4bd17ea81d9}{getData}(dataName)[samples]
00918         minq = np.nanmin(data.data)
00919         maxq = np.nanmax(data.data)
00920         step = (maxq-minq)/binsNb
00921         \textcolor{keywordflow}{if} (minq * maxq < 0):
00922             step = max(-minq/(binsNb/2), maxq/(binsNb/2))
00923         qseq = np.arange(minq, maxq + step * 1.01, step)
00924         newData = list()
00925         \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} data.genes:
00926             newData.append([0 \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(binsNb+1)])
00927             \textcolor{keywordflow}{for} value \textcolor{keywordflow}{in} data[gene]:
00928                 \textcolor{keywordflow}{if} (np.isnan(value)):
00929                     newData[-1][binsNb] += 1
00930                 \textcolor{keywordflow}{else}:
00931                     idx = 0
00932                     \textcolor{keywordflow}{while} (value > qseq[idx+1]):
00933                         idx += 1
00934                     newData[-1][idx] += 1
00935         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"distribution"}][distName] = NaviData(newData, data.genes, distS
      amples)
00936         \textcolor{comment}{# Fill the dictionnaries to avoid display bugs}
00937         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a68646454fe1481b0065d2f43548319df}{data_names}[\textcolor{stringliteral}{'distribution'}][distName] = distName
00938         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1d7072ae29e32d7ddd1da9cc5def7199}{associated_data}[distName] = (\textcolor{stringliteral}{'distribution'}, distName)
00939 
00940         \textcolor{keywordflow}{return}(distName, distSamples)
00941 
00942     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a66a4bf5d38161f7ca29f030037b3565b}{colorsOverlay}(self, red="uniform", green="uniform", blue="uniform", proce
      ssing=""):
00943         \textcolor{stringliteral}{"""}
00944 \textcolor{stringliteral}{        Create a dataset where values are colors. The color is calculated accordi
      ng to three datasets.}
00945 \textcolor{stringliteral}{}
00946 \textcolor{stringliteral}{        Args:}
00947 \textcolor{stringliteral}{            red : data name or tuple (processing, method)}
00948 \textcolor{stringliteral}{            green : data name or tuple (processing, method)}
00949 \textcolor{stringliteral}{            blue : data name or tuple (processing, method)}
\hypertarget{navicom_8py_source_l00950}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a66a4bf5d38161f7ca29f030037b3565b}{00950} \textcolor{stringliteral}{        """}
00951         \textcolor{keyword}{assert} red != \textcolor{stringliteral}{"uniform"} \textcolor{keywordflow}{or} green != \textcolor{stringliteral}{"uniform"} \textcolor{keywordflow}{or} blue != \textcolor{stringliteral}{"uniform"}, \textcolor{stringliteral}{"You 
      must choose a datatable"}
00952         \textcolor{comment}{# TODO export to NaviCell and display}
00953         colors = [red, green, blue]
00954         mset = \textcolor{stringliteral}{""}
00955         \textcolor{comment}{# Empty string table}
00956         dims = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"uniform"}].data.shape
00957         dataset = np.zeros(dims, \textcolor{stringliteral}{'<U7'})
00958         \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(dims[0]):
00959             \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(dims[1]):
00960                 dataset[rr,cc] = \textcolor{stringliteral}{"#"}
00961         \textcolor{keywordflow}{for} col \textcolor{keywordflow}{in} colors:
00962             \textcolor{keywordflow}{if} (col == \textcolor{stringliteral}{"uniform"}):
00963                 \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(dims[0]):
00964                     \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(dims[1]):
00965                         dataset[rr,cc] += \textcolor{stringliteral}{"00"} \textcolor{comment}{# Default to black}
00966             \textcolor{keywordflow}{else}:
00967                 \textcolor{comment}{# Pick the datatable}
00968                 \textcolor{keywordflow}{if} (processing == \textcolor{stringliteral}{""}):
00969                     processing, method = getDataTuple(col)
00970                 \textcolor{keywordflow}{elif} (\textcolor{keywordflow}{not} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}):
00971                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{" does not exis
      t"})
00972                 \textcolor{keywordflow}{elif} (\textcolor{keywordflow}{not} col \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing]):
00973                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Method \(\backslash\)""} + col + \textcolor{stringliteral}{"\(\backslash\)" does not exist with 
      processing \(\backslash\)""} + processing + \textcolor{stringliteral}{"\(\backslash\)""})
00974                 \textcolor{keywordflow}{else}:
00975                     method = col
00976                 \textcolor{keywordflow}{if} (processing != \textcolor{stringliteral}{"raw"}):
00977                     mset += processing + \textcolor{stringliteral}{"\_"}
00978                 mset += method + \textcolor{stringliteral}{"\_"}
00979                 \textcolor{comment}{# Input the value in the new dataset}
00980                 minval = np.nanmin(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing][method].data)
00981                 maxval = np.nanmax(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing][method].data)
00982                 \textcolor{keywordflow}{if} (np.isnan(minval) \textcolor{keywordflow}{or} np.isnan(maxval)):
00983                     warn(\textcolor{stringliteral}{"Datatable ("} + processing + \textcolor{stringliteral}{", "} + method + \textcolor{stringliteral}{") does not
       contain any value."})
00984                     \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(dims[0]):
00985                         \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(dims[1]):
00986                             dataset[rr,cc] = \textcolor{stringliteral}{"00"}
00987                 \textcolor{keywordflow}{else}:
00988                     \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(dims[0]):
00989                         \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(dims[1]):
00990                             value = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing][method].data[rr,cc]
00991                             \textcolor{keywordflow}{if} (np.isnan(value)):
00992                                 value = minval
00993                             intensity = re.sub(\textcolor{stringliteral}{"0x"}, \textcolor{stringliteral}{""}, hex(int( 16 * (value - m
      inval) / (maxval-minval) )) )
00994                             \textcolor{keywordflow}{if} (len(intensity) == 0):
00995                                 intensity = \textcolor{stringliteral}{"0"} + intensity
00996                             dataset[rr,cc] += intensity
00997         mset = re.sub(\textcolor{stringliteral}{"\_$"}, \textcolor{stringliteral}{""}, mset)
00998         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[\textcolor{stringliteral}{"colors"}][mset] = NaviData(dataset, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing][metho
      d].rows, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing][method].columns, processing=\textcolor{stringliteral}{"colors"}, method=\textcolor{stringliteral}{"unkn
      own"})
00999 
01000     \textcolor{comment}{# Saving data}
01001     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab539e16bff0a424ebd2753c153ff4e53}{saveAllData}(self, folder=""):
01002         \textcolor{stringliteral}{"""}
01003 \textcolor{stringliteral}{        Save all data in an .ncc file. Does not save the distribution nor color d
      ata.}
\hypertarget{navicom_8py_source_l01004}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab539e16bff0a424ebd2753c153ff4e53}{01004} \textcolor{stringliteral}{        """}
01005         \textcolor{keywordflow}{if} (folder != \textcolor{stringliteral}{""}):
01006             folder = re.sub(\textcolor{stringliteral}{"/?$"}, \textcolor{stringliteral}{"/"}, folder)
01007         fname = folder + self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} + \textcolor{stringliteral}{".ncc"}
01008         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Saving as "} + fname)
01009         ff = open(fname, \textcolor{stringliteral}{"w"})
01010         ff.close()
01011         allProcessings = list(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data})
01012         allProcessings.remove(\textcolor{stringliteral}{"uniform"})
01013         allProcessings.remove(\textcolor{stringliteral}{"distribution"})
01014         allProcessings.remove(\textcolor{stringliteral}{"color"})
01015         \textcolor{keywordflow}{for} processing \textcolor{keywordflow}{in} allProcessings:
01016             \textcolor{keywordflow}{for} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing]:
01017                 \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Saving "} + processing + \textcolor{stringliteral}{", "} + method)\textcolor{comment}{# + ", " + str(self.
      data[processing][method]))}
01018                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing][method].saveData(fname, \textcolor{stringliteral}{"a"})
01019         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Saving Annotations"})
01020         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a0386d881214943cf3432d0ffe22cbb71}{annotations}.saveData(fname, \textcolor{stringliteral}{"a"})
01021 
01022     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac53d9dc53ca0af44586a55fb1bffe8bd}{saveData}(self, method, processing="raw", folder="./"):
01023         \textcolor{stringliteral}{"""}
01024 \textcolor{stringliteral}{        Save the data in a file that can be exported to NaviCell or imported in N
      aviCom}
\hypertarget{navicom_8py_source_l01025}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac53d9dc53ca0af44586a55fb1bffe8bd}{01025} \textcolor{stringliteral}{        """}
01026         \textcolor{comment}{# TODO authorize to provide a list to save a custom dataset}
01027         \textcolor{keywordflow}{if} (folder != \textcolor{stringliteral}{""}):
01028             folder = re.sub(\textcolor{stringliteral}{"/?$"}, \textcolor{stringliteral}{"/"}, folder)
01029         \textcolor{keywordflow}{if} (processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}):
01030             \textcolor{keywordflow}{if} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing]):
01031                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa1abff245573ed8406c6bddb4596f093}{data}[processing][method].saveData(baseName=folder+self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name})
      
01032             \textcolor{keywordflow}{else}:
01033                 \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Method "} + method + \textcolor{stringliteral}{" does not exist with proce
      ssing "} + processing)
01034         \textcolor{keywordflow}{else}:
01035             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{" does not exist"})
01036 
\end{DoxyCode}
