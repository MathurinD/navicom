\hypertarget{navicom_8py_source}{
\subsection{navicom/navicom.py}
}

\begin{DoxyCode}
00001 \textcolor{comment}{################################################################################}
00002 \textcolor{comment}{# navicom.py}
00003 \textcolor{comment}{# By Mathurin Dorel}
00004 \textcolor{comment}{# Import data from a file and create analyzed sets to export to NaviCell}
00005 \textcolor{comment}{################################################################################}
00006 
00007 \textcolor{keyword}{from} curie.navicell \textcolor{keyword}{import} *
00008 \textcolor{keyword}{from} .navidata \textcolor{keyword}{import} *
00009 \textcolor{keyword}{from} .displayConfig \textcolor{keyword}{import} *
00010 
00011 DEBUG\_NAVICOM = \textcolor{keyword}{True}
00012 VERBOSE\_NAVICOM = \textcolor{keyword}{True}
00013 
00014 \textcolor{keyword}{def }getLine(ll, split\_char="\(\backslash\)t"):
00015     ll = re.sub(\textcolor{stringliteral}{'\(\backslash\)"'}, \textcolor{stringliteral}{''}, ll.strip())
00016     ll = re.sub(\textcolor{stringliteral}{'\(\backslash\)tNA'}, \textcolor{stringliteral}{'\(\backslash\)tNaN'}, ll) \textcolor{comment}{# Python float can convert "NaN" -> nan but 
      not "NA" -> nan}
00017     ll = ll.split(split\_char)
00018     \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(ll)):
00019         \textcolor{keywordflow}{try}:
00020             ll[ii] = float(ll[ii])
00021         \textcolor{keywordflow}{except}:
00022             \textcolor{keywordflow}{pass}
00023     \textcolor{keywordflow}{return}(ll)
00024 
00025 \textcolor{keyword}{class }NaviCom():
00026     \textcolor{stringliteral}{"""}
00027 \textcolor{stringliteral}{    NaviComm class to handle data and display them in a standardized way on NaviC
      ell maps}
\hypertarget{navicom_8py_source_l00028}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom}{00028} \textcolor{stringliteral}{    """}
00029 
00030     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ae6133fe7ec63cf5643c1794f4f8e2349}{__init__}(self, map\_url='https://navicell.curie.fr/navicell/maps/cellcycle
      /master/index.php\textcolor{stringliteral}{', fname="", modules\_dict="", browser\_command="firefox %s", disp
      lay\_config=DisplayConfig()):}
00031 \textcolor{stringliteral}{        }\textcolor{stringliteral}{"""}
00032 \textcolor{stringliteral}{        Initialize a Navicell communication object.}
00033 \textcolor{stringliteral}{        Args:}
00034 \textcolor{stringliteral}{            map\_url (str): URL of the NaviCell map}
00035 \textcolor{stringliteral}{            fname (str): name of the data file to load}
00036 \textcolor{stringliteral}{            modules\_dict (str): name of the module definition file (.gmt) to load
      }
00037 \textcolor{stringliteral}{            browser\_command (str): command to open the browser}
\hypertarget{navicom_8py_source_l00038}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ae6133fe7ec63cf5643c1794f4f8e2349}{00038} \textcolor{stringliteral}{        """}
00039         \textcolor{comment}{# Build options for the navicell connexion}
00040         options = Options()
00041         options.map\_url = map\_url
00042         idx = options.map\_url.find(\textcolor{stringliteral}{'/navicell/'})
00043         options.proxy\_url = options.map\_url[0:idx] + \textcolor{stringliteral}{'/cgi-bin/nv\_proxy.php'}
00044         options.browser\_command = browser\_command \textcolor{comment}{# TODO Add user control}
00045         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv} = NaviCell(options)
00046         \textcolor{comment}{## Name of the dataset}
\hypertarget{navicom_8py_source_l00047}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{00047}         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} = \textcolor{stringliteral}{"no\_name"} 
00048         \textcolor{comment}{# NaviCell export control}
00049         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a3f78f9d3f194b32b14f1cfa154a26082}{_exported_annotations} = \textcolor{keyword}{False}
00050         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6f40767575f6ae749bd9275d462f1af2}{_browser_opened} = \textcolor{keyword}{False}
00051         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a53870501f47d416a35c6c743d3d222d2}{_biotypes} = dict()
00052         \textcolor{comment}{# Representation of the data}
00053         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config} = display\_config
00054         \textcolor{comment}{# Data, indexed by processing then type of data}
00055         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings} = PROCESSINGS
00056         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data} = dict() \textcolor{comment}{# All data}
00057         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data} = dict() \textcolor{comment}{# Whether data have been exported yet}
00058         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names} = dict() \textcolor{comment}{# Name of the exported data}
00059         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data} = dict() \textcolor{comment}{# Processing and method associated to each
       name}
00060         \textcolor{keywordflow}{for} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}:
00061             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing] = dict()
00062             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[processing] = dict()
00063             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing] = dict()
00064         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[\textcolor{stringliteral}{"uniform"}] = \textcolor{keyword}{False}
00065         \textcolor{comment}{## Annotations of the samples}
00066         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb88722efeb86813dcb85818b7065330}{_annotations} = dict()
00067         \textcolor{comment}{## Composition of the modules}
\hypertarget{navicom_8py_source_l00068}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{00068}         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules} = dict()
00069         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules} = dict() \textcolor{comment}{# Number of modules each gene belong to
      }
00070         \textcolor{keywordflow}{if} (fname != \textcolor{stringliteral}{""}):
00071             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a10e8b8a4c06b4ecf09366ca6b69efff6}{loadData}(fname)
00072             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6411b52971f15bd11270942cb98eaa1a}{defineModules}(modules\_dict)
00073         \textcolor{comment}{# Remember how many samples and datatables were selected in NaviCell in t
      he heatmap and barplot editors}
00074         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abf768fde5caf68a79e19385b48ea0bcc}{_hsid} = 0
00075         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a095a4a928f1f09319fafc949f8580f78}{_hdid} = 0
00076         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a496d13fc4c8b73cef4f496b713d12b79}{_bid} = 0
00077 
00078     \textcolor{keyword}{def }listData(self):
00079         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Data available :"})
00080         \textcolor{keywordflow}{for} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}:
00081             \textcolor{keywordflow}{for} dname \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]:
00082                 \textcolor{keywordflow}{if} (dname.lower() \textcolor{keywordflow}{in} METHODS\_TYPE):
00083                     \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"\(\backslash\)t"} + processing + \textcolor{stringliteral}{" "} + dname + \textcolor{stringliteral}{": "} + METHODS\_TYPE[d
      name.lower()] + \textcolor{stringliteral}{" (biotype: "} + TYPES\_BIOTYPE[METHODS\_TYPE[dname.lower()]] + \textcolor{stringliteral}{")"})
      
00084                 \textcolor{keywordflow}{else}:
00085                     \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"\(\backslash\)t"} + processing + \textcolor{stringliteral}{" "} + dname)
00086 
00087     \textcolor{keyword}{def }listAnnotations(self):
00088         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Annotations available (values) :"})
00089         \textcolor{keywordflow}{for} annot \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb88722efeb86813dcb85818b7065330}{_annotations}.\_annotations:
00090             \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"\(\backslash\)t"} + annot + \textcolor{stringliteral}{" : "} + str(set(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb88722efeb86813dcb85818b7065330}{_annotations}[annot])))
00091 
00092     \textcolor{keyword}{def }\_\_repr\_\_(self):
00093         rpr = \textcolor{stringliteral}{"NaviCom object with "} + str(len(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data})) + \textcolor{stringliteral}{" types of data:\(\backslash\)n"
      }
00094         \textcolor{keywordflow}{for} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}:
00095             rpr += method + \textcolor{stringliteral}{": "} + self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[method] + \textcolor{stringliteral}{"\(\backslash\)n"}
00096         rpr += \textcolor{stringliteral}{"and "} + str(len(self.moduleAverage)) + \textcolor{stringliteral}{" modules average:\(\backslash\)n"}
00097         \textcolor{keywordflow}{for} method \textcolor{keywordflow}{in} self.moduleAverage:
00098             rpr += method + \textcolor{stringliteral}{": "} + self.moduleAverage[method] + \textcolor{stringliteral}{"\(\backslash\)n"}
00099         \textcolor{keywordflow}{return}(repr)
00100     
00101     \textcolor{keyword}{def }\_nameData(self, method, processing="raw", name=""):
00102         \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{""}):
00103             name = method + \textcolor{stringliteral}{"\_"} + processing
00104         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing][method] = name
00105         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}[name] = (processing, method)
00106         \textcolor{keywordflow}{return} (name)
00107 
00108     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a51ecb41beebc7636bde73be2e1ffc407}{getDataName}(self, data\_name):
00109         \textcolor{stringliteral}{"""}
00110 \textcolor{stringliteral}{        Return the string identifier corresponding to the data name or tuple}
00111 \textcolor{stringliteral}{}
00112 \textcolor{stringliteral}{        Args:}
00113 \textcolor{stringliteral}{            data\_name (str or tuple): Identifier of the data}
\hypertarget{navicom_8py_source_l00114}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a51ecb41beebc7636bde73be2e1ffc407}{00114} \textcolor{stringliteral}{        """}
00115         dTuple = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad8ac5b74afb4ceb6ed094604787d4d19}{getDataTuple}(data\_name)
00116         \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[dTuple[0]][dTuple[1]])
00117 
00118     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad8ac5b74afb4ceb6ed094604787d4d19}{getDataTuple}(self, data\_name):
00119         \textcolor{stringliteral}{"""}
00120 \textcolor{stringliteral}{        Return tuple corresponding to the data name or tuple}
\hypertarget{navicom_8py_source_l00121}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad8ac5b74afb4ceb6ed094604787d4d19}{00121} \textcolor{stringliteral}{        """}
00122         \textcolor{keywordflow}{if} (isinstance(data\_name, str)):
00123             \textcolor{keywordflow}{if} (data\_name \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}):
00124                 \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}[data\_name])
00125             \textcolor{keywordflow}{elif} (data\_name + \textcolor{stringliteral}{"\_raw"} \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}):
00126                 \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}[data\_name + \textcolor{stringliteral}{"\_raw"}])
00127         \textcolor{keywordflow}{elif} (isinstance(data\_name, tuple) \textcolor{keywordflow}{and} len(data\_name) == 2):
00128             \textcolor{keywordflow}{if} (data\_name[0] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}):
00129                 \textcolor{keywordflow}{return}(data\_name)
00130             \textcolor{keywordflow}{elif} (data\_name[1] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}):
00131                 \textcolor{keywordflow}{return}((data\_name[1],data\_name[0]))
00132         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Invalid name or tuple for data: "} + str(data\_name))
00133 
00134     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad675e899836271ff4f2fd4bd17ea81d9}{getData}(self, data\_name):
00135         \textcolor{stringliteral}{"""}
00136 \textcolor{stringliteral}{        Return the NaviData entity corresponding to the data name or tuple}
00137 \textcolor{stringliteral}{}
00138 \textcolor{stringliteral}{        Args:}
00139 \textcolor{stringliteral}{            data\_name (str or tuple): Identifier of the data}
\hypertarget{navicom_8py_source_l00140}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad675e899836271ff4f2fd4bd17ea81d9}{00140} \textcolor{stringliteral}{        """}
00141         dTuple = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad8ac5b74afb4ceb6ed094604787d4d19}{getDataTuple}(data\_name)
00142         \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[dTuple[0]][dTuple[1]])
00143 
00144     \textcolor{comment}{# Load new data}
00145     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a10e8b8a4c06b4ecf09366ca6b69efff6}{loadData}(self, fname="data/Ovarian\_Serous\_Cystadenocarcinoma\_TCGA\_Nature\_
      2011.txt", keep\_mutations\_nan=False):
00146         \textcolor{stringliteral}{"""}
00147 \textcolor{stringliteral}{        Load data from a .txt or .ncc file containing several datas, or from a .t
      sv, .ncd or .nca file containing data from one method.}
00148 \textcolor{stringliteral}{}
00149 \textcolor{stringliteral}{        Args:}
00150 \textcolor{stringliteral}{            fname (str): name of the file from which the data should be loaded}
00151 \textcolor{stringliteral}{            keep\_mutations\_nan(str): whether nan in mutations data should be cons
      idered as no mutation (False) or missing value (True)}
\hypertarget{navicom_8py_source_l00152}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a10e8b8a4c06b4ecf09366ca6b69efff6}{00152} \textcolor{stringliteral}{        """}
00153         with open(fname) \textcolor{keyword}{as} file\_conn:
00154             ff = file\_conn.readlines()
00155             ll = 0
00156         \textcolor{comment}{# Name the dataset according to the filename, and issue a warning if the 
      name changes}
00157         dname = parseFilename(fname)[0]
00158         \textcolor{keywordflow}{if} (dname != self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} \textcolor{keywordflow}{and} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} != \textcolor{stringliteral}{"no\_name"}):
00159             warn(\textcolor{stringliteral}{"Name of the dataset "} + self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} + \textcolor{stringliteral}{" has been changed to "} + d
      name)
00160         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} = dname
00161 
00162         dataRegex = \textcolor{stringliteral}{"^M |^GENE"}
00163         annotRegex = \textcolor{stringliteral}{"^ANNOTATIONS|^NAME"}
00164         completeRegex = dataRegex + \textcolor{stringliteral}{"|"} + annotRegex
00165         methodFromFile = \textcolor{keyword}{False}
00166         \textcolor{keywordflow}{while} (ll < len(ff)):
00167             \textcolor{keywordflow}{if} (re.search(dataRegex, ff[ll])):
00168                 \textcolor{comment}{# Import data}
00169                 \textcolor{comment}{# Use the method and processing names if they are provided, other
      wise deduce them from the filename }
00170                 \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"^M "}, ff[ll])):
00171                     line = re.sub(\textcolor{stringliteral}{"^M"}, \textcolor{stringliteral}{""}, ff[ll].strip()).split(\textcolor{stringliteral}{"\(\backslash\)t"})
00172                     method = line[0].strip()
00173                     \textcolor{keywordflow}{if} (len(line) > 1 \textcolor{keywordflow}{and} line[1] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}):
00174                         processing = line[1].strip()
00175                     \textcolor{keywordflow}{else}:
00176                         processing = \textcolor{stringliteral}{"raw"}
00177                     samples = getLine(ff[ll+1])
00178                     \textcolor{keywordflow}{if} (samples[0] == \textcolor{stringliteral}{"GENE"}):
00179                         samples = samples[1:]
00180                     ll += 2
00181                 \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"^GENE"}, ff[ll])):
00182                     fname = os.path.split(fname)[1]
00183                     dname, processing, method = parseFilename(fname)
00184                     \textcolor{comment}{# Deduction cannot be performed}
00185                     \textcolor{keywordflow}{if} (methodFromFile):
00186                         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"A type of data must be provided when im
      porting several data in one file"})
00187                     \textcolor{keywordflow}{else}:
00188                         methodFromFile = \textcolor{keyword}{True}
00189                     samples = getLine(ff[ll])[1:]
00190                     ll += 1
00191                 \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Importing "} + method + \textcolor{stringliteral}{" data"})
00192                 profile\_data = dict()
00193                 profile\_data[\textcolor{stringliteral}{"samples"}] = oDict()
00194                 profile\_data[\textcolor{stringliteral}{"genes"}] = dict()
00195                 profile\_data[\textcolor{stringliteral}{"data"}] = list()
00196                 ii = 0
00197                 \textcolor{keywordflow}{for} el \textcolor{keywordflow}{in} samples:
00198                     profile\_data[\textcolor{stringliteral}{"samples"}][el] = ii
00199                     ii += 1
00200 
00201                 gid = 0
00202                 \textcolor{keywordflow}{while}(ll < len(ff) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} re.search(completeRegex, ff[ll])):
00203                     dl = getLine(ff[ll])
00204                     profile\_data[\textcolor{stringliteral}{"data"}].append(dl[1:]) \textcolor{comment}{# Data in a list at index
       gene\_name}
00205                     profile\_data[\textcolor{stringliteral}{"genes"}][dl[0]] = gid
00206                     gid += 1
00207 
00208                     ll += 1
00209                 \textcolor{keywordflow}{if} (processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data} \textcolor{keywordflow}{and} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]
      ):
00210                     warn(\textcolor{stringliteral}{"Overwriting data for method "} + method + \textcolor{stringliteral}{" with process
      ing "} + processing)
00211                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method] = NaviData(profile\_data[\textcolor{stringliteral}{"data"}], p
      rofile\_data[\textcolor{stringliteral}{"genes"}], profile\_data[\textcolor{stringliteral}{"samples"}], method, processing)
00212                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[processing][method] = \textcolor{keyword}{False}
00213                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5314c49d6b9749693519a4a86cbfde71}{quantifyMutations}(method)
00214                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a140128d0fd12930347cc2375c154072d}{_nameData}(method, processing)
00215                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} \textcolor{stringliteral}{"uniform"} \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}):
00216                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a4d9f00c3c5de8b0f2e938d7019450ffe}{_defineUniformData}(profile\_data[\textcolor{stringliteral}{"samples"}], profile\_data
      [\textcolor{stringliteral}{"genes"}])
00217             \textcolor{keywordflow}{elif} (re.search(annotRegex, ff[ll])):
00218                 \textcolor{comment}{# Import annotations}
00219                 \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Importing Annotations"})
00220                 \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"^ANNOTATIONS"}, ff[ll])):
00221                     annotations\_names = getLine(ff[ll+1])
00222                     \textcolor{keywordflow}{if} (annotations\_names[0] == \textcolor{stringliteral}{"NAME"}):
00223                         annotations\_names = annotations\_names[1:]
00224                     ll += 2
00225                 \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"^NAME"}, ff[ll])):
00226                     annotations\_names = getLine(ff[ll][1:])
00227                     ll += 1
00228                 annot = dict()
00229                 annot[\textcolor{stringliteral}{"names"}] = list()
00230                 annot[\textcolor{stringliteral}{"samples"}] = list()
00231                 annot[\textcolor{stringliteral}{"annot"}] = list()
00232                 not\_all = \textcolor{keywordflow}{not} \textcolor{stringliteral}{"all"} \textcolor{keywordflow}{in} annotations\_names
00233                 \textcolor{keywordflow}{if} (not\_all):
00234                     annot[\textcolor{stringliteral}{"names"}].append(\textcolor{stringliteral}{"all"})
00235                     annot[\textcolor{stringliteral}{"annot"}].append([1 \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(nb\_samples)])
00236                 \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} annotations\_names:
00237                     annot[\textcolor{stringliteral}{"names"}].append(name)
00238                 \textcolor{keywordflow}{while}(ll < len(ff) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} re.search(completeRegex, ff[ll])):
00239                     al = getLine(ff[ll])
00240                     \textcolor{comment}{# Gather each annotation for this sample and add all as the f
      irst column if necessary}
00241                     \textcolor{keywordflow}{if} (not\_all):
00242                         annot[\textcolor{stringliteral}{"annot"}].append([1] + al[1:])
00243                     \textcolor{keywordflow}{else}:
00244                         annot[\textcolor{stringliteral}{"annot"}].append(al[1:])
00245                     annot[\textcolor{stringliteral}{"samples"}].append(al[0])
00246 
00247                     ll = ll+1
00248                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb88722efeb86813dcb85818b7065330}{_annotations} = NaviAnnotations(annot[\textcolor{stringliteral}{"annot"}], annot[\textcolor{stringliteral}{"sample
      s"}], annot[\textcolor{stringliteral}{"names"}], dType=\textcolor{stringliteral}{"annotations"})
00249             \textcolor{keywordflow}{else}:
00250                 \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Incorrect format, file must be a valid file for
       NaviCell or an aggregation of such files with headers to indicate the type of da
      ta"})
00251 
00252     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ae310adb1d4e8932f0b72b6d8b6ca6301}{bindNaviData}(self, navidata, method, processing):
00253         \textcolor{stringliteral}{"""}
00254 \textcolor{stringliteral}{        Bind a NaviData datatable to the NaviCom object in order to use it }
00255 \textcolor{stringliteral}{}
00256 \textcolor{stringliteral}{        Args:}
00257 \textcolor{stringliteral}{            navidata (NaviData): the NaviData datatable to bind}
00258 \textcolor{stringliteral}{            method (str): the method used to get the data}
00259 \textcolor{stringliteral}{            processing (str): the visualisation related processing applied to the
       data}
\hypertarget{navicom_8py_source_l00260}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ae310adb1d4e8932f0b72b6d8b6ca6301}{00260} \textcolor{stringliteral}{        """}
00261         \textcolor{keyword}{assert} isinstance(navidata, NaviData), \textcolor{stringliteral}{"navidata is not a NaviData object
      "}
00262         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_acf8b9094fa76cafefb910daeb68b7e5d}{_newProcessedData}(method, processing, navidata)
00263 
00264     \textcolor{keyword}{def }\_defineUniformData(self, samples, genes):
00265         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"uniform"}] = NaviData( np.array([[1] * len(samples) \textcolor{keywordflow}{for} nn \textcolor{keywordflow}{in} 
      genes]), genes, samples, \textcolor{stringliteral}{"uniform"})
00266         \textcolor{comment}{# TODO change to 1.0 when < is changed to <= for continuous data}
00267 
00268     \textcolor{keyword}{def }\_newProcessedData(self, method, processing, data):
00269         \textcolor{stringliteral}{"""}
00270 \textcolor{stringliteral}{        Update adequate arrays when processed data are generated}
00271 \textcolor{stringliteral}{        """}
00272         \textcolor{keyword}{assert} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}, \textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{" is
       not handled"}
00273         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method] = data
00274         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[processing][method] = \textcolor{keyword}{False}
00275         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a140128d0fd12930347cc2375c154072d}{_nameData}(method, processing)
00276 
00277     \textcolor{comment}{# Process data}
00278     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5314c49d6b9749693519a4a86cbfde71}{quantifyMutations}(self, method, keep\_nan=False):
00279         \textcolor{stringliteral}{"""}
00280 \textcolor{stringliteral}{        Transform the qualitative mutation datas into a quantitative one, where 1
       means a mutation and 0 no mutation.}
00281 \textcolor{stringliteral}{        Args:}
00282 \textcolor{stringliteral}{            keep\_nan : Should nan values be converted to O (no mutations) or kept
       as missing data}
00283 \textcolor{stringliteral}{        """}
00284         \textcolor{keywordflow}{if} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}] \textcolor{keywordflow}{and} METHODS\_TYPE[method.lower()] == \textcolor{stringliteral}{"muta
      tions"}):
\hypertarget{navicom_8py_source_l00285}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5314c49d6b9749693519a4a86cbfde71}{00285}             mutations = NaviData(np.zeros(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method].data.shape), 
      self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method].rows\_names, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method].columns\_names, me
      thod, \textcolor{stringliteral}{"mutationQuantification"})
00286             \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(len(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method].rows\_names)):
00287                 \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(len(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method].columns\_names)):
00288                     value = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method][rr][cc]
00289                     \textcolor{keywordflow}{if} ( re.match(\textcolor{stringliteral}{"nan|na"}, value.lower()) ):
00290                         \textcolor{keywordflow}{if} (keep\_nan):
00291                             mutations.data[rr][cc] = np.nan
00292                         \textcolor{keywordflow}{else}:
00293                             mutations.data[rr][cc] = 0
00294                     \textcolor{keywordflow}{elif} ( value == \textcolor{stringliteral}{""} ):
00295                         mutations.data[rr][cc] = 0
00296                     \textcolor{keywordflow}{else}:
00297                         mutations.data[rr][cc] = 1
00298             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_acf8b9094fa76cafefb910daeb68b7e5d}{_newProcessedData}(method, \textcolor{stringliteral}{"mutationQuantification"}, mutations)
00299 
00300     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6411b52971f15bd11270942cb98eaa1a}{defineModules}(self, modules\_dict=""):
00301         \textcolor{stringliteral}{"""}
00302 \textcolor{stringliteral}{        Defines the modules to use and which module each gene belongs to.}
00303 \textcolor{stringliteral}{}
00304 \textcolor{stringliteral}{        Args:}
00305 \textcolor{stringliteral}{            modules\_dict : Either a dict indexed by module name or a file name wi
      th the description of each module (.gmt file: tab delimited, first column module 
      name, second column description, then list of entities in the module)}
00306 \textcolor{stringliteral}{        """}
00307         \textcolor{comment}{# Gather the composition of each module}
\hypertarget{navicom_8py_source_l00308}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6411b52971f15bd11270942cb98eaa1a}{00308}         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules} = dict()
00309         \textcolor{keywordflow}{if} (isinstance(modules\_dict, dict)):
00310             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules} = modules\_dict 
00311         \textcolor{keywordflow}{elif} (isinstance(modules\_dict, str)):
00312             \textcolor{keywordflow}{if} (modules\_dict != \textcolor{stringliteral}{""}):
00313                 with open(modules\_dict) \textcolor{keyword}{as} ff:
00314                     \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} ff.readlines():
00315                         ll = line.strip().split(\textcolor{stringliteral}{"\(\backslash\)t"})
00316                         module\_name = ll[0]
00317                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}[module\_name] = ll[2:]
00318 
00319         \textcolor{comment}{# TODO add control that the genes in the modules have data}
00320         \textcolor{stringliteral}{"""}
00321 \textcolor{stringliteral}{        # Only keep genes with data}
00322 \textcolor{stringliteral}{        for module in self.modules:}
00323 \textcolor{stringliteral}{            keep = list()}
00324 \textcolor{stringliteral}{            for gene in self.modules[module]:}
00325 \textcolor{stringliteral}{                if (not gene in self.genes\_list):}
00326 \textcolor{stringliteral}{                    self.modules[module].remove(gene)}
00327 \textcolor{stringliteral}{        """}
00328         \textcolor{comment}{# Count the number of modules each gene belong to}
00329         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules} = dict()
00330         \textcolor{keywordflow}{for} module\_name \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}.keys():
00331             \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}[module\_name]:
00332                 \textcolor{keywordflow}{try}:
00333                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules}[gene].append(module\_name)
00334                 \textcolor{keywordflow}{except} KeyError:
00335                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules}[gene] = [module\_name]
00336 
00337     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afd1a299b687bc97e171cff0a738b7b73}{averageModule}(self, method):
00338         \textcolor{stringliteral}{"""}
00339 \textcolor{stringliteral}{        Perform module averaging for every modules for one data type}
00340 \textcolor{stringliteral}{        """}
00341         \textcolor{keyword}{assert} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}], \textcolor{stringliteral}{"This type of data is not present"}
\hypertarget{navicom_8py_source_l00342}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afd1a299b687bc97e171cff0a738b7b73}{00342}         \textcolor{keyword}{assert} len(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules})>0, \textcolor{stringliteral}{"No module have been defined"}
00343 
00344         \textcolor{comment}{# Calculate average expression for each module}
00345         data = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"raw"}][method]
00346         samples = list(data.samples.keys())
00347         module\_expression = dict()
00348         \textcolor{keywordflow}{for} module \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}:
00349             module\_expression[module] = [0 \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} samples]
00350             non\_nan = np.array([0 \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} samples])
00351             no\_data = list()
00352             \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a56141660ddf29a36a8291e938246578c}{modules}[module]:
00353                 \textcolor{keywordflow}{try}:
00354                     not\_nan = np.array([int(\textcolor{keywordflow}{not} np.isnan(dd)) \textcolor{keywordflow}{for} dd \textcolor{keywordflow}{in} data[gene
      ].data])
00355                     non\_nan += not\_nan
00356                     non\_nan\_data = data[gene].data * not\_nan
00357                     non\_nan\_data[np.isnan(non\_nan\_data)] = 0
00358                     module\_expression[module] += non\_nan\_data
00359                 \textcolor{keywordflow}{except} IndexError:
00360                     no\_data += [gene]
00361             \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} no\_data:
00362                 \textcolor{comment}{#self.modules[module].remove(gene)}
00363                 \textcolor{keywordflow}{if} (VERBOSE\_NAVICOM):
00364                     \textcolor{keywordflow}{print}(gene + \textcolor{stringliteral}{" from module "} + module + \textcolor{stringliteral}{" has no "} + method +
       \textcolor{stringliteral}{" data"})
00365             module\_expression[module] /= non\_nan
00366 
00367         \textcolor{comment}{# Calculate average module expression for each gene}
00368         gene\_module\_average = list()
00369         \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} data.genes:
00370             \textcolor{keywordflow}{if} gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules}:
00371                 gene\_module\_average.append(np.array([0. \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} data.sample
      s]))
00372                 \textcolor{keywordflow}{for} module \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules}[gene]:
00373                     gene\_module\_average[-1] += module\_expression[module] / len(se
      lf.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abc04e5310dba9a8c2dd2037281464727}{_associated_modules}[gene])
00374             \textcolor{keywordflow}{else}:
00375                 gene\_module\_average.append(np.array(list(data[gene])))
00376                 \textcolor{keywordflow}{print}(gene)
00377 
00378         \textcolor{comment}{# Put the averaging in a NaviData structure}
00379         \textcolor{comment}{#self.\_data["moduleAverage"][method] = NaviData(list(module\_expression.va
      lues()), list(self.modules.keys()), samples) # Usefull if NaviCell allow modules 
      values one day}
00380         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_acf8b9094fa76cafefb910daeb68b7e5d}{_newProcessedData}(method, \textcolor{stringliteral}{"moduleAverage"}, NaviData(gene\_module\_aver
      age, list(data.genes), samples))
00381 
00382     \textcolor{keyword}{def }\_pcaComp(self, method, colors=["red", "green", "blue"]):
00383         \textcolor{stringliteral}{"""}
00384 \textcolor{stringliteral}{        Run pca on the data and create a color matrix with the 3 principal compon
      ents in the three main colors}
00385 \textcolor{stringliteral}{        """}
00386         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Not implemented yet"})
00387 
00388     \textcolor{comment}{# Export data and annotations}
00389     \textcolor{keyword}{def }\_exportData(self, method, processing="raw", name=""):
00390         \textcolor{stringliteral}{"""}
00391 \textcolor{stringliteral}{        Export data to NaviCell, can be processed data}
00392 \textcolor{stringliteral}{}
00393 \textcolor{stringliteral}{        Args:}
00394 \textcolor{stringliteral}{            method (str) : name of the method to export}
00395 \textcolor{stringliteral}{            processing (str) : "" to export raw data, processing method to export
       processed data. See 'averageModule' and '\_pcaComponent'}
00396 \textcolor{stringliteral}{        """}
00397         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab468a31a5f439bcae23f4c75b8c67f65}{_checkBrowser}() \textcolor{comment}{# TODO Perform processing if necessary}
00398         done\_export = \textcolor{keyword}{False}
00399 
00400         \textcolor{keywordflow}{if} (processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}):
00401             \textcolor{keywordflow}{if} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]):
00402                 \textcolor{keywordflow}{if}(method.lower() \textcolor{keywordflow}{in} METHODS\_TYPE):
00403                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[processing][method]):
00404                         name = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a140128d0fd12930347cc2375c154072d}{_nameData}(method, processing, name)
00405                         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Exporting '"} + name + \textcolor{stringliteral}{"' to NaviCell..."})
00406                         \textcolor{comment}{# Processing change the type of data, like discrete data 
      into continuous, or anything to color data}
00407                         biotype = getBiotype(method, processing)
00408                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.importDatatables(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].
      \_makeData(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.getHugoList()), name, biotype)
00409                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5bde750c01abc8e64338fb148c59b435}{_configureDisplay}(method, processing)
00410                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[processing][method] = \textcolor{keyword}{True}
00411                         done\_export = \textcolor{keyword}{True}
00412                 \textcolor{keywordflow}{elif} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{'distribution'}]):
00413                     \textcolor{keywordflow}{pass} \textcolor{comment}{# Avoid bug}
00414                 \textcolor{keywordflow}{else}:
00415                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Biotype of '"} + method + \textcolor{stringliteral}{"' is unknown"})
00416             \textcolor{keywordflow}{elif} (method == \textcolor{stringliteral}{"uniform"}): \textcolor{comment}{# Uniform data for glyphs}
00417                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[\textcolor{stringliteral}{"uniform"}]):
00418                     \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Exporting 'uniform'  to NaviCell..."})
00419                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.importDatatables( self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"uniform"}].\_makeData(se
      lf.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.getHugoList()), \textcolor{stringliteral}{"uniform"}, getBiotype(\textcolor{stringliteral}{"uniform"}) )
00420                     done\_export = \textcolor{keyword}{True}
00421                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[\textcolor{stringliteral}{"uniform"}] = \textcolor{keyword}{True}
00422             \textcolor{keywordflow}{elif} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"distribution"}]):
00423                 \textcolor{keywordflow}{pass} \textcolor{comment}{# Exported on creation, TODO change for multiple NaviCell}
00424             \textcolor{keywordflow}{else}:
00425                 \textcolor{keywordflow}{raise} KeyError(\textcolor{stringliteral}{"Method '"} + method + \textcolor{stringliteral}{"' with processing '"} + proc
      essing + \textcolor{stringliteral}{"' does not exist"})
00426         \textcolor{keywordflow}{else}:
00427             \textcolor{keywordflow}{raise} KeyError(\textcolor{stringliteral}{"Processing '"} + processing + \textcolor{stringliteral}{"' does not exist"})
00428 
00429         \textcolor{comment}{# Uniform data have been defined when other datas have, but do not recqui
      re explicit export}
00430         \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab7328fbbe89a1b3cb2db8c3d456d958f}{_exported_data}[\textcolor{stringliteral}{"uniform"}]):
00431             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb8ef6988c65589c35ad11dcb8681787}{_exportData}(\textcolor{stringliteral}{"uniform"})
00432 
00433     \textcolor{keyword}{def }\_checkBrowser(self):
00434         \textcolor{stringliteral}{"""}
00435 \textcolor{stringliteral}{        Check if the browser is opened or open it}
00436 \textcolor{stringliteral}{        """}
00437         \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6f40767575f6ae749bd9275d462f1af2}{_browser_opened}):
00438             \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Launching browser..."})
00439             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.launchBrowser()
00440             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6f40767575f6ae749bd9275d462f1af2}{_browser_opened} = \textcolor{keyword}{True}
00441         \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a6f40767575f6ae749bd9275d462f1af2}{_browser_opened})
00442 
00443     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a59edead26b5d02f17a60df055576f5}{exportAnnotations}(self):
00444         \textcolor{stringliteral}{"""}
00445 \textcolor{stringliteral}{        Export samples annotations to NaviCell}
00446 \textcolor{stringliteral}{        """}
00447         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab468a31a5f439bcae23f4c75b8c67f65}{_checkBrowser}()
00448 
00449         \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a3f78f9d3f194b32b14f1cfa154a26082}{_exported_annotations}):
00450             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.sampleAnnotationImport(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb88722efeb86813dcb85818b7065330}{_annotations}.\_makeData())
00451             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a3f78f9d3f194b32b14f1cfa154a26082}{_exported_annotations} = \textcolor{keyword}{True}
00452 
00453     \textcolor{keyword}{def }\_configureDisplay(self, method, processing="raw"):
\hypertarget{navicom_8py_source_l00454}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a59edead26b5d02f17a60df055576f5}{00454}         \textcolor{stringliteral}{"""}
00455 \textcolor{stringliteral}{        Changes the Color and Size Configuration for the datatable to the one pre
      cised by the user.}
00456 \textcolor{stringliteral}{        """}
00457         \textcolor{keywordflow}{if} (getBiotype(method, processing) \textcolor{keywordflow}{in} CONTINOUS\_BIOTYPES):
00458             \textcolor{comment}{## Color configuration}
00459             dname = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a51ecb41beebc7636bde73be2e1ffc407}{getDataName}((method, processing))
00460             \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Configuring display for "} + dname)
00461             step\_count = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.step\_count
00462             \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS]:
00463                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetStepCount(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG\_C
      OLOR, tab, step\_count-1) \textcolor{comment}{# NaviCell has one default step}
00464 
00465             dtable = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].data
00466             ftable = dtable.flatten()
00467             ftable.sort()
00468             \textcolor{comment}{# Remove extreme values if applicable}
00469             ptable = ftable[ftable > 0]
00470             \textcolor{keywordflow}{if} (len(ptable) > 0):
00471                 keep = math.floor( (1 - self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_excluded) * len(pta
      ble) )
00472                 ptable = ptable[:keep]
00473                 maxval = ptable[-1]
00474             \textcolor{keywordflow}{else}:
00475                 maxval = np.nanmax(ftable)
00476             ntable = ftable[ftable < 0]
00477             \textcolor{keywordflow}{if} (len(ntable) > 0):
00478                 keep = math.ceil( self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_excluded * len(ptable) )
00479                 ntable = ntable[keep:]
00480                 minval = ntable[0]
00481             \textcolor{keywordflow}{else}:
00482                 minval = np.nanmin(ftable)
00483             \textcolor{comment}{# Use the same scales for positive and negative values, choose the sm
      allest to enhance contrast}
00484             \textcolor{keywordflow}{if} (minval * maxval < 0):
00485                 \textcolor{keywordflow}{if} (-minval > maxval):
00486                     minval = -maxval
00487                 \textcolor{keywordflow}{elif} (maxval > -minval):
00488                     maxval = -minval
00489 
00490             \textcolor{keywordflow}{if} (len(ftable[np.isnan(ftable)]) > 0):
00491                 navicell\_offset = 1 \textcolor{comment}{# First value is nan}
00492                 \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS]:
00493                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG
      \_COLOR, tab, 0, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.na\_color)
00494             \textcolor{keywordflow}{else}:
00495                 navicell\_offset = 0
00496 
00497             \textcolor{keywordflow}{if} (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_zero\_color != \textcolor{stringliteral}{""}):
00498                 half\_count = step\_count//2
00499                 \textcolor{keywordflow}{if} (half\_count != 1):
00500                     \textcolor{comment}{# Negative values}
00501                     \textcolor{keywordflow}{if} (minval > 0): minval = -1
00502                     step = -minval/half\_count
00503                     values\_list = [signif(val) \textcolor{keywordflow}{for} val \textcolor{keywordflow}{in} np.arange(minval, step/
      2, step)][:-1]
00504                     \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(half\_count):
00505                        value = values\_list[ii]
00506                        color = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_colors[ii]
00507                        \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GRO
      UPS]:
00508                            self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCell
      .CONFIG\_COLOR, tab, navicell\_offset + ii, value)
00509                            self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCell
      .CONFIG\_COLOR, tab, navicell\_offset + ii, color)
00510                     \textcolor{comment}{# Zero if present}
00511                     offset = half\_count
00512                     \textcolor{keywordflow}{if} (step\_count%2 == 1):
00513                         \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GR
      OUPS]:
00514                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCel
      l.CONFIG\_COLOR, tab, offset + navicell\_offset, 0)
00515                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCel
      l.CONFIG\_COLOR, tab, offset + navicell\_offset, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_colors[half\_
      count])
00516                         offset += 1
00517                     \textcolor{comment}{# Positive values}
00518                     \textcolor{keywordflow}{if} (maxval < 0): maxval = 1
00519                     step = maxval/half\_count
00520                     values\_list = [signif(val) \textcolor{keywordflow}{for} val \textcolor{keywordflow}{in} np.arange(0., maxval+st
      ep/2, step)][1:]
00521                     \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(half\_count):
00522                         value = values\_list[ii]
00523                         color = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_colors[offset + ii]
00524                         \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GR
      OUPS]:
00525                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCel
      l.CONFIG\_COLOR, tab, navicell\_offset + offset + ii, value)
00526                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCel
      l.CONFIG\_COLOR, tab, navicell\_offset + offset + ii, color)
00527                 \textcolor{keywordflow}{else}:
00528                     \textcolor{keywordflow}{if} (step\_count == 2):
00529                         values\_list = [minval, maxval]
00530                     \textcolor{keywordflow}{else}:
00531                         values\_list = [minval, 0, maxval]
00532                     \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS
      ]:
00533                         \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(values\_list)):
00534                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCel
      l.CONFIG\_COLOR, tab, navicell\_offset + ii, values\_list[ii])
00535                             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCel
      l.CONFIG\_COLOR, tab, navicell\_offset + ii, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_colors[ii])
00536             \textcolor{keywordflow}{else}:
00537                 \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(step\_count):
00538                     value = np.percentile(dtable, ii*100/(step\_count-1))
00539                     \textcolor{keywordflow}{if} (ii==0): value = minval
00540                     \textcolor{keywordflow}{elif} (ii==(step\_count-1)): value = maxval
00541                     color = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.\_colors[ii]
00542                     \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS
      ]:
00543                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetValueAt(\textcolor{stringliteral}{''}, dname, NaviCell.CO
      NFIG\_COLOR, tab, navicell\_offset + ii, value)
00544                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetColorAt(\textcolor{stringliteral}{''}, dname, NaviCell.CO
      NFIG\_COLOR, tab, navicell\_offset + ii, color)
00545 
00546             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetSampleMethod(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG\_CO
      LOR, NaviCell.METHOD\_CONTINUOUS\_MEDIAN) \textcolor{comment}{# TODO change to MEAN when group mean is 
      corrected to <= instead of <}
00547             \textcolor{keywordflow}{if} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.use\_absolute\_values:
00548                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetSampleAbsoluteValue(\textcolor{stringliteral}{""}, dname, NaviCel
      l.CONFIG\_COLOR, \textcolor{keyword}{True})
00549             \textcolor{keywordflow}{else}:
00550                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetSampleAbsoluteValue(\textcolor{stringliteral}{""}, dname, NaviCel
      l.CONFIG\_COLOR, \textcolor{keyword}{False})
00551 
00552         \textcolor{comment}{## Size configuration TODO add zero if present}
00553         \textcolor{keywordflow}{for} glyph\_id \textcolor{keywordflow}{in} range(1, MAX\_GLYPHS):
00554             \textcolor{keywordflow}{for} tab \textcolor{keywordflow}{in} [NaviCell.TABNAME\_SAMPLES, NaviCell.TABNAME\_GROUPS]:
00555                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigSetSizeAt(\textcolor{stringliteral}{""}, dname, NaviCell.CONFIG\_SIZE
      , tab, 0, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8ddca454f674629472d8bfec46ac76f}{_display_config}.na\_size)
00556 
00557         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigApply(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG\_COLOR)
00558         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigApply(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG\_SIZE)
00559         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.datatableConfigApply(\textcolor{stringliteral}{''}, dname, NaviCell.CONFIG\_SHAPE)
00560         
00561     \textcolor{comment}{# Display data}
00562     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}(self, perform\_list, default\_samples="all: 1.0\textcolor{stringliteral}{", colors="}\textcolor{stringliteral}{", module
      ='', reset=True):}
00563 \textcolor{stringliteral}{        }\textcolor{stringliteral}{"""}
00564 \textcolor{stringliteral}{        Display data on the NaviCell map}
00565 \textcolor{stringliteral}{        Args :}
00566 \textcolor{stringliteral}{            perform\_list (list of 2-tuples): each tuple must contain the name of 
      the data to display and the mode of display ("glyphN\_(color|size|shape)", "barplo
      t", "heatmap" or "map\_staining"). Barplots and heatmaps cannot be displayed simul
      taneously. Several data types can be specified for heatmaps. Specifying "glyph" (
      without number) will automatically select a new glyph for each data using the sam
      e properties (shape, color or size) in glyphs (maximum of 5 glyphs).}
00567 \textcolor{stringliteral}{            colors : range of colors to use (NOT IMPLEMENTED YET)}
00568 \textcolor{stringliteral}{            default\_samples (str or list of str) : Samples to use. Only the first
       sample is used for glyphs and map staining, all default\_samples from the list ar
      e used for heatmaps and barplots. Use 'all\_samples' to use all default\_samples or
       ['annot1:...:annotn', 'all\_groups'] to use all groups corresponding to the combi
      nations of annot1...annotn.}
00569 \textcolor{stringliteral}{        """}
00570         \textcolor{comment}{# Correct if the user give a single tuple}
00571         \textcolor{keywordflow}{if} (isinstance(perform\_list, tuple)):
00572             perform\_list = [perform\_list]
00573         \textcolor{keyword}{assert} isinstance(perform\_list, list), \textcolor{stringliteral}{"perform list must be a list"}
00574         \textcolor{keyword}{assert} isinstance(perform\_list[0], tuple) \textcolor{keywordflow}{and} (len(perform\_list[0]) == 2 
      \textcolor{keywordflow}{or} len(perform\_list[0]) == 3), \textcolor{stringliteral}{"perform list must be a list of (2/3)-tuples"}
00575         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab468a31a5f439bcae23f4c75b8c67f65}{_checkBrowser}()
00576         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a5a59edead26b5d02f17a60df055576f5}{exportAnnotations}()
00577         \textcolor{keywordflow}{if} (reset):
00578             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a379f15a87ba5c41c3501e9f386102c05}{resetDisplay}()
\hypertarget{navicom_8py_source_l00579}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{00579} 
00580         \textcolor{comment}{# Preprocess the perform list to get valid data\_name, and export data tha
      t have not been exported yet}
00581         \textcolor{keywordflow}{if} (DEBUG\_NAVICOM):
00582             \textcolor{keywordflow}{print}(perform\_list)
00583         \textcolor{keywordflow}{for} perf\_id \textcolor{keywordflow}{in} range(len(perform\_list)):
00584             data\_name = perform\_list[perf\_id][0]
00585             perform = perform\_list[perf\_id]
00586             \textcolor{keywordflow}{if} (isinstance(data\_name, str)):
00587                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} data\_name \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}):
00588                     data\_name = data\_name + \textcolor{stringliteral}{"\_raw"}
00589                 data\_name = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2e1d67aee497222ac3e508f6812d6a10}{_associated_data}[data\_name]
00590             processing = data\_name[0]
00591             method = data\_name[1]
00592             \textcolor{keyword}{assert} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac6a14d6a91cd2f236eef71496a6f249c}{_processings}, \textcolor{stringliteral}{"Processing "} + processing + 
      \textcolor{stringliteral}{" does not exist"}
00593             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb8ef6988c65589c35ad11dcb8681787}{_exportData}(method, processing)
00594             \textcolor{keywordflow}{if} (len(perform) >= 3 \textcolor{keywordflow}{and} perform[2] != default\_samples):
00595                 perform\_list[perf\_id] = (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing][method], pe
      rform[1], perform[2])
00596             \textcolor{keywordflow}{else}:
00597                 perform\_list[perf\_id] = (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing][method], pe
      rform[1], \textcolor{stringliteral}{''})
00598         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb8ef6988c65589c35ad11dcb8681787}{_exportData}(\textcolor{stringliteral}{"uniform"})
00599 
00600         \textcolor{comment}{# Control that the user does not try to display to many data or use sever
      al times the same display}
00601         \textcolor{keywordflow}{if} (\textcolor{keyword}{True}):
00602             glyph = dict()
00603             \textcolor{keywordflow}{for} gtype \textcolor{keywordflow}{in} GLYPH\_TYPES:
00604                 glyph[gtype] = [\textcolor{keyword}{False}] * MAX\_GLYPHS
00605             sample\_for\_glyph = [\textcolor{keyword}{False}] * MAX\_GLYPHS
00606             glyph\_samples = [\textcolor{stringliteral}{""}] * MAX\_GLYPHS
00607             glyph\_set = \textcolor{keyword}{False}
00608             heatmap = \textcolor{keyword}{False}
00609             barplot = \textcolor{keyword}{False}
00610             barplot\_data = \textcolor{stringliteral}{""}
00611             map\_staining = \textcolor{keyword}{False}
00612             default\_samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2acd087f6c61dc8c7e1bc5a3391ff982}{_processSampleSelection}(default\_samples)
00613             samples = default\_samples
00614             lastWasDefault = \textcolor{keyword}{True}
00615             valid\_default = (len(default\_samples) == 1 \textcolor{keywordflow}{and} default\_samples != \textcolor{stringliteral}{"al
      l\_groups"} \textcolor{keywordflow}{and} default\_samples != \textcolor{stringliteral}{"all\_samples"})
00616         \textcolor{comment}{# Perform the display depending of the selected mode}
00617         \textcolor{keywordflow}{for} perform \textcolor{keywordflow}{in} perform\_list:
00618             all\_samples = \textcolor{keyword}{False}
00619             all\_groups = \textcolor{keyword}{False}
00620             data\_name = perform[0]
00621             dmode = perform[1]
00622             dmode = dmode.lower()
00623             \textcolor{comment}{# Check groups in NaviCell and get a valid list of samples, reload de
      fault if not the last used}
00624             \textcolor{keywordflow}{if} (perform[2] == \textcolor{stringliteral}{''}):
00625                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} lastWasDefault):
00626                     samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2acd087f6c61dc8c7e1bc5a3391ff982}{_processSampleSelection}(default\_samples)
00627                     lastWasDefault = \textcolor{keyword}{True}
00628             \textcolor{keywordflow}{else}:
00629                 samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2acd087f6c61dc8c7e1bc5a3391ff982}{_processSampleSelection}(perform[2])
00630                 lastWasDefault = \textcolor{keyword}{False}
00631             \textcolor{keywordflow}{if} (samples == \textcolor{stringliteral}{"all\_groups"}):
00632                 all\_groups = \textcolor{keyword}{True}
00633             \textcolor{keywordflow}{elif} (samples == \textcolor{stringliteral}{"all\_samples"}):
00634                 all\_samples = \textcolor{keyword}{True}
00635 
00636             \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"^(glyph|color|size|shape)"}, dmode)):
00637                 glyph\_set = \textcolor{keyword}{True}
00638                 \textcolor{comment}{# Extract the glyph id and the setup}
00639                 parse\_setup = dmode.split(\textcolor{stringliteral}{"\_"})
00640                 glyph\_setup = parse\_setup
00641                 \textcolor{keywordflow}{if} (len(parse\_setup) == 2):
00642                     \textcolor{keywordflow}{try}:
00643                         glyph\_setup = [parse\_setup[1] + str(int(parse\_setup[0][-1
      ]))]
00644                     \textcolor{keywordflow}{except} ValueError:
00645                         glyph\_setup = [parse\_setup[1]]
00646                 \textcolor{keywordflow}{elif} (len(parse\_setup) != 1):
00647                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Glyph specification '"} + dmode + \textcolor{stringliteral}{"' incorre
      ct"})
00648                 \textcolor{keywordflow}{try}: \textcolor{comment}{# Use the number is specified...}
00649                     glyph\_number = int(glyph\_setup[0][-1])
00650                     glyph\_type = glyph\_setup[0][:-1]
00651                 \textcolor{keywordflow}{except} ValueError: \textcolor{comment}{# ... or use the first free slot for the type 
      selected}
00652                     glyph\_type = glyph\_setup[0]
00653                     glyph\_number = 1
00654                     \textcolor{keywordflow}{while} (glyph[glyph\_type][glyph\_number-1]):
00655                         glyph\_number += 1
00656                 glyph\_id = glyph\_number - 1
00657                 
00658                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph\_number \textcolor{keywordflow}{in} range(1, MAX\_GLYPHS+1)):
00659                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Glyph number must be in [1,"} + str(MAX\_GLYP
      HS) + \textcolor{stringliteral}{"]"})
00660                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph\_type \textcolor{keywordflow}{in} GLYPH\_TYPES):
00661                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Glyph type must be one of "} + str(GLYPH\_TYP
      ES))
00662                 \textcolor{keywordflow}{if} (glyph[glyph\_type][glyph\_number-1]):
00663                     \textcolor{keywordflow}{raise} ValueError(glyph\_type + \textcolor{stringliteral}{" for glyph "} + str(glyph\_numbe
      r) + \textcolor{stringliteral}{" has already been specified"})
00664                 glyph[glyph\_type][glyph\_number-1] = \textcolor{keyword}{True}
00665                 \textcolor{keywordflow}{if} (len(samples) != 1 \textcolor{keywordflow}{or} samples == \textcolor{stringliteral}{"all\_groups"} \textcolor{keywordflow}{or} samples == \textcolor{stringliteral}{"a
      ll\_samples"}):
00666                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Only one group or sample can be used for gl
      yphs"})
00667 
00668                 \textcolor{keywordflow}{if} (lastWasDefault):
00669                     \textcolor{keywordflow}{pass}
00670                 \textcolor{keywordflow}{elif} (glyph\_samples[glyph\_id] == \textcolor{stringliteral}{""}):
00671                     glyph\_samples[glyph\_id] = samples[0]
00672                     sample\_for\_glyph[glyph\_id] = \textcolor{keyword}{True}
00673                 \textcolor{keywordflow}{elif} (glyph\_samples[glyph\_id] != samples[0]):
00674                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Only one sample can be specified per glyph"
      })
00675 
00676                 cmd=\textcolor{stringliteral}{"self.\_nv.glyphEditorSelect"} + glyph\_type.capitalize() + \textcolor{stringliteral}{"Dat
      atable('"} + module +  \textcolor{stringliteral}{"', "} + str(glyph\_number) + \textcolor{stringliteral}{", '"} + data\_name + \textcolor{stringliteral}{"')"}
00677                 \textcolor{keywordflow}{if} (DEBUG\_NAVICOM):
00678                     \textcolor{keywordflow}{print}(cmd)
00679                 exec(cmd)
00680             \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"map\_?staining"}, dmode)):
00681                 \textcolor{keyword}{assert} valid\_default, \textcolor{stringliteral}{"Only one sample can be used for map staini
      ng"}
00682                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} map\_staining):
00683                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.mapStainingEditorSelectDatatable(module, data\_name)
00684                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.mapStainingEditorSelectSample(module, samples[0])
00685                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.mapStainingEditorApply(module)
00686                     map\_staining = \textcolor{keyword}{True}
00687                 \textcolor{keywordflow}{else}:
00688                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Map staining can only be applied once, use 
      a separate call to the display function to change map staining"})
00689             \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"heatmap"}, dmode)):
00690                 \textcolor{keywordflow}{if} (barplot):
00691                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Heatmaps and barplots cannot be applied sim
      ultaneously, use a separate call to the display function to perform the heatmap"})
      
00692                 heatmap = \textcolor{keyword}{True}
00693                 \textcolor{comment}{# Select data}
00694                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorSelectDatatable(module, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a095a4a928f1f09319fafc949f8580f78}{_hdid}, data\_na
      me)
00695                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a095a4a928f1f09319fafc949f8580f78}{_hdid} += 1
00696                 \textcolor{comment}{# Select samples}
00697                 \textcolor{keywordflow}{if} (all\_samples):
00698                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorAllSamples(module)
00699                 \textcolor{keywordflow}{elif} (all\_groups):
00700                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorAllGroups(module)
00701                 \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abf768fde5caf68a79e19385b48ea0bcc}{_hsid} == 0):
00702                     \textcolor{keywordflow}{for} spl \textcolor{keywordflow}{in} samples:
00703                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorSelectSample(module, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abf768fde5caf68a79e19385b48ea0bcc}{_hsid}, sp
      l)
00704                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abf768fde5caf68a79e19385b48ea0bcc}{_hsid} += 1
00705                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorApply(module)
00706             \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"barplot"}, dmode)):
00707                 \textcolor{keywordflow}{if} (heatmap):
00708                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Heatmaps and barplots cannot be applied sim
      ultaneously, use a separate call to the display function to perform the barplot"})
      
00709                 \textcolor{comment}{# Check that it does not try to add new data, and simply adds sam
      ples # TODO Remove as samples cannot be added (resetDisplay at the beginning)}
00710                 \textcolor{keywordflow}{if} (barplot \textcolor{keywordflow}{and} data\_name != barplot\_data \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} re.search(\textcolor{stringliteral}{"all|
      groups|samples"}, data\_name)):
00711                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Barplot has already been set with different
       data, use a separate call to the display function to perform another barplot"})
00712                 barplot = \textcolor{keyword}{True}
00713                 barplot\_data = data\_name
00714                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorSelectDatatable(module, data\_name)
00715                 \textcolor{comment}{# Select samples}
00716                 \textcolor{keywordflow}{if} (all\_samples):
00717                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorAllSamples(module)
00718                 \textcolor{keywordflow}{elif} (all\_groups):
00719                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorAllGroups(module)
00720                 \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a496d13fc4c8b73cef4f496b713d12b79}{_bid} == 0):
00721                     \textcolor{keywordflow}{for} spl \textcolor{keywordflow}{in} samples:
00722                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorSelectSample(module, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a496d13fc4c8b73cef4f496b713d12b79}{_bid}, spl
      )
00723                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a496d13fc4c8b73cef4f496b713d12b79}{_bid} += 1
00724                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorApply(module)
00725             \textcolor{keywordflow}{else}:
00726                 \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"'"} + dmode + \textcolor{stringliteral}{"' drawing mode does not exist"})
00727 
00728         \textcolor{comment}{# Check that datatables are selected for all glyphs features (until defau
      lt has been added)}
00729         \textcolor{comment}{# or complete, then apply the glyphs configuration}
00730         default\_samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2acd087f6c61dc8c7e1bc5a3391ff982}{_processSampleSelection}(default\_samples)
00731         \textcolor{keywordflow}{if} (glyph\_set):
00732             \textcolor{keywordflow}{for} glyph\_id \textcolor{keywordflow}{in} range(MAX\_GLYPHS):
00733                 nsets = sum(1 \textcolor{keywordflow}{for} cs \textcolor{keywordflow}{in} GLYPH\_TYPES \textcolor{keywordflow}{if} glyph[cs][glyph\_id])
00734                 \textcolor{keywordflow}{if} (nsets > 0):
00735                     \textcolor{keywordflow}{if} (sample\_for\_glyph[glyph\_id]):
00736                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorSelectSample(module, glyph\_id+1, self
      .\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a2acd087f6c61dc8c7e1bc5a3391ff982}{_processSampleSelection}(glyph\_samples[glyph\_id]))
00737                     \textcolor{keywordflow}{elif} (valid\_default):
00738                         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Using default sample for glyph "} + str(glyph\_id+1)
      )
00739                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorSelectSample(module, glyph\_id+1, defa
      ult\_samples[0])
00740                     \textcolor{keywordflow}{else}:
00741                         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"No samples specified for glyph "} + str(
      glyph\_id+1) + \textcolor{stringliteral}{" and default\_samples is invalid"})
00742                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph[\textcolor{stringliteral}{"color"}][glyph\_id]):
00743                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorSelectColorDatatable(module, glyph\_id
      +1, \textcolor{stringliteral}{"uniform"})
00744                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph[\textcolor{stringliteral}{"shape"}][glyph\_id]):
00745                        self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorSelectShapeDatatable(module, glyph\_id+
      1, \textcolor{stringliteral}{"uniform"})
00746                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} glyph[\textcolor{stringliteral}{"size"}][glyph\_id]):
00747                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorSelectSizeDatatable(module, glyph\_id+
      1, \textcolor{stringliteral}{"uniform"})
00748                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorApply(module, glyph\_id+1)
00749 
00750     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a379f15a87ba5c41c3501e9f386102c05}{resetDisplay}(self):
00751         \textcolor{stringliteral}{"""}
00752 \textcolor{stringliteral}{        Reset the data and samples selections in NaviCell}
00753 \textcolor{stringliteral}{        """}
00754         \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a496d13fc4c8b73cef4f496b713d12b79}{_bid}):
00755             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorSelectSample(\textcolor{stringliteral}{''}, ii, \textcolor{stringliteral}{''})
00756         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.barplotEditorSelectDatatable(\textcolor{stringliteral}{''}, \textcolor{stringliteral}{''})
00757         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.drawingConfigSelectBarplot(\textcolor{stringliteral}{''}, \textcolor{keyword}{False})
00758 
00759         \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abf768fde5caf68a79e19385b48ea0bcc}{_hsid}):
00760             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorSelectSample(\textcolor{stringliteral}{''}, ii, \textcolor{stringliteral}{''})
00761         \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a095a4a928f1f09319fafc949f8580f78}{_hdid}):
00762             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.heatmapEditorSelectDatatable(\textcolor{stringliteral}{''}, ii, \textcolor{stringliteral}{''})
\hypertarget{navicom_8py_source_l00763}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a379f15a87ba5c41c3501e9f386102c05}{00763}         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.drawingConfigSelectHeatmap(\textcolor{stringliteral}{''}, \textcolor{keyword}{False})
00764 
00765         \textcolor{keywordflow}{for} gid \textcolor{keywordflow}{in} range(1, MAX\_GLYPHS):
00766             \textcolor{keywordflow}{for} gt \textcolor{keywordflow}{in} GLYPH\_TYPES:
00767                 exec(\textcolor{stringliteral}{"self.\_nv.glyphEditorSelect"} + gt.capitalize() + \textcolor{stringliteral}{"Datatable(
      '', "} + str(gid) + \textcolor{stringliteral}{", '')"})
00768             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.glyphEditorSelectSample(\textcolor{stringliteral}{''}, gid, \textcolor{stringliteral}{''})
00769             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.drawingConfigSelectGlyph(\textcolor{stringliteral}{''}, gid, \textcolor{keyword}{False})
00770         
00771         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.drawingConfigSelectMapStaining(\textcolor{stringliteral}{''}, \textcolor{keyword}{False})
00772         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.drawingConfigApply(\textcolor{stringliteral}{''})
00773 
00774         \textcolor{comment}{# Reset the counters}
00775         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a496d13fc4c8b73cef4f496b713d12b79}{_bid} = 0
00776         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_abf768fde5caf68a79e19385b48ea0bcc}{_hsid} = 0
00777         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a095a4a928f1f09319fafc949f8580f78}{_hdid} = 0
00778 
00779     \textcolor{keyword}{def }\_resetAnnotationsSelection(self, module=''):
00780         \textcolor{keywordflow}{for} annot \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb88722efeb86813dcb85818b7065330}{_annotations}.\_annotations:
00781             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.sampleAnnotationSelectAnnotation(module, annot, \textcolor{keyword}{False})
00782         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.sampleAnnotationApply(module)
00783 
00784     \textcolor{keyword}{def }\_selectAnnotations(self, annotations, module=''):
00785         \textcolor{stringliteral}{"""}
00786 \textcolor{stringliteral}{        Select annotations on the NaviCell map}
00787 \textcolor{stringliteral}{        """}
00788         \textcolor{keywordflow}{if} (isinstance(annotations, str)):
00789             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.sampleAnnotationSelectAnnotation(module, annotations, \textcolor{keyword}{True})
00790         \textcolor{keywordflow}{elif} (isinstance(annotations, list)):
00791             \textcolor{keywordflow}{for} annot \textcolor{keywordflow}{in} annotations:
00792                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.sampleAnnotationSelectAnnotation(module, annot, \textcolor{keyword}{True})
00793         \textcolor{keywordflow}{else}:
00794             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"'annotations' must be a string or a list"})
00795         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}.sampleAnnotationApply(module)
00796 
00797     \textcolor{keyword}{def }\_processSampleSelection(self, current\_samples):
00798         \textcolor{stringliteral}{"""}
00799 \textcolor{stringliteral}{        Process a list of samples or groups to a list of samples/groups names exp
      ortable to NaviCell or to "all\_groups"/"all\_samples" for heatmap and barplot, and
       select the correct groups in NaviCell}
00800 \textcolor{stringliteral}{        """}
00801 
00802         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a26866ef971b6bcb8b00ca742d47d0ea9}{_resetAnnotationsSelection}()
00803         \textcolor{comment}{# Make sure current\_samples is a list}
00804         all\_groups = \textcolor{keyword}{False}
00805         \textcolor{keywordflow}{if} (isinstance(current\_samples, str)):
00806             current\_samples = [current\_samples]
00807 
00808         \textcolor{comment}{# It is possible to select all samples or all groups on heatmap and barpl
      ot}
00809         \textcolor{keywordflow}{if} (current\_samples[0] == \textcolor{stringliteral}{"all\_samples"} \textcolor{keywordflow}{or} current\_samples[0] == \textcolor{stringliteral}{"samples
      "}):
00810             \textcolor{keywordflow}{return} \textcolor{stringliteral}{"all\_samples"}
00811         \textcolor{keywordflow}{elif} (current\_samples[0] == \textcolor{stringliteral}{"all"} \textcolor{keywordflow}{or} current\_samples[0] == \textcolor{stringliteral}{"all: 1.0"}):
00812             self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a7e1aa831f14b151b7b5787c8b6128cef}{_selectAnnotations}(\textcolor{stringliteral}{"all"})
00813             \textcolor{keywordflow}{return} [\textcolor{stringliteral}{"all: 1.0"}]
00814         \textcolor{keywordflow}{elif} (len(current\_samples) > 1 \textcolor{keywordflow}{and} (current\_samples[1] == \textcolor{stringliteral}{"all\_groups"} \textcolor{keywordflow}{or
      } current\_samples[1] == \textcolor{stringliteral}{"groups"})):
00815             all\_groups = \textcolor{keyword}{True}
00816 
00817         refGroupsList = []
00818         first\_groups = \textcolor{keyword}{True}
00819         \textcolor{comment}{# Select the groups that must be selected to produce the composite groups
       required}
00820         \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} current\_samples:
00821             groups = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1b8f14be167905533ab7e18294dd9100}{_processGroupsName}(sample)[0]
00822             \textcolor{comment}{# Check that all groups are compatible in the annotations selected (b
      ecause lower order composition are not generated). No check for individual sample
      s}
00823             \textcolor{keywordflow}{if} (len(groups) >= 1):
00824                 \textcolor{keywordflow}{if} (first\_groups): \textcolor{comment}{# Select the set of annotations for the first 
      group}
00825                     \textcolor{keywordflow}{if} (DEBUG\_NAVICOM):
00826                         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Selecting "} + str(groups))
00827                     \textcolor{keywordflow}{for} group \textcolor{keywordflow}{in} groups:
00828                         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a7e1aa831f14b151b7b5787c8b6128cef}{_selectAnnotations}(group) 
00829                         refGroupsList.append(group)
00830                         first\_groups = \textcolor{keyword}{False}
00831                 \textcolor{keywordflow}{else}: \textcolor{comment}{# Control that all other groups are compatible}
00832                         \textcolor{keyword}{assert} len(group)==0 \textcolor{keywordflow}{or} len(refGroupsList)==0 \textcolor{keywordflow}{or} len(grou
      p)==len(refGroupsList), \textcolor{stringliteral}{"Groups combinations are not compatible, different number
       of groups"}
00833                         \textcolor{keywordflow}{for} group \textcolor{keywordflow}{in} groups:
00834                             \textcolor{keyword}{assert} group \textcolor{keywordflow}{in} refGroupsList, \textcolor{stringliteral}{"Groups combinations a
      re not compatibles as "} + group + \textcolor{stringliteral}{" is not in "} + str(refGroupsList)
00835 
00836         \textcolor{keywordflow}{if} (all\_groups):
00837             \textcolor{keywordflow}{return} \textcolor{stringliteral}{"all\_groups"}
00838         \textcolor{keywordflow}{return} current\_samples
00839 
00840     \textcolor{keyword}{def }\_processGroupsName(self, groupName):
00841         \textcolor{stringliteral}{"""}
00842 \textcolor{stringliteral}{        Process a group selection string and return the names of the individual g
      roups to select and the corresponding values selected.}
00843 \textcolor{stringliteral}{        """}
00844         selections = groupName.split(\textcolor{stringliteral}{";"})
00845         groups = list()
00846         values = list()
00847         \textcolor{keywordflow}{for} select \textcolor{keywordflow}{in} selections:
00848             subName = select.split(\textcolor{stringliteral}{":"})
00849             group = subName[0].strip()
00850             \textcolor{keywordflow}{if} (group \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb88722efeb86813dcb85818b7065330}{_annotations}.\_annotations):
00851                 value = subName[1].strip()
00852                 groups.append(group)
00853                 \textcolor{keywordflow}{try}:
00854                     values.append(float(value))
00855                 \textcolor{keywordflow}{except} ValueError:
00856                     values.append(value)
00857             \textcolor{keywordflow}{elif} (\textcolor{keywordflow}{not} (group \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb88722efeb86813dcb85818b7065330}{_annotations}.\_samples \textcolor{keywordflow}{or} re.match(\textcolor{stringliteral}{"sub"}, gro
      up) \textcolor{keywordflow}{or} group == \textcolor{stringliteral}{"NaN"})):
00858                 \textcolor{keywordflow}{if} (len(subName) > 1):
00859                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Annotation "} + group + \textcolor{stringliteral}{" does not exist"})
00860                 \textcolor{keywordflow}{else}:
00861                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Sample "} + group + \textcolor{stringliteral}{" does not exist"})
00862         \textcolor{keywordflow}{return}((groups, values))
00863 
00864     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a018f936de625af8a5dd7e8250ede6483}{displayMethylome}(self, samples="all: 1.0\textcolor{stringliteral}{", processing="}raw\textcolor{stringliteral}{", background="
      }mRNA\textcolor{stringliteral}{", methylation="}glyph\textcolor{stringliteral}{"):}
00865 \textcolor{stringliteral}{        }\textcolor{stringliteral}{"""}
00866 \textcolor{stringliteral}{            Display the methylation data as glyphs or heatmap on the NaviCell map
      , with mRNA expression of gene CNV as map staining}
00867 \textcolor{stringliteral}{            Args:}
00868 \textcolor{stringliteral}{                background (str) : should genes, mRNA or no data be used for the 
      map staining}
00869 \textcolor{stringliteral}{                processing (str) : should the processed data be used}
00870 \textcolor{stringliteral}{        """}
00871         \textcolor{comment}{# Groups cannot be used for now because of limitations in NaviCell unless
       the median is taken as grouping operation}
00872         mrna\_alias = [\textcolor{stringliteral}{"MRNA"}] \textcolor{comment}{# TODO Define what to put here}
00873         gene\_alias = [\textcolor{stringliteral}{"CNV"}, \textcolor{stringliteral}{"CNA"}, \textcolor{stringliteral}{"CCNA"}, \textcolor{stringliteral}{"CCNV"}, \textcolor{stringliteral}{"DNA"}]
00874         background = background.upper()
00875         \textcolor{keyword}{assert} background \textcolor{keywordflow}{in} mrna\_alias + gene\_alias + [\textcolor{stringliteral}{"NO"}, \textcolor{stringliteral}{""}], \textcolor{stringliteral}{"Select either
       genes, mRNA or no data for the map staining"}
00876         \textcolor{keyword}{assert} methylation \textcolor{keywordflow}{in} [\textcolor{stringliteral}{"glyph"}, \textcolor{stringliteral}{"glyphs"}, \textcolor{stringliteral}{"heatmap"}, \textcolor{stringliteral}{"size"}, \textcolor{stringliteral}{"glyph\_size"
      }], \textcolor{stringliteral}{"Cannot use "} + methylation + \textcolor{stringliteral}{" to display methylation data"}
00877         \textcolor{keywordflow}{if} (methylation != \textcolor{stringliteral}{"heatmap"}): methylation=\textcolor{stringliteral}{"size"}
00878         \textcolor{keyword}{assert} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}, \textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{" does not 
      exist"}
00879 
00880         \textcolor{comment}{# Select all methylation data and display as heatmap}
00881         disp\_selection = list()
00882         \textcolor{keywordflow}{for} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]:
00883             included = method.lower() \textcolor{keywordflow}{in} METHODS\_TYPE
00884             \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"methylation"}, method.lower()) \textcolor{keywordflow}{or} (included \textcolor{keywordflow}{and} METHODS
      \_TYPE[method.lower()] == \textcolor{stringliteral}{"methylation"})):
00885                 disp\_selection.append((self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing][method], meth
      ylation)) \textcolor{comment}{# TODO Change to barplot when several datatables can be used}
\hypertarget{navicom_8py_source_l00886}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a018f936de625af8a5dd7e8250ede6483}{00886}         \textcolor{comment}{# Display mRNA or gene data as map staining}
00887         \textcolor{keywordflow}{if} (background \textcolor{keywordflow}{in} mrna\_alias):
00888             \textcolor{keywordflow}{for} mrna \textcolor{keywordflow}{in} TYPES\_SPEC[\textcolor{stringliteral}{"mRNA"}][0]:
00889                 \textcolor{keywordflow}{if} (mrna \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]):
00890                     disp\_selection.append((self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing][mrna], \textcolor{stringliteral}{"m
      ap\_staining"}))
00891                     \textcolor{keywordflow}{break}
00892         \textcolor{keywordflow}{elif} (background \textcolor{keywordflow}{in} gene\_alias):
00893             \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} TYPES\_SPEC[\textcolor{stringliteral}{"cCNA"}]+TYPES\_SPEC[\textcolor{stringliteral}{"dCNA"}]:
00894                 \textcolor{keywordflow}{if} (gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]):
00895                     disp\_selection.append((self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab8c34ab1a6d2a23f9b9ecee65375317a}{_data_names}[processing][mrna], \textcolor{stringliteral}{"m
      ap\_staining"}))
00896                     \textcolor{keywordflow}{break}
00897         \textcolor{keywordflow}{if} (DEBUG\_NAVICOM):
00898             \textcolor{keywordflow}{print}(disp\_selection)
00899             \textcolor{keywordflow}{print}(samples)
00900         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}(disp\_selection, samples)
00901 
00902     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a01066363389ca01c24f683956f3dc9ad}{displayOmics}(self, dataName, group="all: 1.0\textcolor{stringliteral}{", samplesDisplay="}\textcolor{stringliteral}{", samples
      =list(), binsNb=10):}
00903 \textcolor{stringliteral}{        }\textcolor{stringliteral}{"""}
00904 \textcolor{stringliteral}{        Display one -omics datatable as map staining, with optionnaly some extra 
      information displayed on top (samples as heatmap or barplot, mutations as glyphs,
       a glyph for the most highly expressed genes, distribution as heatmap)}
00905 \textcolor{stringliteral}{        Args:}
00906 \textcolor{stringliteral}{            dataName (str or tuple): name or identifier of the data.}
00907 \textcolor{stringliteral}{            group (str): Identifier of the group to display}
00908 \textcolor{stringliteral}{            samplesDisplay (str): Channel where the individual samples should be 
      displayed (heatmap or barplot)}
00909 \textcolor{stringliteral}{            samples (list or str): list of samples to display, or a string specif
      ying how such a list should be built ('quantiles' to get the distribution of valu
      es)}
00910 \textcolor{stringliteral}{            nbOfSamples (int): number of individual samples to display, ignored i
      f samples is a list}
00911 \textcolor{stringliteral}{        """}
00912         allowedDisplays = [\textcolor{stringliteral}{""}, \textcolor{stringliteral}{"heatmap"}, \textcolor{stringliteral}{"barplot"}]
00913         \textcolor{keyword}{assert} samplesDisplay \textcolor{keywordflow}{in} allowedDisplays, \textcolor{stringliteral}{"samplesDisplay must one of "} +
       str(allowedDisplays)
00914         dataName = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a51ecb41beebc7636bde73be2e1ffc407}{getDataName}(dataName)
00915         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}([(dataName, \textcolor{stringliteral}{"map\_staining"})], group)
00916         \textcolor{keywordflow}{if} (samplesDisplay != \textcolor{stringliteral}{""}):
00917             \textcolor{keywordflow}{if} (isinstance(samples, list) \textcolor{keywordflow}{and} len(samples) > 0):
00918                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}([(dataName, samplesDisplay)], samples, reset=\textcolor{keyword}{False})
00919             \textcolor{keywordflow}{elif} (isinstance(samples, str) \textcolor{keywordflow}{and} samples != \textcolor{stringliteral}{""}):
00920                 \textcolor{keywordflow}{if} (samples == \textcolor{stringliteral}{"quantiles"}):
00921                     distName, distSamples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a4d7a97aa1699c943238988b8d41b73e0}{_generateDistributionData}(dataNa
      me, group, binsNb)
00922                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"distribution"}][distName].exportToNaviCell(self.
      \hyperlink{classnavicom_1_1navicom_1_1NaviCom_afff3fd56fa16a68bab52ba8d801e325a}{_nv}, TYPES\_BIOTYPE[\textcolor{stringliteral}{'mRNA'}], distName)
00923                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}([(distName, samplesDisplay)], distSamples, reset
      =\textcolor{keyword}{False})
00924                 \textcolor{keywordflow}{else}:
00925                     self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad7d4390d700d4a6d2533647887f8ab94}{display}([(dataName, samplesDisplay)], [samples], reset=\textcolor{keyword}{F
      alse})
00926 
\hypertarget{navicom_8py_source_l00927}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a01066363389ca01c24f683956f3dc9ad}{00927}     \textcolor{keyword}{def }\_generateDistributionData(self, dataName, group, binsNb=10):
00928         \textcolor{stringliteral}{"""}
00929 \textcolor{stringliteral}{        Compute distribution of values for all genes for one type of data. Use th
      e same scale for all genes. The distribution is centered on 0 if it is included, 
      so that it is easy to see if a gene is over- or under-expressed.}
00930 \textcolor{stringliteral}{        """}
00931         groups, values = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a1b8f14be167905533ab7e18294dd9100}{_processGroupsName}(group)
00932         \textcolor{keywordflow}{if} (len(groups) < 1):
00933             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Cannot generate a distribution without a valid grou
      p"})
00934         \textcolor{comment}{# Each distribution }
00935         distName = \textcolor{stringliteral}{"distribution\_"} + dataName + \textcolor{stringliteral}{"\_"} + re.sub(\textcolor{stringliteral}{" "}, \textcolor{stringliteral}{"\_"}, group) + \textcolor{stringliteral}{"
      \_"} + str(binsNb)
00936         distSamples = [\textcolor{stringliteral}{"sub"} + str(ii) \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(binsNb)] + [\textcolor{stringliteral}{"NaN"}]
00937         \textcolor{keywordflow}{if} (distName \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"distribution"}]):
00938             \textcolor{keywordflow}{return}(distName)
00939 
00940         \textcolor{comment}{# Identify the samples selected by the group definition}
00941         samples = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb88722efeb86813dcb85818b7065330}{_annotations}.\_samplesPerCategory[groups[0]][values[0]]
00942         \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} range(1, len(groups)):
00943             to\_drop = list()
00944             \textcolor{keywordflow}{for} spl \textcolor{keywordflow}{in} samples:
00945                 \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} spl \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb88722efeb86813dcb85818b7065330}{_annotations}.\_samplesPerCategory[groups[idx]]
      [values[idx]]):
00946                     to\_drop.append(spl)
00947             \textcolor{keywordflow}{for} spl \textcolor{keywordflow}{in} to\_drop:
00948                 samples.remove(spl)
00949 
00950         \textcolor{comment}{# Build the distribution dataset}
00951         data = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ad675e899836271ff4f2fd4bd17ea81d9}{getData}(dataName)[samples]
00952         minq = np.nanmin(data.data)
00953         maxq = np.nanmax(data.data)
00954         step = (maxq-minq)/binsNb
00955         \textcolor{keywordflow}{if} (minq * maxq < 0):
00956             step = max(-minq/(binsNb/2), maxq/(binsNb/2))
00957         qseq = np.arange(minq, maxq + step * 1.01, step)
00958         newData = list()
00959         \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} data.genes:
00960             newData.append([0 \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(binsNb+1)])
00961             \textcolor{keywordflow}{for} value \textcolor{keywordflow}{in} data[gene]:
00962                 \textcolor{keywordflow}{if} (np.isnan(value)):
00963                     newData[-1][binsNb] += 1
00964                 \textcolor{keywordflow}{else}:
00965                     idx = 0
00966                     \textcolor{keywordflow}{while} (value > qseq[idx+1]):
00967                         idx += 1
00968                     newData[-1][idx] += 1
00969         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_acf8b9094fa76cafefb910daeb68b7e5d}{_newProcessedData}( distName, \textcolor{stringliteral}{"distribution"}, NaviData(newData, data.
      genes, distSamples) )
00970 
00971         \textcolor{keywordflow}{return}(distName, distSamples)
00972 
00973     \textcolor{keyword}{def }\_colorsOverlay(self, red="uniform", green="uniform", blue="uniform", proc
      essing=""):
00974         \textcolor{stringliteral}{"""}
00975 \textcolor{stringliteral}{        Create a dataset where values are colors. The color is calculated accordi
      ng to three datasets.}
00976 \textcolor{stringliteral}{}
00977 \textcolor{stringliteral}{        Args:}
00978 \textcolor{stringliteral}{            red : data name or tuple (processing, method)}
00979 \textcolor{stringliteral}{            green : data name or tuple (processing, method)}
00980 \textcolor{stringliteral}{            blue : data name or tuple (processing, method)}
00981 \textcolor{stringliteral}{        """}
00982         \textcolor{keyword}{assert} red != \textcolor{stringliteral}{"uniform"} \textcolor{keywordflow}{or} green != \textcolor{stringliteral}{"uniform"} \textcolor{keywordflow}{or} blue != \textcolor{stringliteral}{"uniform"}, \textcolor{stringliteral}{"You 
      must choose a datatable"}
00983         \textcolor{comment}{# TODO export to NaviCell and display}
00984         colors = [red, green, blue]
00985         mset = \textcolor{stringliteral}{""}
00986         \textcolor{comment}{# Empty string table}
00987         dims = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"uniform"}].data.shape
00988         dataset = np.zeros(dims, \textcolor{stringliteral}{'<U7'})
00989         \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(dims[0]):
00990             \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(dims[1]):
00991                 dataset[rr,cc] = \textcolor{stringliteral}{"#"}
00992         \textcolor{keywordflow}{for} col \textcolor{keywordflow}{in} colors:
00993             \textcolor{keywordflow}{if} (col == \textcolor{stringliteral}{"uniform"}):
00994                 \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(dims[0]):
00995                     \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(dims[1]):
00996                         dataset[rr,cc] += \textcolor{stringliteral}{"00"} \textcolor{comment}{# Default to black}
00997             \textcolor{keywordflow}{else}:
00998                 \textcolor{comment}{# Pick the datatable}
00999                 \textcolor{keywordflow}{if} (processing == \textcolor{stringliteral}{""}):
01000                     processing, method = getDataTuple(col)
01001                 \textcolor{keywordflow}{elif} (\textcolor{keywordflow}{not} processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}):
01002                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{" does not exis
      t"})
01003                 \textcolor{keywordflow}{elif} (\textcolor{keywordflow}{not} col \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]):
01004                     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Method \(\backslash\)""} + col + \textcolor{stringliteral}{"\(\backslash\)" does not exist with 
      processing \(\backslash\)""} + processing + \textcolor{stringliteral}{"\(\backslash\)""})
01005                 \textcolor{keywordflow}{else}:
01006                     method = col
01007                 \textcolor{keywordflow}{if} (processing != \textcolor{stringliteral}{"raw"}):
01008                     mset += processing + \textcolor{stringliteral}{"\_"}
01009                 mset += method + \textcolor{stringliteral}{"\_"}
01010                 \textcolor{comment}{# Input the value in the new dataset}
01011                 minval = np.nanmin(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].data)
01012                 maxval = np.nanmax(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].data)
01013                 \textcolor{keywordflow}{if} (np.isnan(minval) \textcolor{keywordflow}{or} np.isnan(maxval)):
01014                     warn(\textcolor{stringliteral}{"Datatable ("} + processing + \textcolor{stringliteral}{", "} + method + \textcolor{stringliteral}{") does not
       contain any value."})
01015                     \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(dims[0]):
01016                         \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(dims[1]):
01017                             dataset[rr,cc] = \textcolor{stringliteral}{"00"}
01018                 \textcolor{keywordflow}{else}:
01019                     \textcolor{keywordflow}{for} rr \textcolor{keywordflow}{in} range(dims[0]):
01020                         \textcolor{keywordflow}{for} cc \textcolor{keywordflow}{in} range(dims[1]):
01021                             value = self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].data[rr,cc]
01022                             \textcolor{keywordflow}{if} (np.isnan(value)):
01023                                 value = minval
01024                             intensity = re.sub(\textcolor{stringliteral}{"0x"}, \textcolor{stringliteral}{""}, hex(int( 16 * (value - m
      inval) / (maxval-minval) )) )
01025                             \textcolor{keywordflow}{if} (len(intensity) == 0):
01026                                 intensity = \textcolor{stringliteral}{"0"} + intensity
01027                             dataset[rr,cc] += intensity
01028         mset = re.sub(\textcolor{stringliteral}{"\_$"}, \textcolor{stringliteral}{""}, mset)
01029         \textcolor{comment}{# TODO See if mset is used as the method for export}
01030         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[\textcolor{stringliteral}{"colors"}][mset] = NaviData(dataset, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][met
      hod].rows, self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].columns, method=\textcolor{stringliteral}{"unknown"}, processing=\textcolor{stringliteral}{"
      colors"})
01031 
01032     \textcolor{comment}{# Saving data}
01033     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab539e16bff0a424ebd2753c153ff4e53}{saveAllData}(self, folder="", indFiles=False):
01034         \textcolor{stringliteral}{"""}
01035 \textcolor{stringliteral}{        Save all data in an .ncc file. Does not save the distribution nor color d
      ata.}
01036 \textcolor{stringliteral}{}
01037 \textcolor{stringliteral}{        Args:}
01038 \textcolor{stringliteral}{            folder (str): folder where the data will be save, the name is automat
      ically attributed from the name of the dataset, the method and the processing}
01039 \textcolor{stringliteral}{            indFiles (bool): whether the data should be saved in a single file or
       in separate files}
01040 \textcolor{stringliteral}{        """}
01041         \textcolor{keywordflow}{if} (folder != \textcolor{stringliteral}{""}):
01042             folder = re.sub(\textcolor{stringliteral}{"/?$"}, \textcolor{stringliteral}{"/"}, folder)
01043         fname = folder + self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name} + \textcolor{stringliteral}{".ncc"}
01044         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Saving as "} + fname)
01045         \textcolor{keywordflow}{if} (indFiles):
01046             wmode = \textcolor{stringliteral}{"w"}
01047         \textcolor{keywordflow}{else}:
01048             wmode = \textcolor{stringliteral}{"a"}
01049             ff = open(fname, \textcolor{stringliteral}{"w"})
01050             ff.close()
01051         allProcessings = list(self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data})
01052         allProcessings.remove(\textcolor{stringliteral}{"uniform"})
01053         allProcessings.remove(\textcolor{stringliteral}{"distribution"})
01054         allProcessings.remove(\textcolor{stringliteral}{"colors"})
01055         \textcolor{keywordflow}{for} processing \textcolor{keywordflow}{in} allProcessings:
01056             \textcolor{keywordflow}{for} method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]:
01057                 \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Saving "} + processing + \textcolor{stringliteral}{", "} + method)\textcolor{comment}{# + ", " + str(self.
      \_data[processing][method]))}
01058                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].saveData(fname, wmode)
01059         \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Saving Annotations"})
\hypertarget{navicom_8py_source_l01060}{}\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ab539e16bff0a424ebd2753c153ff4e53}{01060}         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb88722efeb86813dcb85818b7065330}{_annotations}.saveData(fname, wmode)
01061 
01062     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_ac53d9dc53ca0af44586a55fb1bffe8bd}{saveData}(self, method, processing="raw", folder="./"):
01063         \textcolor{stringliteral}{"""}
01064 \textcolor{stringliteral}{        Save the data in a file that can be exported to NaviCell or imported in N
      aviCom}
01065 \textcolor{stringliteral}{        """}
01066         \textcolor{comment}{# TODO authorize to provide a list to save a custom dataset}
01067         \textcolor{keywordflow}{if} (folder != \textcolor{stringliteral}{""}):
01068             folder = re.sub(\textcolor{stringliteral}{"/?$"}, \textcolor{stringliteral}{"/"}, folder)
01069         \textcolor{keywordflow}{if} (processing \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}):
01070             \textcolor{keywordflow}{if} (method \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing]):
01071                 self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a407b2b5c30a5652ee85c4be54b3e6679}{_data}[processing][method].saveData(baseName=folder+self.
      \hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name})
01072             \textcolor{keywordflow}{else}:
01073                 \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Method "} + method + \textcolor{stringliteral}{" does not exist with proce
      ssing "} + processing)
01074         \textcolor{keywordflow}{else}:
01075             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Processing "} + processing + \textcolor{stringliteral}{" does not exist"})
01076 
01077     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navicom_1_1NaviCom_aa6a527c98c20f4f75b8529fca178dddc}{saveAnnotations}(self, folder="./"):
01078         \textcolor{stringliteral}{"""}
01079 \textcolor{stringliteral}{        Save the annotations in a file than can be exported to NaviCell or import
      ed in NaviCom}
01080 \textcolor{stringliteral}{        """}
01081         \textcolor{keywordflow}{if} (folder != \textcolor{stringliteral}{""}):
01082             folder = re.sub(\textcolor{stringliteral}{"/?$"}, \textcolor{stringliteral}{"/"}, folder)
01083         self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_afb88722efeb86813dcb85818b7065330}{_annotations}.saveData(folder+self.\hyperlink{classnavicom_1_1navicom_1_1NaviCom_a950e5ebf199edea40d55c506b8aaf134}{name})
01084 
\end{DoxyCode}
