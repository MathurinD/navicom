\hypertarget{navidata_8py_source}{
\subsection{navicom/navidata.py}
}

\begin{DoxyCode}
00001 \textcolor{comment}{################################################################################}
00002 \textcolor{comment}{# navidata.py}
00003 \textcolor{comment}{# By Mathurin Dorel}
00004 \textcolor{comment}{# Classes to store data an annotations in a convenient format for NaviCell export
      }
00005 \textcolor{comment}{################################################################################}
00006 
00007 \textcolor{keyword}{import} numpy \textcolor{keyword}{as} np
00008 \textcolor{keyword}{import} re
00009 \textcolor{keyword}{from} time \textcolor{keyword}{import} sleep
00010 \textcolor{keyword}{from} collections \textcolor{keyword}{import} OrderedDict \textcolor{keyword}{as} oDict
00011 \textcolor{keyword}{from} pprint \textcolor{keyword}{import} pprint
00012 \textcolor{keyword}{import} math
00013 \textcolor{keyword}{from} warnings \textcolor{keyword}{import} warn
00014 
00015 DEBUG\_NAVIDATA = \textcolor{keyword}{True}
00016 
00017 \textcolor{comment}{# Constants related to NaviCell}
00018 MAX\_GLYPHS = 5
00019 GLYPH\_TYPES = [\textcolor{stringliteral}{"color"}, \textcolor{stringliteral}{"size"}, \textcolor{stringliteral}{"shape"}]
00020 \textcolor{comment}{# Identify the categories of cBioportal data as (aliases, biotype)}
00021 TYPES\_SPEC = dict()
00022 TYPES\_SPEC[\textcolor{stringliteral}{"mRNA"}] = ([\textcolor{stringliteral}{"mrna"}, \textcolor{stringliteral}{"zscores"}, \textcolor{stringliteral}{"mrna\_median\_zscores"}, \textcolor{stringliteral}{"rna\_seq\_mrna\_me
      dian\_zscores"}, \textcolor{stringliteral}{"rna\_seq\_mrna"}, \textcolor{stringliteral}{"rna\_seq\_v2\_mrna"}, \textcolor{stringliteral}{"rna\_seq\_v2\_mrna\_median\_zscores
      "}, \textcolor{stringliteral}{"mrna\_U133"}, \textcolor{stringliteral}{"mrna\_U133\_zscores"}, \textcolor{stringliteral}{"mrna\_median"}, \textcolor{stringliteral}{"mrna\_zbynorm"}, \textcolor{stringliteral}{"mrna\_outlier
      s"}, \textcolor{stringliteral}{"rna\_seq\_rna"}, \textcolor{stringliteral}{"mrna\_znormal"}, \textcolor{stringliteral}{"mrna\_outlier"}, \textcolor{stringliteral}{"mrna\_merged\_median\_zscores"}],
       \textcolor{stringliteral}{"mRNA expression data"})
00023 TYPES\_SPEC[\textcolor{stringliteral}{"dCNA"}] = ([\textcolor{stringliteral}{"gistic"}, \textcolor{stringliteral}{"cna"}, \textcolor{stringliteral}{"cna\_rae"}, \textcolor{stringliteral}{"cna\_consensus"}, \textcolor{stringliteral}{"snp-fasst2"}]
      , \textcolor{stringliteral}{"Discrete Copy number data"})
00024 TYPES\_SPEC[\textcolor{stringliteral}{"cCNA"}] = ([\textcolor{stringliteral}{"log2cna"}], \textcolor{stringliteral}{"Continuous copy number data"})
00025 TYPES\_SPEC[\textcolor{stringliteral}{"methylation"}] = ([\textcolor{stringliteral}{"methylation"}, \textcolor{stringliteral}{"methylation\_hm27"}, \textcolor{stringliteral}{"methylation\_hm4
      50"}], \textcolor{stringliteral}{"mRNA expression data"})
00026 TYPES\_SPEC[\textcolor{stringliteral}{"protein"}] = ([\textcolor{stringliteral}{"RPPA\_protein\_level"}], \textcolor{stringliteral}{"protein level"})
00027 TYPES\_SPEC[\textcolor{stringliteral}{"miRNA"}] = ([\textcolor{stringliteral}{"mirna"}, \textcolor{stringliteral}{"mirna\_median\_zscores"}], \textcolor{stringliteral}{"miRNA expression data"
      })
00028 TYPES\_SPEC[\textcolor{stringliteral}{"mutations"}] = ([\textcolor{stringliteral}{"mutations"}], \textcolor{stringliteral}{"Mutations"})
00029 TYPES\_SPEC[\textcolor{stringliteral}{"unknown"}] = ([\textcolor{stringliteral}{"unknown"}], \textcolor{stringliteral}{"mRNA expression data"}) \textcolor{comment}{# If the type of da
      ta cannot be identified, consider continuous data by default}
00030 METHODS\_TYPE = dict()
00031 TYPES\_BIOTYPE = dict()
00032 \textcolor{keywordflow}{for} bt \textcolor{keywordflow}{in} TYPES\_SPEC:
00033     TYPES\_BIOTYPE[bt] = TYPES\_SPEC[bt][1]
00034     \textcolor{keywordflow}{for} cat \textcolor{keywordflow}{in} TYPES\_SPEC[bt][0]:
00035         METHODS\_TYPE[cat.lower()] = bt
00036 
00037 \textcolor{comment}{# Inform what the processing does to the biotype, if -> it changes only some biot
      ypes, if "something" it turns everything to something, see exportData and saveDat
      a}
00038 PROCESSINGS = [\textcolor{stringliteral}{"raw"}, \textcolor{stringliteral}{"moduleAverage"}, \textcolor{stringliteral}{"pcaComp"}, \textcolor{stringliteral}{"geoSmooth"}, \textcolor{stringliteral}{"distribution"}, \textcolor{stringliteral}{"c
      olors"}, \textcolor{stringliteral}{"mutationQuantification"}]
00039 PROCESSINGS\_BIOTYPE = \{\textcolor{stringliteral}{"moduleAverage"}:\textcolor{stringliteral}{"Discrete->Continuous"}, \textcolor{stringliteral}{"pcaComp"}:\textcolor{stringliteral}{"Color"},
       \textcolor{stringliteral}{"geoSmooth"}:\textcolor{stringliteral}{"Discrete->Continuous"}, \textcolor{stringliteral}{"mutationQuantification"}:\textcolor{stringliteral}{"Continuous copy nu
      mber data"}\}
00040 DISCRETE\_BIOTYPES = [\textcolor{stringliteral}{"Mutations"}, \textcolor{stringliteral}{"Discrete Copy number data"}]
00041 CONTINOUS\_BIOTYPES = [\textcolor{stringliteral}{"mRNA expression data"}, \textcolor{stringliteral}{"miRNA expression data"}, \textcolor{stringliteral}{"protein l
      evel"}, \textcolor{stringliteral}{"Continuous copy number data"}]
00042 
00043 \textcolor{keyword}{class }NaviData():
00044     \textcolor{stringliteral}{"""}
00045 \textcolor{stringliteral}{    Custom class to store the data and be able to access rows and columns by name
      .}
00046 \textcolor{stringliteral}{    Args :}
00047 \textcolor{stringliteral}{        data (list or array) : Values of the data to insert in the NaviData objec
      t. Must be convertible into a numpy array.}
00048 \textcolor{stringliteral}{        rows\_list (list) : names of the rows (samples names)}
00049 \textcolor{stringliteral}{        columns\_list (list) : names of the columns (genes names)}
00050 \textcolor{stringliteral}{        processing (str) : name of the computer processing applied to the data}
00051 \textcolor{stringliteral}{        method (str) : name of the experimental method used to get the original (
      "raw") data}
00052 \textcolor{stringliteral}{        dType (str) : "data" or "annotations", whether the NaviData object contai
      ns datas or annotations (Note : this should be left to default, this is used by N
      aviAnnotations to change some internal variables)}
\hypertarget{navidata_8py_source_l00053}{}\hyperlink{classnavicom_1_1navidata_1_1NaviData}{00053} \textcolor{stringliteral}{    """}
00054     \textcolor{keyword}{def }\_\_init\_\_(self, data, rows\_list, columns\_list, processing="raw", method="u
      nknown", dType="data"):
00055         \textcolor{keyword}{assert}(len(data) == len(rows\_list))
00056         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} data:
00057             \textcolor{keyword}{assert} len(line) == len(columns\_list), \textcolor{stringliteral}{"Incorrect length of line : "} 
      + str(line) + \textcolor{stringliteral}{", length = "} + str(len(line)) + \textcolor{stringliteral}{", expected "} + str(len(columns\_li
      st))
00058         \textcolor{comment}{# Informations on the data TODO}
00059         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ab3f30d76377459fe539f440df162ea59}{processing} = processing
00060         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ae8f909ed788b49a3c894251957e2f732}{method} = method
00061         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a863ac9998d2facd5f86bcea9b6256003}{biotype} = getBiotype(method, processing)
00062         \textcolor{comment}{# Initialise data and indexes}
00063         \textcolor{comment}{## Raw datatable as a numpy array}
\hypertarget{navidata_8py_source_l00064}{}\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{00064}         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data} = np.array(data)
00065         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows} = listToDictKeys(rows\_list)
00066         \textcolor{comment}{## Names of the rows}
\hypertarget{navidata_8py_source_l00067}{}\hyperlink{classnavicom_1_1navidata_1_1NaviData_aef041665583f2aa0845418d378ce3a40}{00067}         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aef041665583f2aa0845418d378ce3a40}{rows_names} = list(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}.keys())
00068         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns} = listToDictKeys(columns\_list)
00069         \textcolor{comment}{## Names of the columns}
\hypertarget{navidata_8py_source_l00070}{}\hyperlink{classnavicom_1_1navidata_1_1NaviData_aebce9bba220d01776cbd5a214d2d3013}{00070}         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aebce9bba220d01776cbd5a214d2d3013}{columns_names} = list(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}.keys())
00071         \textcolor{keywordflow}{if} (dType == \textcolor{stringliteral}{"annotations"}):
00072             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a080320f0715d257f61490985484e6d54}{inColumns} = \textcolor{stringliteral}{"annotations"}
00073             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25c8ddaa3aea26ab2ef034859fb9304d}{annotations} = self.columns
00074             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aae9bfcdefa67abad304df58b7e4a62c8}{annotations_names} = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aebce9bba220d01776cbd5a214d2d3013}{columns_names}
00075             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a172b33d53b897135381a92b045f5576b}{inRows} = \textcolor{stringliteral}{"samples"}
00076             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a59f086d64ae87f6eaa50f02192380c46}{samples} = self.rows
00077             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a5a0f30c9c3f70e500bf5948b9340f4ec}{samples_names} = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aef041665583f2aa0845418d378ce3a40}{rows_names}
00078         \textcolor{keywordflow}{elif} (dType == \textcolor{stringliteral}{"data"}):
00079             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a172b33d53b897135381a92b045f5576b}{inRows} = \textcolor{stringliteral}{"genes"}
00080             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ad936829a89a392c3599c027a5ad088a6}{genes} = self.rows
00081             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a3a0751cab5bd70196652f8edbb31b257}{genes_names} = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aef041665583f2aa0845418d378ce3a40}{rows_names}
00082             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a080320f0715d257f61490985484e6d54}{inColumns} = \textcolor{stringliteral}{"samples"}
00083             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a59f086d64ae87f6eaa50f02192380c46}{samples} = self.columns
00084             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a5a0f30c9c3f70e500bf5948b9340f4ec}{samples_names} = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aebce9bba220d01776cbd5a214d2d3013}{columns_names}
00085         \textcolor{keywordflow}{elif} (dType == \textcolor{stringliteral}{"old\_annotations"}):
00086             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a172b33d53b897135381a92b045f5576b}{inRows} = \textcolor{stringliteral}{"annotations"}
00087             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a080320f0715d257f61490985484e6d54}{inColumns} = \textcolor{stringliteral}{"samples"}
00088         \textcolor{keywordflow}{else}:
00089             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"dType '"} + dType + \textcolor{stringliteral}{"' is not valid"})
00090         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} = dType
00091         \textcolor{comment}{# For the iterator}
00092         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a21c96bfd996af8dd4a12877aa54d4393}{itermode} = \textcolor{stringliteral}{""}
00093         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index} = 0
00094 
00095     \textcolor{keyword}{def }\_\_getitem\_\_(self, index):
00096         \textcolor{keywordflow}{if} (isinstance(index, int)):
00097             \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data}[index])
00098         \textcolor{keywordflow}{elif} (isinstance(index, str)):
00099             \textcolor{keywordflow}{if} (index \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}):
00100                 \textcolor{keywordflow}{return}( NaviSlice(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data}[self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}[index],:], self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}) 
      )
00101             \textcolor{keywordflow}{elif} (index \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}):
00102                 \textcolor{keywordflow}{return}( NaviSlice(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data}[:,self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}[index]], self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}) 
      )
00103             \textcolor{keywordflow}{else}:
00104                 \textcolor{keywordflow}{raise} IndexError(\textcolor{stringliteral}{"'"} + index + \textcolor{stringliteral}{"' is neither a gene or sample nam
      e"})
00105         \textcolor{keywordflow}{elif} (isinstance(index, list) \textcolor{keywordflow}{or} isinstance(index, tuple)):
00106             result = list()
00107             \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} index:
00108                 result.append(self[ii].data)
00109             result = np.array(result)
00110             \textcolor{keywordflow}{if} (index[0] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}):
00111                 \textcolor{keyword}{assert} np.all([idx \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows} \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} index]), \textcolor{stringliteral}{"Not all ind
      ex are gene names"}
00112                 genes = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}.copy()
00113                 \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}:
00114                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} gene \textcolor{keywordflow}{in} index):
00115                         genes.pop(gene)
00116                 \textcolor{keywordflow}{return}( NaviData(result, genes, self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}) )
00117             \textcolor{keywordflow}{elif} (index[0] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}):
00118                 \textcolor{keyword}{assert} np.all([idx \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns} \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} index]), \textcolor{stringliteral}{"Not all 
      index are sample names"}
00119                 samples = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}.copy()
00120                 \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}:
00121                     \textcolor{keywordflow}{if}(\textcolor{keywordflow}{not} sample \textcolor{keywordflow}{in} index):
00122                         samples.pop(sample)
00123                 \textcolor{keywordflow}{return}( NaviData(result.transpose(), self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}, samples) )
00124 
00125     \textcolor{keyword}{def }\_\_iter\_\_(self, by="genes"):
00126         \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} by \textcolor{keywordflow}{in} [\textcolor{stringliteral}{"genes"}, \textcolor{stringliteral}{"samples"}]):
00127             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"'by' must be in ['genes', 'samples']"})
00128         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ac21c979a9421ac607778d907380475fc}{iter_mode} = by
00129         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index} = 0
00130         \textcolor{keywordflow}{return}(self)
00131 
00132     \textcolor{keyword}{def }\_\_next\_\_(self):
00133         \textcolor{keywordflow}{try}:
00134             \textcolor{keywordflow}{if} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ac21c979a9421ac607778d907380475fc}{iter_mode} == \textcolor{stringliteral}{"genes"}):
00135                 key = list(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}.keys())[self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index}]
00136                 result = [key] + list(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data}[self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index},:])
00137             \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ac21c979a9421ac607778d907380475fc}{iter_mode} == \textcolor{stringliteral}{"samples"}):
00138                 key = list(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}.keys())[self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index}]
00139                 result = [key] + list(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data}[:,self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index}])
00140         \textcolor{keywordflow}{except} IndexError:
00141             \textcolor{keywordflow}{raise} StopIteration
00142         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index} += 1
00143         \textcolor{keywordflow}{return}(result)
00144 
00145     \textcolor{keyword}{def }\_\_repr\_\_(self):
00146         rpr = \textcolor{stringliteral}{"NaviData array with "} + str(len(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows})) + \textcolor{stringliteral}{" "} + self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a172b33d53b897135381a92b045f5576b}{inRows} +
       \textcolor{stringliteral}{" and "}
00147         rpr += str(len(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns})) + \textcolor{stringliteral}{" "} + self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a080320f0715d257f61490985484e6d54}{inColumns}
00148         \textcolor{keywordflow}{return}(rpr)
00149 
00150     \textcolor{keyword}{def }\_makeData(self, hugo\_map=""):
00151         \textcolor{stringliteral}{""" Builds a string suitable for NaviCell Web Service from a python matri
      x of gene/sample values or a NaviCom object.}
00152 \textcolor{stringliteral}{}
00153 \textcolor{stringliteral}{        Matrix format:}
00154 \textcolor{stringliteral}{        - first line is: GENE word followed by a tab separated list of sample nam
      es,}
00155 \textcolor{stringliteral}{        - each line begins with an gene name and must be followed by a tab separa
      ted list of gene/sample values.}
00156 \textcolor{stringliteral}{}
00157 \textcolor{stringliteral}{        Remove genes not present in hugo\_map if provided.}
00158 \textcolor{stringliteral}{        """}
00159 
00160         \textcolor{comment}{# Change header whether we have annotations or real self}
00161         \textcolor{keywordflow}{if} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} == \textcolor{stringliteral}{"annotations"}):
00162             ret = \textcolor{stringliteral}{"NAME\(\backslash\)t"} + \textcolor{stringliteral}{'\(\backslash\)t'}.join(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aae9bfcdefa67abad304df58b7e4a62c8}{annotations_names}) + \textcolor{stringliteral}{"\(\backslash\)n"}
00163             \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self:
00164                 ret += buildLine(line)
00165         \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} == \textcolor{stringliteral}{"data"}):
00166             ret = \textcolor{stringliteral}{"GENE\(\backslash\)t"} + \textcolor{stringliteral}{'\(\backslash\)t'}.join(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aebce9bba220d01776cbd5a214d2d3013}{columns_names}) + \textcolor{stringliteral}{"\(\backslash\)n"}
00167             \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self:
00168                 \textcolor{keywordflow}{if} (line[0] \textcolor{keywordflow}{in} hugo\_map \textcolor{keywordflow}{or} hugo\_map == \textcolor{stringliteral}{""}):
00169                     ret += buildLine(line)
00170         \textcolor{keywordflow}{else}:
00171             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Data type must be 'data' or 'annotations'"})
00172 
00173         \textcolor{keywordflow}{return}(\textcolor{stringliteral}{"@DATA\(\backslash\)n"} + ret)
00174 
00175     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navidata_1_1NaviData_a485fbc0ffff49b94f3736b2a0f8cb54e}{exportToNaviCell}(self, nv, biotype, dataName):
00176         \textcolor{stringliteral}{"""}
00177 \textcolor{stringliteral}{        Export data to a NaviCell map}
00178 \textcolor{stringliteral}{        }
00179 \textcolor{stringliteral}{        Args:}
00180 \textcolor{stringliteral}{            nv (NaviCell): a NaviCell communication object}
00181 \textcolor{stringliteral}{            biotype (str): biotype of the datatable in NaviCell}
00182 \textcolor{stringliteral}{            dataName (str): name of the datatable in NaviCell}
00183 \textcolor{stringliteral}{        """}
00184         nv.importDatatables(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a26d914914312eb5cceb517eb41128056}{_makeData}(nv.getHugoList()), dataName, biotype) 
      \textcolor{comment}{# Remove name once in self}
\hypertarget{navidata_8py_source_l00185}{}\hyperlink{classnavicom_1_1navidata_1_1NaviData_a485fbc0ffff49b94f3736b2a0f8cb54e}{00185}         \textcolor{comment}{#nv.importDatatables(self.\_makeData(nv.getHugoList()), dataName, self.bio
      type)}
00186 
00187     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navidata_1_1NaviData_a3dfc92056e5fc254e80607cef39234bf}{saveData}(self, baseName="", mode="w", fullName=False):
00188         \textcolor{stringliteral}{"""}
00189 \textcolor{stringliteral}{        Save the NaviData datas in a file that can be used in NaviCell, but can a
      lso be loaded as NaviData}
00190 \textcolor{stringliteral}{}
00191 \textcolor{stringliteral}{        Args:}
00192 \textcolor{stringliteral}{            baseName (str): first part of the name of the file where the data wil
      l be written. The processing and method are added to file name if fullName is Fal
      se.}
00193 \textcolor{stringliteral}{            mode (str): How the file should be opened ('a' or 'w')}
00194 \textcolor{stringliteral}{            fullName (bool): Whether the baseName should be used alone (True) or 
      with the extra information of the method and processing.}
00195 \textcolor{stringliteral}{        """}
00196         \textcolor{keyword}{assert} mode \textcolor{keywordflow}{in} [\textcolor{stringliteral}{"a"}, \textcolor{stringliteral}{"w"}], ValueError(\textcolor{stringliteral}{"Cannot open the file with this mod
      e to save data"})
\hypertarget{navidata_8py_source_l00197}{}\hyperlink{classnavicom_1_1navidata_1_1NaviData_a3dfc92056e5fc254e80607cef39234bf}{00197}         fname = baseName + \textcolor{stringliteral}{"["} + self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ab3f30d76377459fe539f440df162ea59}{processing} + \textcolor{stringliteral}{"]"} + \textcolor{stringliteral}{"["} + self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ae8f909ed788b49a3c894251957e2f732}{method} + \textcolor{stringliteral}{"].n
      cd"}
00198         \textcolor{keywordflow}{if} (mode == \textcolor{stringliteral}{"a"} \textcolor{keywordflow}{or} fullName):
00199             fname = baseName
00200         with open(fname, mode) \textcolor{keyword}{as} ff:
00201             \textcolor{comment}{# First line, and first word in the }
00202             \textcolor{keywordflow}{if} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} == \textcolor{stringliteral}{"data"}):
00203                 \textcolor{keywordflow}{if} (mode == \textcolor{stringliteral}{"a"}):
00204                     ff.write(\textcolor{stringliteral}{"M "}+self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ae8f909ed788b49a3c894251957e2f732}{method}+\textcolor{stringliteral}{"\(\backslash\)t"}+self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ab3f30d76377459fe539f440df162ea59}{processing}+\textcolor{stringliteral}{"\(\backslash\)n"})
00205                 ff.write(\textcolor{stringliteral}{"GENE"})
00206             \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} == \textcolor{stringliteral}{"annotations"} \textcolor{keywordflow}{or} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} == \textcolor{stringliteral}{"old\_annots"}):
00207                 \textcolor{keywordflow}{if} (mode == \textcolor{stringliteral}{"a"}):
00208                     ff.write(\textcolor{stringliteral}{"ANNOTATIONS "}+self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ae8f909ed788b49a3c894251957e2f732}{method}+\textcolor{stringliteral}{"\(\backslash\)t"}+self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ab3f30d76377459fe539f440df162ea59}{processing}+\textcolor{stringliteral}{"\(\backslash\)n"
      })
00209                 ff.write(\textcolor{stringliteral}{"NAME"})
00210             \textcolor{keywordflow}{for} nn \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aebce9bba220d01776cbd5a214d2d3013}{columns_names}:
00211                 ff.write(\textcolor{stringliteral}{"\(\backslash\)t"} + nn)
00212             ff.write(\textcolor{stringliteral}{"\(\backslash\)n"})
00213             \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aef041665583f2aa0845418d378ce3a40}{rows_names})):
00214                 ff.write(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aef041665583f2aa0845418d378ce3a40}{rows_names}[ii])
00215                 \textcolor{keywordflow}{for} sv \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data}[ii]:
00216                     ff.write(\textcolor{stringliteral}{"\(\backslash\)t"} + str(sv))
00217                 ff.write(\textcolor{stringliteral}{"\(\backslash\)n"})
00218             
00219 MAX\_GROUPS = 7
00220 \textcolor{keyword}{class }\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations}{NaviAnnotations}(\hyperlink{classnavicom_1_1navidata_1_1NaviData}{NaviData}):
00221     \textcolor{stringliteral}{"""}
00222 \textcolor{stringliteral}{    Enhance NaviData to contain annotations and associate annotations values with
       samples. Also reduce continuous data with to many levels to a limited number of 
      interval levels.}
00223 \textcolor{stringliteral}{    """}
00224 
\hypertarget{navidata_8py_source_l00225}{}\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations}{00225}     \textcolor{keyword}{def }\_\_init\_\_(self, data, rows\_list, columns\_list, dType="annotations"):
00226         NaviData.\_\_init\_\_(self, data, rows\_list, columns\_list, dType=dType)
00227         \textcolor{comment}{# Get the values for each annotations and which samples are associated to
       a value}
00228         self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a1c26e115cb2eabe4384cd2fa0c7f776f}{categoriesPerAnnotation} = dict()
00229         self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a7cbb4ab623948f19e055f5b4b7c938a9}{samplesPerCategory} = dict()
00230         modified\_data = list()
00231         modified\_annot = list()
00232         \textcolor{keywordflow}{for} annot \textcolor{keywordflow}{in} self.annotations:
00233             self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a1c26e115cb2eabe4384cd2fa0c7f776f}{categoriesPerAnnotation}[annot] = list()
00234             self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a7cbb4ab623948f19e055f5b4b7c938a9}{samplesPerCategory}[annot] = dict()
00235             reduced = \textcolor{keyword}{False}
00236             \textcolor{comment}{# Reduce the annotations set if they are continuous integers with too
       many values}
00237             \textcolor{keywordflow}{if} (len(np.unique(self[annot].data)) > MAX\_GROUPS):
00238                 \textcolor{keywordflow}{try}:
00239                     values = [float(value) \textcolor{keywordflow}{for} value \textcolor{keywordflow}{in} np.unique(self[annot].dat
      a)]
00240                     \textcolor{comment}{# Define the new annotations}
00241                     min\_value = min(values)
00242                     max\_value = max(values)
00243                     step = (max\_value-min\_value)/MAX\_GROUPS
00244                     new\_values = [signif(cat) \textcolor{keywordflow}{for} cat \textcolor{keywordflow}{in} np.arange(min\_value, max
      \_value+step/2, 1.01*step)]
00245                     new\_categories = [str(new\_values[icat])+\textcolor{stringliteral}{"<X<"}+str(new\_values[
      icat+1]) \textcolor{keywordflow}{for} icat \textcolor{keywordflow}{in} range(len(new\_values)-1)] + [\textcolor{stringliteral}{"NaN"}]
00246                     self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a1c26e115cb2eabe4384cd2fa0c7f776f}{categoriesPerAnnotation}[annot] = new\_categories
00247                     \textcolor{comment}{# Attribute the new annotations to samples}
00248                     modified\_data.append(self[annot].data.copy())
00249                     modified\_annot.append(annot)
00250                     \textcolor{keywordflow}{for} cat \textcolor{keywordflow}{in} new\_categories:
00251                         self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a7cbb4ab623948f19e055f5b4b7c938a9}{samplesPerCategory}[annot][cat] = list()
00252                     \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} self.samples:
00253                         annot\_value = float(self[annot][sample])
00254                         \textcolor{keywordflow}{if} (np.isnan(annot\_value)):
00255                             self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a7cbb4ab623948f19e055f5b4b7c938a9}{samplesPerCategory}[annot][\textcolor{stringliteral}{"NaN"}].append(sample)
00256                         \textcolor{keywordflow}{else}:
00257                             icat = 0
00258                             \textcolor{keywordflow}{while} (signif(annot\_value) >= new\_values[icat+1]):
00259                                 icat += 1
00260                             self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a7cbb4ab623948f19e055f5b4b7c938a9}{samplesPerCategory}[annot][new\_categories[icat]].
      append(sample)
00261                             self[annot][sample] = new\_categories[icat]
00262                     reduced = \textcolor{keyword}{True}
00263                 \textcolor{keywordflow}{except} ValueError: 
00264                     reduced = \textcolor{keyword}{False}
00265             \textcolor{comment}{# Non numeric values or with few enough levels are not modified and s
      imply indexed}
00266             \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} reduced):
00267                 \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} self.samples:
00268                     annot\_value = self[annot][sample]
00269                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} annot\_value \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a1c26e115cb2eabe4384cd2fa0c7f776f}{categoriesPerAnnotation}[annot]):
00270                         self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a1c26e115cb2eabe4384cd2fa0c7f776f}{categoriesPerAnnotation}[annot].append(annot\_value)
00271                         self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a7cbb4ab623948f19e055f5b4b7c938a9}{samplesPerCategory}[annot][annot\_value] = [sample]
00272                     \textcolor{keywordflow}{else}:
00273                         self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a7cbb4ab623948f19e055f5b4b7c938a9}{samplesPerCategory}[annot][annot\_value].append(sample
      )
00274 
00275         \textcolor{keywordflow}{if} (DEBUG\_NAVIDATA):
00276             \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Discretised annotations:"} + str(modified\_annot))
00277         \textcolor{keywordflow}{if} (len(modified\_annot) > 0):
00278             self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_ab053ca65505c1a9d72e2afb96ddcae9c}{old_annots} = NaviData(modified\_data, modified\_annot, self.\_rows,
       \textcolor{stringliteral}{"old\_annotations"})
00279         \textcolor{keywordflow}{else}:
00280             self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_ab053ca65505c1a9d72e2afb96ddcae9c}{old_annots} = list()
00281 
00282 \textcolor{keyword}{class }\hyperlink{classnavicom_1_1navidata_1_1NaviSlice}{NaviSlice}():
00283     \textcolor{stringliteral}{"""}
00284 \textcolor{stringliteral}{    A slice from a NaviData array}
00285 \textcolor{stringliteral}{    """}
00286     \textcolor{keyword}{def }\_\_init\_\_(self, data, index\_dict):
\hypertarget{navidata_8py_source_l00287}{}\hyperlink{classnavicom_1_1navidata_1_1NaviSlice}{00287}         \textcolor{keywordflow}{if} (isinstance(data, np.ndarray)):
00288             self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data} = data
00289         \textcolor{keywordflow}{elif} (isinstance(data, list)):
00290             self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data} = np.array(data)
00291         \textcolor{keywordflow}{else}:
00292             \textcolor{keywordflow}{raise} TypeError
00293         \textcolor{keywordflow}{if} (isinstance(index\_dict, dict)):
00294             self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids} = index\_dict
00295         \textcolor{keywordflow}{elif} (isinstance(index\_dict, list)):
00296             self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids} = listToDictKeys(index\_dict)
00297         \textcolor{keywordflow}{else}:
00298             \textcolor{keywordflow}{raise} TypeError
00299 
00300     \textcolor{keyword}{def }\_\_getitem\_\_(self, index):
00301         \textcolor{keywordflow}{if} (isinstance(index, int)):
00302             \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data}[index])
00303         \textcolor{keywordflow}{elif} (isinstance(index, str)):
00304             \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data}[self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids}[index]])
00305         \textcolor{keywordflow}{elif} (isinstance(index, list)):
00306             ret\_value = list()
00307             ret\_name = list()
00308             \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} index:
00309                 \textcolor{keywordflow}{if} (ii \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids}):
00310                     ret\_name.append(ii)
00311                 \textcolor{keywordflow}{else}:
00312                     ret\_name.append(self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids}[ii])
00313                 ret\_value.append(self[ii])
00314             \textcolor{keywordflow}{return}(NaviSlice(ret\_value, ret\_name))
00315 
00316     \textcolor{keyword}{def }\_\_setitem\_\_(self, index, value):
00317         \textcolor{keywordflow}{if} (isinstance(index, int)):
00318             self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data}[index] = value
00319         \textcolor{keywordflow}{elif} (isinstance(index, str)):
00320             self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data}[self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids}[index]] = value
00321         \textcolor{keywordflow}{elif} (isinstance(index, list)):
00322             \textcolor{keywordflow}{if} (isinstance(value, list) \textcolor{keywordflow}{and} len(value) == len(index)):
00323                 \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(index)):
00324                     self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data}[index[ii]] = value[ii]
00325             \textcolor{keywordflow}{else}:
00326                 \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Length of indexes to change and new values diff
      er"})
00327 
00328     \textcolor{keyword}{def }\_\_iter\_\_(self):
00329         \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data}.\_\_iter\_\_())
00330 
00331     \textcolor{keyword}{def }\_\_repr\_\_(self):
00332         rpr = \textcolor{stringliteral}{"NaviData slice with "} + str(len(self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids})) + \textcolor{stringliteral}{" elements"}
00333         \textcolor{keywordflow}{return}(rpr)
00334 
00335     \textcolor{keyword}{def }\_\_add\_\_(self, nvslice):
00336         \textcolor{keyword}{assert}(isinstance(nvslice, NaviSlice))
00337         \textcolor{comment}{#assert(self.ids == nvslice.ids)}
00338         \textcolor{keywordflow}{return}(NaviSlice(self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data} + nvslice.data, self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids}))
00339 
00340 \textcolor{keyword}{def }listToDictKeys(ilist):
00341     \textcolor{stringliteral}{"""}
00342 \textcolor{stringliteral}{    Convert a list to an ordered dict where each item is a key and gives the id o
      f the item in the list}
00343 \textcolor{stringliteral}{    """}
00344     \textcolor{keywordflow}{if} (isinstance(ilist, dict)):
00345         \textcolor{keywordflow}{return}(oDict(ilist))
00346     res = oDict()
00347     ii = 0
00348     \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} ilist:
00349         res[str(key)] = ii
00350         ii += 1
00351     \textcolor{keywordflow}{return}(res)
00352 
00353 \textcolor{keyword}{def }buildLine(line, sep="\(\backslash\)t"):
00354     ret = \textcolor{stringliteral}{""}
00355     \textcolor{keywordflow}{for} el \textcolor{keywordflow}{in} line:
00356         ret += str(el) + sep
00357     \textcolor{keywordflow}{return}(re.sub(\textcolor{stringliteral}{"NaN|nan"}, \textcolor{stringliteral}{"NA"}, ret[:-1]) + \textcolor{stringliteral}{"\(\backslash\)n"})
00358 
00359 \textcolor{keyword}{def }parseFilename(fname):
00360     \textcolor{stringliteral}{"""}
00361 \textcolor{stringliteral}{    Extract data name, method and processing from the name of the file}
00362 \textcolor{stringliteral}{    """}
00363     fname = re.sub(\textcolor{stringliteral}{".*/([^/]+)"}, \textcolor{stringliteral}{"\(\backslash\)\(\backslash\)1"}, fname)
00364     \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"\(\backslash\).ncd$|\(\backslash\).nca$"}, fname)):
00365         names = re.split(\textcolor{stringliteral}{"\(\backslash\)["}, re.sub(\textcolor{stringliteral}{".ncd$|.nca$"}, \textcolor{stringliteral}{""}, fname))
00366         dname = re.sub(\textcolor{stringliteral}{"\_$"}, \textcolor{stringliteral}{""}, names[0])
00367         processing = re.sub(\textcolor{stringliteral}{"\(\backslash\)]|\_$|^\_"}, \textcolor{stringliteral}{""}, names[1])
00368         method = re.sub(\textcolor{stringliteral}{"\(\backslash\)[|\_$|^\_"}, \textcolor{stringliteral}{""}, names[2])
00369     \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"\(\backslash\).tsv$"}, fname)):
00370         processing = \textcolor{stringliteral}{"raw"} \textcolor{comment}{# No processing is done by the R extractor}
00371         names = re.split(\textcolor{stringliteral}{"\_"}, re.sub(\textcolor{stringliteral}{"\(\backslash\).tsv"}, \textcolor{stringliteral}{""}, fname))
00372         ll = len(names)
00373         \textcolor{keywordflow}{while} (\textcolor{keywordflow}{not} \textcolor{stringliteral}{"\_"}.join(names[-ll:]) \textcolor{keywordflow}{in} METHODS\_TYPE \textcolor{keywordflow}{and} ll >= 1):
00374             ll-=1
00375         \textcolor{keywordflow}{if} (ll >= 1):
00376             method = \textcolor{stringliteral}{"\_"}.join(names[-ll:])
00377             dname = \textcolor{stringliteral}{"\_"}.join(names[:-ll])
00378     \textcolor{keywordflow}{else}:
00379         \textcolor{keywordflow}{return} (re.sub(\textcolor{stringliteral}{"\(\backslash\).[^.]*$"}, \textcolor{stringliteral}{""}, fname), \textcolor{stringliteral}{"raw"}, \textcolor{stringliteral}{"unknown"})
00380     \textcolor{keywordflow}{return} (dname, processing, method)
00381 
00382 \textcolor{keyword}{def }pca\_cov(data):
00383     \textcolor{stringliteral}{"""}
00384 \textcolor{stringliteral}{    Run Principal Component Analysis using the covariance matrix and returns the 
      eigen-vectors sorted by decreasing eigenvalues}
00385 \textcolor{stringliteral}{    """}
00386     cov\_mat = np.cov(data)
00387 
00388     \textcolor{comment}{# Compute eigenvectors and eigenvalues, linalg returns eigenvectors of norm 1
      }
00389     eig\_val, eig\_vec = np.linalg.eig(cov\_mat)
00390     \textcolor{comment}{# Make a list of value-vector tuples to sort by eigenvalue}
00391     eig\_pairs = [(np.abs(eig\_val[ii]), eig\_vec[:,ii]) \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(eig\_val
      ))]
00392     eig\_pairs.sort()
00393     eig\_pairs.reverse()
00394 
00395     \textcolor{comment}{# Create the ordered eigenvectors matrix}
00396     eigen\_matrix = np.matrix([eig\_pairs[1] \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(eig\_pairs))])
00397     \textcolor{keywordflow}{return} (eigen\_matrix)
00398 
00399 \textcolor{keyword}{def }signif(x, n=3):
00400     \textcolor{stringliteral}{"""}
00401 \textcolor{stringliteral}{    Keep n significant numbers}
00402 \textcolor{stringliteral}{    """}
00403     \textcolor{keywordflow}{if} (x==0):
00404         \textcolor{keywordflow}{return} 0.
00405     \textcolor{keywordflow}{return}(round(x, -int(math.log10(np.abs(x)))+(n-1) ))
00406 
00407 \textcolor{keyword}{def }getBiotype(method, processing="raw"):
00408     \textcolor{stringliteral}{"""}
00409 \textcolor{stringliteral}{    Get the biotype from the method and the processing}
00410 \textcolor{stringliteral}{    """}
00411     \textcolor{keywordflow}{if} (processing \textcolor{keywordflow}{in} PROCESSINGS\_BIOTYPE):
00412         transform\_biotype = PROCESSINGS\_BIOTYPE[processing]
00413         \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{'->'}, transform\_biotype)):
00414             modes = transform\_biotype.split(\textcolor{stringliteral}{"->"})
00415             biotype = re.sub(modes[0], modes[1], TYPES\_BIOTYPE[METHODS\_TYPE[metho
      d.lower()]])
00416         \textcolor{keywordflow}{else}:
00417             biotype = PROCESSINGS\_BIOTYPE[processing]
00418     \textcolor{keywordflow}{else}:
00419         biotype = TYPES\_BIOTYPE[METHODS\_TYPE[method.lower()]]
00420     \textcolor{keywordflow}{return} biotype
00421 
\end{DoxyCode}
