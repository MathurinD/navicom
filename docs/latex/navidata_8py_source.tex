\hypertarget{navidata_8py_source}{
\subsection{navicom/navidata.py}
}

\begin{DoxyCode}
00001 \textcolor{comment}{################################################################################}
00002 \textcolor{comment}{# navidata.py}
00003 \textcolor{comment}{# By Mathurin Dorel}
00004 \textcolor{comment}{# Classes to store data an annotations in a convenient format for NaviCell export
      }
00005 \textcolor{comment}{################################################################################}
00006 
00007 \textcolor{keyword}{import} numpy \textcolor{keyword}{as} np
00008 \textcolor{keyword}{import} re
00009 \textcolor{keyword}{from} time \textcolor{keyword}{import} sleep
00010 \textcolor{keyword}{from} collections \textcolor{keyword}{import} OrderedDict \textcolor{keyword}{as} oDict
00011 \textcolor{keyword}{from} pprint \textcolor{keyword}{import} pprint
00012 \textcolor{keyword}{import} math
00013 \textcolor{keyword}{from} warnings \textcolor{keyword}{import} warn
00014 
00015 DEBUG\_NAVIDATA = \textcolor{keyword}{True}
00016 
00017 \textcolor{comment}{# Constants related to NaviCell}
00018 MAX\_GLYPHS = 5
00019 GLYPH\_TYPES = [\textcolor{stringliteral}{"color"}, \textcolor{stringliteral}{"size"}, \textcolor{stringliteral}{"shape"}]
00020 \textcolor{comment}{# Identify the categories of cBioportal data as (aliases, biotype)}
00021 TYPES\_SPEC = dict()
00022 TYPES\_SPEC[\textcolor{stringliteral}{"mRNA"}] = ([\textcolor{stringliteral}{"mrna"}, \textcolor{stringliteral}{"zscores"}, \textcolor{stringliteral}{"mrna\_median\_zscores"}, \textcolor{stringliteral}{"rna\_seq\_mrna\_me
      dian\_zscores"}, \textcolor{stringliteral}{"rna\_seq\_mrna"}, \textcolor{stringliteral}{"rna\_seq\_v2\_mrna"}, \textcolor{stringliteral}{"rna\_seq\_v2\_mrna\_median\_zscores
      "}, \textcolor{stringliteral}{"mrna\_U133"}, \textcolor{stringliteral}{"mrna\_U133\_zscores"}, \textcolor{stringliteral}{"mrna\_median"}, \textcolor{stringliteral}{"mrna\_zbynorm"}, \textcolor{stringliteral}{"mrna\_outlier
      s"}, \textcolor{stringliteral}{"rna\_seq\_rna"}, \textcolor{stringliteral}{"mrna\_znormal"}, \textcolor{stringliteral}{"mrna\_outlier"}, \textcolor{stringliteral}{"mrna\_merged\_median\_zscores"}],
       \textcolor{stringliteral}{"mRNA expression data"})
00023 TYPES\_SPEC[\textcolor{stringliteral}{"dCNA"}] = ([\textcolor{stringliteral}{"gistic"}, \textcolor{stringliteral}{"cna"}, \textcolor{stringliteral}{"cna\_rae"}, \textcolor{stringliteral}{"cna\_consensus"}, \textcolor{stringliteral}{"snp-fasst2"}]
      , \textcolor{stringliteral}{"Discrete Copy number data"})
00024 TYPES\_SPEC[\textcolor{stringliteral}{"cCNA"}] = ([\textcolor{stringliteral}{"log2cna"}], \textcolor{stringliteral}{"Continuous copy number data"})
00025 TYPES\_SPEC[\textcolor{stringliteral}{"methylation"}] = ([\textcolor{stringliteral}{"methylation"}, \textcolor{stringliteral}{"methylation\_hm27"}, \textcolor{stringliteral}{"methylation\_hm4
      50"}], \textcolor{stringliteral}{"mRNA expression data"})
00026 TYPES\_SPEC[\textcolor{stringliteral}{"protein"}] = ([\textcolor{stringliteral}{"RPPA\_protein\_level"}], \textcolor{stringliteral}{"protein level"})
00027 TYPES\_SPEC[\textcolor{stringliteral}{"miRNA"}] = ([\textcolor{stringliteral}{"mirna"}, \textcolor{stringliteral}{"mirna\_median\_zscores"}], \textcolor{stringliteral}{"miRNA expression data"
      })
00028 TYPES\_SPEC[\textcolor{stringliteral}{"mutations"}] = ([\textcolor{stringliteral}{"mutations"}], \textcolor{stringliteral}{"Mutations"})
00029 TYPES\_SPEC[\textcolor{stringliteral}{"unknown"}] = ([\textcolor{stringliteral}{"unknown"}], \textcolor{stringliteral}{"mRNA expression data"}) \textcolor{comment}{# If the type of da
      ta cannot be identified, consider continuous data by default}
00030 METHODS\_TYPE = dict()
00031 TYPES\_BIOTYPE = dict()
00032 \textcolor{keywordflow}{for} bt \textcolor{keywordflow}{in} TYPES\_SPEC:
00033     TYPES\_BIOTYPE[bt] = TYPES\_SPEC[bt][1]
00034     \textcolor{keywordflow}{for} cat \textcolor{keywordflow}{in} TYPES\_SPEC[bt][0]:
00035         METHODS\_TYPE[cat.lower()] = bt
00036 
00037 \textcolor{comment}{# Inform what the processing does to the biotype, if -> it changes only some biot
      ypes, if "something" it turns everything to something, see exportData and saveDat
      a}
00038 PROCESSINGS = [\textcolor{stringliteral}{"raw"}, \textcolor{stringliteral}{"moduleAverage"}, \textcolor{stringliteral}{"pcaComp"}, \textcolor{stringliteral}{"geoSmooth"}, \textcolor{stringliteral}{"distribution"}, \textcolor{stringliteral}{"c
      olors"}, \textcolor{stringliteral}{"mutationQuantification"}]
00039 PROCESSINGS\_BIOTYPE = \{\textcolor{stringliteral}{"moduleAverage"}:\textcolor{stringliteral}{"Discrete->Continuous"}, \textcolor{stringliteral}{"pcaComp"}:\textcolor{stringliteral}{"Color"},
       \textcolor{stringliteral}{"geoSmooth"}:\textcolor{stringliteral}{"Discrete->Continuous"}, \textcolor{stringliteral}{"mutationQuantification"}:\textcolor{stringliteral}{"Continuous copy nu
      mber data"}\}
00040 DISCRETE\_BIOTYPES = [\textcolor{stringliteral}{"Mutations"}, \textcolor{stringliteral}{"Discrete Copy number data"}]
00041 CONTINOUS\_BIOTYPES = [\textcolor{stringliteral}{"mRNA expression data"}, \textcolor{stringliteral}{"miRNA expression data"}, \textcolor{stringliteral}{"protein l
      evel"}, \textcolor{stringliteral}{"Continuous copy number data"}]
00042 
00043 \textcolor{keyword}{class }NaviData():
00044     \textcolor{stringliteral}{"""}
00045 \textcolor{stringliteral}{    Custom class to store the data and be able to access rows and columns by name
      .}
00046 \textcolor{stringliteral}{    Args :}
00047 \textcolor{stringliteral}{        data (list or array) : Values of the data to insert in the NaviData objec
      t. Must be convertible into a numpy array.}
00048 \textcolor{stringliteral}{        rows\_list (list) : names of the rows (samples names)}
00049 \textcolor{stringliteral}{        columns\_list (list) : names of the columns (genes names)}
00050 \textcolor{stringliteral}{        processing (str) : name of the computer processing applied to the data}
00051 \textcolor{stringliteral}{        method (str) : name of the experimental method used to get the original (
      "raw") data}
00052 \textcolor{stringliteral}{        dType (str) : "data" or "annotations", whether the NaviData object contai
      ns datas or annotations (Note : this should be left to default, this is used by N
      aviAnnotations to change some internal variables)}
\hypertarget{navidata_8py_source_l00053}{}\hyperlink{classnavicom_1_1navidata_1_1NaviData}{00053} \textcolor{stringliteral}{    """}
00054     \textcolor{keyword}{def }\_\_init\_\_(self, data, rows\_list, columns\_list, method="unknown", processin
      g="raw", dType="data"):
00055         \textcolor{keyword}{assert}(len(data) == len(rows\_list))
00056         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} data:
00057             \textcolor{keyword}{assert} len(line) == len(columns\_list), \textcolor{stringliteral}{"Incorrect length of line : "} 
      + str(line) + \textcolor{stringliteral}{", length = "} + str(len(line)) + \textcolor{stringliteral}{", expected "} + str(len(columns\_li
      st))
00058         \textcolor{comment}{# Informations on the data TODO}
00059         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ab3f30d76377459fe539f440df162ea59}{processing} = processing
00060         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ae8f909ed788b49a3c894251957e2f732}{method} = method
00061         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a863ac9998d2facd5f86bcea9b6256003}{biotype} = getBiotype(method, processing)
00062         \textcolor{comment}{# Initialise data and indexes}
00063         \textcolor{comment}{## Raw datatable as a numpy array}
\hypertarget{navidata_8py_source_l00064}{}\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{00064}         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data} = np.array(data)
00065         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows} = listToDictKeys(rows\_list)
00066         \textcolor{comment}{## Names of the rows}
\hypertarget{navidata_8py_source_l00067}{}\hyperlink{classnavicom_1_1navidata_1_1NaviData_aef041665583f2aa0845418d378ce3a40}{00067}         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aef041665583f2aa0845418d378ce3a40}{rows_names} = list(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}.keys())
00068         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns} = listToDictKeys(columns\_list)
00069         \textcolor{comment}{## Names of the columns}
\hypertarget{navidata_8py_source_l00070}{}\hyperlink{classnavicom_1_1navidata_1_1NaviData_aebce9bba220d01776cbd5a214d2d3013}{00070}         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aebce9bba220d01776cbd5a214d2d3013}{columns_names} = list(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}.keys())
00071         \textcolor{keywordflow}{if} (dType == \textcolor{stringliteral}{"annotations"}):
00072             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a080320f0715d257f61490985484e6d54}{inColumns} = \textcolor{stringliteral}{"annotations"}
00073             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ac8a49bcc3176408e8f52aa6daf56d1a3}{_annotations} = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}
00074             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aae9bfcdefa67abad304df58b7e4a62c8}{annotations_names} = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aebce9bba220d01776cbd5a214d2d3013}{columns_names}
00075             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a172b33d53b897135381a92b045f5576b}{inRows} = \textcolor{stringliteral}{"samples"}
00076             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a2bc5831bd388e7b3699cdd72caadffd9}{_samples} = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}
00077             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a5a0f30c9c3f70e500bf5948b9340f4ec}{samples_names} = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aef041665583f2aa0845418d378ce3a40}{rows_names}
00078         \textcolor{keywordflow}{elif} (dType == \textcolor{stringliteral}{"data"}):
00079             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a172b33d53b897135381a92b045f5576b}{inRows} = \textcolor{stringliteral}{"genes"}
00080             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a00867371e71c6eb2acf4f814f827736f}{_genes} = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}
00081             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a3a0751cab5bd70196652f8edbb31b257}{genes_names} = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aef041665583f2aa0845418d378ce3a40}{rows_names}
00082             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a080320f0715d257f61490985484e6d54}{inColumns} = \textcolor{stringliteral}{"samples"}
00083             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a2bc5831bd388e7b3699cdd72caadffd9}{_samples} = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}
00084             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a5a0f30c9c3f70e500bf5948b9340f4ec}{samples_names} = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aebce9bba220d01776cbd5a214d2d3013}{columns_names}
00085         \textcolor{keywordflow}{elif} (dType == \textcolor{stringliteral}{"old\_annotations"}):
00086             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a172b33d53b897135381a92b045f5576b}{inRows} = \textcolor{stringliteral}{"annotations"}
00087             self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a080320f0715d257f61490985484e6d54}{inColumns} = \textcolor{stringliteral}{"samples"}
00088         \textcolor{keywordflow}{else}:
00089             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"dType '"} + dType + \textcolor{stringliteral}{"' is not valid"})
00090         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} = dType
00091         \textcolor{comment}{# For the iterator}
00092         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a21c96bfd996af8dd4a12877aa54d4393}{itermode} = \textcolor{stringliteral}{""}
00093         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index} = 0
00094 
00095     \textcolor{keyword}{def }\_\_getitem\_\_(self, index):
00096         \textcolor{keywordflow}{if} (isinstance(index, int)):
00097             \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data}[index])
00098         \textcolor{keywordflow}{elif} (isinstance(index, str)):
00099             \textcolor{keywordflow}{if} (index \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}):
00100                 \textcolor{keywordflow}{return}( NaviSlice(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data}[self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}[index],:], self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}) 
      )
00101             \textcolor{keywordflow}{elif} (index \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}):
00102                 \textcolor{keywordflow}{return}( NaviSlice(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data}[:,self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}[index]], self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}) 
      )
00103             \textcolor{keywordflow}{else}:
00104                 \textcolor{keywordflow}{raise} IndexError(\textcolor{stringliteral}{"'"} + index + \textcolor{stringliteral}{"' is neither a gene or sample nam
      e"})
00105         \textcolor{keywordflow}{elif} (isinstance(index, list) \textcolor{keywordflow}{or} isinstance(index, tuple)):
00106             result = list()
00107             \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} index:
00108                 result.append(self[ii].data)
00109             result = np.array(result)
00110             \textcolor{keywordflow}{if} (index[0] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}):
00111                 \textcolor{keyword}{assert} np.all([idx \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows} \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} index]), \textcolor{stringliteral}{"Not all ind
      ex are gene names"}
00112                 genes = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}.copy()
00113                 \textcolor{keywordflow}{for} gene \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}:
00114                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} gene \textcolor{keywordflow}{in} index):
00115                         genes.pop(gene)
00116                 \textcolor{keywordflow}{return}( NaviData(result, genes, self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}) )
00117             \textcolor{keywordflow}{elif} (index[0] \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}):
00118                 \textcolor{keyword}{assert} np.all([idx \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns} \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} index]), \textcolor{stringliteral}{"Not all 
      index are sample names"}
00119                 samples = self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}.copy()
00120                 \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}:
00121                     \textcolor{keywordflow}{if}(\textcolor{keywordflow}{not} sample \textcolor{keywordflow}{in} index):
00122                         samples.pop(sample)
00123                 \textcolor{keywordflow}{return}( NaviData(result.transpose(), self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}, samples) )
00124 
00125     \textcolor{keyword}{def }\_\_iter\_\_(self, by="genes"):
00126         \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} by \textcolor{keywordflow}{in} [\textcolor{stringliteral}{"genes"}, \textcolor{stringliteral}{"samples"}]):
00127             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"'by' must be in ['genes', 'samples']"})
00128         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ac21c979a9421ac607778d907380475fc}{iter_mode} = by
00129         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index} = 0
00130         \textcolor{keywordflow}{return}(self)
00131 
00132     \textcolor{keyword}{def }\_\_next\_\_(self):
00133         \textcolor{keywordflow}{try}:
00134             \textcolor{keywordflow}{if} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ac21c979a9421ac607778d907380475fc}{iter_mode} == \textcolor{stringliteral}{"genes"}):
00135                 key = list(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows}.keys())[self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index}]
00136                 result = [key] + list(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data}[self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index},:])
00137             \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ac21c979a9421ac607778d907380475fc}{iter_mode} == \textcolor{stringliteral}{"samples"}):
00138                 key = list(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns}.keys())[self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index}]
00139                 result = [key] + list(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data}[:,self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index}])
00140         \textcolor{keywordflow}{except} IndexError:
00141             \textcolor{keywordflow}{raise} StopIteration
00142         self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_adb2e7ce6c9a691a186d91d4a8d49864a}{index} += 1
00143         \textcolor{keywordflow}{return}(result)
00144 
00145     \textcolor{keyword}{def }\_\_repr\_\_(self):
00146         rpr = \textcolor{stringliteral}{"NaviData array with "} + str(len(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a441bab93a769704074bba0c383b16986}{_rows})) + \textcolor{stringliteral}{" "} + self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a172b33d53b897135381a92b045f5576b}{inRows} +
       \textcolor{stringliteral}{" and "}
00147         rpr += str(len(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a1f3211f361097ad745c4a6c8f74887cf}{_columns})) + \textcolor{stringliteral}{" "} + self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a080320f0715d257f61490985484e6d54}{inColumns}
00148         \textcolor{keywordflow}{return}(rpr)
00149 
00150     \textcolor{keyword}{def }\_makeData(self, hugo\_map=""):
00151         \textcolor{stringliteral}{""" Builds a string suitable for NaviCell Web Service from a python matri
      x of gene/sample values or a NaviCom object.}
00152 \textcolor{stringliteral}{}
00153 \textcolor{stringliteral}{        Matrix format:}
00154 \textcolor{stringliteral}{        - first line is: GENE word followed by a tab separated list of sample nam
      es,}
00155 \textcolor{stringliteral}{        - each line begins with an gene name and must be followed by a tab separa
      ted list of gene/sample values.}
00156 \textcolor{stringliteral}{}
00157 \textcolor{stringliteral}{        Remove genes not present in hugo\_map if provided.}
00158 \textcolor{stringliteral}{        """}
00159 
00160         \textcolor{comment}{# Change header whether we have annotations or real self}
00161         \textcolor{keywordflow}{if} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} == \textcolor{stringliteral}{"annotations"}):
00162             ret = \textcolor{stringliteral}{"NAME\(\backslash\)t"} + \textcolor{stringliteral}{'\(\backslash\)t'}.join(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aae9bfcdefa67abad304df58b7e4a62c8}{annotations_names}) + \textcolor{stringliteral}{"\(\backslash\)n"}
00163             \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self:
00164                 ret += buildLine(line)
00165         \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} == \textcolor{stringliteral}{"data"}):
00166             ret = \textcolor{stringliteral}{"GENE\(\backslash\)t"} + \textcolor{stringliteral}{'\(\backslash\)t'}.join(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aebce9bba220d01776cbd5a214d2d3013}{columns_names}) + \textcolor{stringliteral}{"\(\backslash\)n"}
00167             \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self:
00168                 \textcolor{keywordflow}{if} (line[0] \textcolor{keywordflow}{in} hugo\_map \textcolor{keywordflow}{or} hugo\_map == \textcolor{stringliteral}{""}):
00169                     ret += buildLine(line)
00170         \textcolor{keywordflow}{else}:
00171             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Data type must be 'data' or 'annotations'"})
00172 
00173         \textcolor{keywordflow}{return}(\textcolor{stringliteral}{"@DATA\(\backslash\)n"} + ret)
00174 
00175     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navidata_1_1NaviData_a485fbc0ffff49b94f3736b2a0f8cb54e}{exportToNaviCell}(self, nv, biotype, dataName):
00176         \textcolor{stringliteral}{"""}
00177 \textcolor{stringliteral}{        Export data to a NaviCell map}
00178 \textcolor{stringliteral}{        }
00179 \textcolor{stringliteral}{        Args:}
00180 \textcolor{stringliteral}{            nv (NaviCell): a NaviCell communication object}
00181 \textcolor{stringliteral}{            biotype (str): biotype of the datatable in NaviCell}
00182 \textcolor{stringliteral}{            dataName (str): name of the datatable in NaviCell}
00183 \textcolor{stringliteral}{        """}
00184         nv.importDatatables(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a26d914914312eb5cceb517eb41128056}{_makeData}(nv.getHugoList()), dataName, biotype) 
      \textcolor{comment}{# Remove name once in self}
\hypertarget{navidata_8py_source_l00185}{}\hyperlink{classnavicom_1_1navidata_1_1NaviData_a485fbc0ffff49b94f3736b2a0f8cb54e}{00185}         \textcolor{comment}{#nv.importDatatables(self.\_makeData(nv.getHugoList()), dataName, self.bio
      type)}
00186 
00187     \textcolor{keyword}{def }\hyperlink{classnavicom_1_1navidata_1_1NaviData_a3dfc92056e5fc254e80607cef39234bf}{saveData}(self, baseName="", mode="w", fullName=False):
00188         \textcolor{stringliteral}{"""}
00189 \textcolor{stringliteral}{        Save the NaviData datas in a file that can be used in NaviCell, but can a
      lso be loaded as NaviData}
00190 \textcolor{stringliteral}{}
00191 \textcolor{stringliteral}{        Args:}
00192 \textcolor{stringliteral}{            baseName (str): first part of the name of the file where the data wil
      l be written. The processing and method are added to file name if fullName is Fal
      se.}
00193 \textcolor{stringliteral}{            mode (str): How the file should be opened ('a' or 'w')}
00194 \textcolor{stringliteral}{            fullName (bool): Whether the baseName should be used alone (True) or 
      with the extra information of the method and processing.}
00195 \textcolor{stringliteral}{        """}
00196         \textcolor{keyword}{assert} mode \textcolor{keywordflow}{in} [\textcolor{stringliteral}{"a"}, \textcolor{stringliteral}{"w"}], ValueError(\textcolor{stringliteral}{"Cannot open the file with this mod
      e to save data"})
\hypertarget{navidata_8py_source_l00197}{}\hyperlink{classnavicom_1_1navidata_1_1NaviData_a3dfc92056e5fc254e80607cef39234bf}{00197}         \textcolor{comment}{# Build filename}
00198         \textcolor{keywordflow}{if} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} == \textcolor{stringliteral}{"data"}):
00199             fname = baseName + \textcolor{stringliteral}{"["} + self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ab3f30d76377459fe539f440df162ea59}{processing} + \textcolor{stringliteral}{"]"} + \textcolor{stringliteral}{"["} + self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ae8f909ed788b49a3c894251957e2f732}{method} + 
      \textcolor{stringliteral}{"].ncd"}
00200         \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} == \textcolor{stringliteral}{"annotations"}):
00201             fname = baseName + \textcolor{stringliteral}{"\_annotations.nca"}
00202         \textcolor{comment}{# Save data}
00203         \textcolor{keywordflow}{if} (mode == \textcolor{stringliteral}{"a"} \textcolor{keywordflow}{or} fullName):
00204             fname = baseName
00205         with open(fname, mode) \textcolor{keyword}{as} ff:
00206             \textcolor{comment}{# First line, and first word in the }
00207             \textcolor{keywordflow}{if} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} == \textcolor{stringliteral}{"data"}):
00208                 \textcolor{keywordflow}{if} (mode == \textcolor{stringliteral}{"a"}):
00209                     ff.write(\textcolor{stringliteral}{"M "}+self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ae8f909ed788b49a3c894251957e2f732}{method}+\textcolor{stringliteral}{"\(\backslash\)t"}+self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ab3f30d76377459fe539f440df162ea59}{processing}+\textcolor{stringliteral}{"\(\backslash\)n"})
00210                 ff.write(\textcolor{stringliteral}{"GENE"})
00211             \textcolor{keywordflow}{elif} (self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} == \textcolor{stringliteral}{"annotations"} \textcolor{keywordflow}{or} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a89cf0727f26dba8aabb38271d85b169d}{dType} == \textcolor{stringliteral}{"old\_annots"}):
00212                 \textcolor{keywordflow}{if} (mode == \textcolor{stringliteral}{"a"}):
00213                     ff.write(\textcolor{stringliteral}{"ANNOTATIONS "}+self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ae8f909ed788b49a3c894251957e2f732}{method}+\textcolor{stringliteral}{"\(\backslash\)t"}+self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_ab3f30d76377459fe539f440df162ea59}{processing}+\textcolor{stringliteral}{"\(\backslash\)n"
      })
00214                 ff.write(\textcolor{stringliteral}{"NAME"})
00215             \textcolor{keywordflow}{for} nn \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aebce9bba220d01776cbd5a214d2d3013}{columns_names}:
00216                 ff.write(\textcolor{stringliteral}{"\(\backslash\)t"} + nn)
00217             ff.write(\textcolor{stringliteral}{"\(\backslash\)n"})
00218             \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aef041665583f2aa0845418d378ce3a40}{rows_names})):
00219                 ff.write(self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_aef041665583f2aa0845418d378ce3a40}{rows_names}[ii])
00220                 \textcolor{keywordflow}{for} sv \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviData_a25ff2e12663e590c22e82bb9a7863987}{data}[ii]:
00221                     ff.write(\textcolor{stringliteral}{"\(\backslash\)t"} + str(sv))
00222                 ff.write(\textcolor{stringliteral}{"\(\backslash\)n"})
00223             
00224 MAX\_GROUPS = 7
00225 \textcolor{keyword}{class }\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations}{NaviAnnotations}(\hyperlink{classnavicom_1_1navidata_1_1NaviData}{NaviData}):
00226     \textcolor{stringliteral}{"""}
00227 \textcolor{stringliteral}{    Enhance NaviData to contain annotations and associate annotations values with
       samples. Also reduce continuous data with to many levels to a limited number of 
      interval levels.}
00228 \textcolor{stringliteral}{    """}
00229 
\hypertarget{navidata_8py_source_l00230}{}\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations}{00230}     \textcolor{keyword}{def }\_\_init\_\_(self, data, rows\_list, columns\_list, dType="annotations"):
00231         NaviData.\_\_init\_\_(self, data, rows\_list, columns\_list, dType=dType)
00232         \textcolor{comment}{# Get the values for each annotations and which samples are associated to
       a value}
00233         self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a1c26e115cb2eabe4384cd2fa0c7f776f}{categoriesPerAnnotation} = dict()
00234         self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a44c09a52d1cf049204ae3149fa5a2b34}{_samplesPerCategory} = dict()
00235         modified\_data = list()
00236         modified\_annot = list()
00237         \textcolor{keywordflow}{for} annot \textcolor{keywordflow}{in} self.\_annotations:
00238             self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a1c26e115cb2eabe4384cd2fa0c7f776f}{categoriesPerAnnotation}[annot] = list()
00239             self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a44c09a52d1cf049204ae3149fa5a2b34}{_samplesPerCategory}[annot] = dict()
00240             reduced = \textcolor{keyword}{False}
00241             \textcolor{comment}{# Reduce the annotations set if they are continuous integers with too
       many values}
00242             \textcolor{keywordflow}{if} (len(np.unique(self[annot].data)) > MAX\_GROUPS):
00243                 \textcolor{keywordflow}{try}:
00244                     values = [float(value) \textcolor{keywordflow}{for} value \textcolor{keywordflow}{in} np.unique(self[annot].dat
      a)]
00245                     \textcolor{comment}{# Define the new annotations}
00246                     min\_value = min(values)
00247                     max\_value = max(values)
00248                     step = (max\_value-min\_value)/MAX\_GROUPS
00249                     new\_values = [signif(cat) \textcolor{keywordflow}{for} cat \textcolor{keywordflow}{in} np.arange(min\_value, max
      \_value+step/2, 1.01*step)]
00250                     new\_categories = [str(new\_values[icat])+\textcolor{stringliteral}{"<X<"}+str(new\_values[
      icat+1]) \textcolor{keywordflow}{for} icat \textcolor{keywordflow}{in} range(len(new\_values)-1)] + [\textcolor{stringliteral}{"NaN"}]
00251                     self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a1c26e115cb2eabe4384cd2fa0c7f776f}{categoriesPerAnnotation}[annot] = new\_categories
00252                     \textcolor{comment}{# Attribute the new annotations to samples}
00253                     modified\_data.append(self[annot].data.copy())
00254                     modified\_annot.append(annot)
00255                     \textcolor{keywordflow}{for} cat \textcolor{keywordflow}{in} new\_categories:
00256                         self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a44c09a52d1cf049204ae3149fa5a2b34}{_samplesPerCategory}[annot][cat] = list()
00257                     \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} self.\_samples:
00258                         annot\_value = float(self[annot][sample])
00259                         \textcolor{keywordflow}{if} (np.isnan(annot\_value)):
00260                             self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a44c09a52d1cf049204ae3149fa5a2b34}{_samplesPerCategory}[annot][\textcolor{stringliteral}{"NaN"}].append(sample)
      
00261                         \textcolor{keywordflow}{else}:
00262                             icat = 0
00263                             \textcolor{keywordflow}{while} (signif(annot\_value) >= new\_values[icat+1]):
00264                                 icat += 1
00265                             self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a44c09a52d1cf049204ae3149fa5a2b34}{_samplesPerCategory}[annot][new\_categories[icat]]
      .append(sample)
00266                             self[annot][sample] = new\_categories[icat]
00267                     reduced = \textcolor{keyword}{True}
00268                 \textcolor{keywordflow}{except} ValueError: 
00269                     reduced = \textcolor{keyword}{False}
00270             \textcolor{comment}{# Non numeric values or with few enough levels are not modified and s
      imply indexed}
00271             \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} reduced):
00272                 \textcolor{keywordflow}{for} sample \textcolor{keywordflow}{in} self.\_samples:
00273                     annot\_value = self[annot][sample]
00274                     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} annot\_value \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a1c26e115cb2eabe4384cd2fa0c7f776f}{categoriesPerAnnotation}[annot]):
00275                         self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a1c26e115cb2eabe4384cd2fa0c7f776f}{categoriesPerAnnotation}[annot].append(annot\_value)
00276                         self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a44c09a52d1cf049204ae3149fa5a2b34}{_samplesPerCategory}[annot][annot\_value] = [sample]
00277                     \textcolor{keywordflow}{else}:
00278                         self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_a44c09a52d1cf049204ae3149fa5a2b34}{_samplesPerCategory}[annot][annot\_value].append(sampl
      e)
00279 
00280         \textcolor{keywordflow}{if} (DEBUG\_NAVIDATA):
00281             \textcolor{keywordflow}{print}(\textcolor{stringliteral}{"Discretised annotations:"} + str(modified\_annot))
00282         \textcolor{keywordflow}{if} (len(modified\_annot) > 0):
00283             self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_ab053ca65505c1a9d72e2afb96ddcae9c}{old_annots} = NaviData(modified\_data, modified\_annot, self.\_rows,
       dType=\textcolor{stringliteral}{"old\_annotations"})
00284         \textcolor{keywordflow}{else}:
00285             self.\hyperlink{classnavicom_1_1navidata_1_1NaviAnnotations_ab053ca65505c1a9d72e2afb96ddcae9c}{old_annots} = list()
00286 
00287 \textcolor{keyword}{class }\hyperlink{classnavicom_1_1navidata_1_1NaviSlice}{NaviSlice}():
00288     \textcolor{stringliteral}{"""}
00289 \textcolor{stringliteral}{    A slice from a NaviData array}
00290 \textcolor{stringliteral}{    """}
00291     \textcolor{keyword}{def }\_\_init\_\_(self, data, index\_dict):
\hypertarget{navidata_8py_source_l00292}{}\hyperlink{classnavicom_1_1navidata_1_1NaviSlice}{00292}         \textcolor{keywordflow}{if} (isinstance(data, np.ndarray)):
00293             self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data} = data
00294         \textcolor{keywordflow}{elif} (isinstance(data, list)):
00295             self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data} = np.array(data)
00296         \textcolor{keywordflow}{else}:
00297             \textcolor{keywordflow}{raise} TypeError
00298         \textcolor{keywordflow}{if} (isinstance(index\_dict, dict)):
00299             self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids} = index\_dict
00300         \textcolor{keywordflow}{elif} (isinstance(index\_dict, list)):
00301             self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids} = listToDictKeys(index\_dict)
00302         \textcolor{keywordflow}{else}:
00303             \textcolor{keywordflow}{raise} TypeError
00304 
00305     \textcolor{keyword}{def }\_\_getitem\_\_(self, index):
00306         \textcolor{keywordflow}{if} (isinstance(index, int)):
00307             \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data}[index])
00308         \textcolor{keywordflow}{elif} (isinstance(index, str)):
00309             \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data}[self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids}[index]])
00310         \textcolor{keywordflow}{elif} (isinstance(index, list)):
00311             ret\_value = list()
00312             ret\_name = list()
00313             \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} index:
00314                 \textcolor{keywordflow}{if} (ii \textcolor{keywordflow}{in} self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids}):
00315                     ret\_name.append(ii)
00316                 \textcolor{keywordflow}{else}:
00317                     ret\_name.append(self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids}[ii])
00318                 ret\_value.append(self[ii])
00319             \textcolor{keywordflow}{return}(NaviSlice(ret\_value, ret\_name))
00320 
00321     \textcolor{keyword}{def }\_\_setitem\_\_(self, index, value):
00322         \textcolor{keywordflow}{if} (isinstance(index, int)):
00323             self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data}[index] = value
00324         \textcolor{keywordflow}{elif} (isinstance(index, str)):
00325             self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data}[self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids}[index]] = value
00326         \textcolor{keywordflow}{elif} (isinstance(index, list)):
00327             \textcolor{keywordflow}{if} (isinstance(value, list) \textcolor{keywordflow}{and} len(value) == len(index)):
00328                 \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(index)):
00329                     self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data}[index[ii]] = value[ii]
00330             \textcolor{keywordflow}{else}:
00331                 \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Length of indexes to change and new values diff
      er"})
00332 
00333     \textcolor{keyword}{def }\_\_iter\_\_(self):
00334         \textcolor{keywordflow}{return}(self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data}.\_\_iter\_\_())
00335 
00336     \textcolor{keyword}{def }\_\_repr\_\_(self):
00337         rpr = \textcolor{stringliteral}{"NaviData slice with "} + str(len(self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids})) + \textcolor{stringliteral}{" elements"}
00338         \textcolor{keywordflow}{return}(rpr)
00339 
00340     \textcolor{keyword}{def }\_\_add\_\_(self, nvslice):
00341         \textcolor{keyword}{assert}(isinstance(nvslice, NaviSlice))
00342         \textcolor{comment}{#assert(self.ids == nvslice.ids)}
00343         \textcolor{keywordflow}{return}(NaviSlice(self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_a21ac86b9fbcb4ffc952782983690af5f}{data} + nvslice.data, self.\hyperlink{classnavicom_1_1navidata_1_1NaviSlice_abc8769a0168ce54ee35624363deb0bcd}{ids}))
00344 
00345 \textcolor{keyword}{def }listToDictKeys(ilist):
00346     \textcolor{stringliteral}{"""}
00347 \textcolor{stringliteral}{    Convert a list to an ordered dict where each item is a key and gives the id o
      f the item in the list}
00348 \textcolor{stringliteral}{    """}
00349     \textcolor{keywordflow}{if} (isinstance(ilist, dict)):
00350         \textcolor{keywordflow}{return}(oDict(ilist))
00351     res = oDict()
00352     ii = 0
00353     \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} ilist:
00354         res[str(key)] = ii
00355         ii += 1
00356     \textcolor{keywordflow}{return}(res)
00357 
00358 \textcolor{keyword}{def }buildLine(line, sep="\(\backslash\)t"):
00359     ret = \textcolor{stringliteral}{""}
00360     \textcolor{keywordflow}{for} el \textcolor{keywordflow}{in} line:
00361         ret += str(el) + sep
00362     \textcolor{keywordflow}{return}(re.sub(\textcolor{stringliteral}{"NaN|nan"}, \textcolor{stringliteral}{"NA"}, ret[:-1]) + \textcolor{stringliteral}{"\(\backslash\)n"})
00363 
00364 \textcolor{keyword}{def }parseFilename(fname):
00365     \textcolor{stringliteral}{"""}
00366 \textcolor{stringliteral}{    Extract data name, method and processing from the name of the file}
00367 \textcolor{stringliteral}{    """}
00368     fname = re.sub(\textcolor{stringliteral}{".*/([^/]+)"}, \textcolor{stringliteral}{"\(\backslash\)\(\backslash\)1"}, fname)
00369     \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{"\(\backslash\).ncd$|\(\backslash\).nca$"}, fname)):
00370         names = re.split(\textcolor{stringliteral}{"\(\backslash\)["}, re.sub(\textcolor{stringliteral}{".ncd$|.nca$"}, \textcolor{stringliteral}{""}, fname))
00371         dname = re.sub(\textcolor{stringliteral}{"\_$"}, \textcolor{stringliteral}{""}, names[0])
00372         processing = re.sub(\textcolor{stringliteral}{"\(\backslash\)]|\_$|^\_"}, \textcolor{stringliteral}{""}, names[1])
00373         method = re.sub(\textcolor{stringliteral}{"\(\backslash\)[|\_$|^\_"}, \textcolor{stringliteral}{""}, names[2])
00374     \textcolor{keywordflow}{elif} (re.search(\textcolor{stringliteral}{"\(\backslash\).tsv$"}, fname)):
00375         processing = \textcolor{stringliteral}{"raw"} \textcolor{comment}{# No processing is done by the R extractor}
00376         names = re.split(\textcolor{stringliteral}{"\_"}, re.sub(\textcolor{stringliteral}{"\(\backslash\).tsv"}, \textcolor{stringliteral}{""}, fname))
00377         ll = len(names)
00378         \textcolor{keywordflow}{while} (\textcolor{keywordflow}{not} \textcolor{stringliteral}{"\_"}.join(names[-ll:]) \textcolor{keywordflow}{in} METHODS\_TYPE \textcolor{keywordflow}{and} ll >= 1):
00379             ll-=1
00380         \textcolor{keywordflow}{if} (ll >= 1):
00381             method = \textcolor{stringliteral}{"\_"}.join(names[-ll:])
00382             dname = \textcolor{stringliteral}{"\_"}.join(names[:-ll])
00383     \textcolor{keywordflow}{else}:
00384         \textcolor{keywordflow}{return} (re.sub(\textcolor{stringliteral}{"\(\backslash\).[^.]*$"}, \textcolor{stringliteral}{""}, fname), \textcolor{stringliteral}{"raw"}, \textcolor{stringliteral}{"unknown"})
00385     \textcolor{keywordflow}{return} (dname, processing, method)
00386 
00387 \textcolor{keyword}{def }pca\_cov(data):
00388     \textcolor{stringliteral}{"""}
00389 \textcolor{stringliteral}{    Run Principal Component Analysis using the covariance matrix and returns the 
      eigen-vectors sorted by decreasing eigenvalues}
00390 \textcolor{stringliteral}{    """}
00391     cov\_mat = np.cov(data)
00392 
00393     \textcolor{comment}{# Compute eigenvectors and eigenvalues, linalg returns eigenvectors of norm 1
      }
00394     eig\_val, eig\_vec = np.linalg.eig(cov\_mat)
00395     \textcolor{comment}{# Make a list of value-vector tuples to sort by eigenvalue}
00396     eig\_pairs = [(np.abs(eig\_val[ii]), eig\_vec[:,ii]) \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(eig\_val
      ))]
00397     eig\_pairs.sort()
00398     eig\_pairs.reverse()
00399 
00400     \textcolor{comment}{# Create the ordered eigenvectors matrix}
00401     eigen\_matrix = np.matrix([eig\_pairs[1] \textcolor{keywordflow}{for} ii \textcolor{keywordflow}{in} range(len(eig\_pairs))])
00402     \textcolor{keywordflow}{return} (eigen\_matrix)
00403 
00404 \textcolor{keyword}{def }signif(x, n=3):
00405     \textcolor{stringliteral}{"""}
00406 \textcolor{stringliteral}{    Keep n significant numbers}
00407 \textcolor{stringliteral}{    """}
00408     \textcolor{keywordflow}{if} (x==0):
00409         \textcolor{keywordflow}{return} 0.
00410     \textcolor{keywordflow}{return}(round(x, -int(math.log10(np.abs(x)))+(n-1) ))
00411 
00412 \textcolor{keyword}{def }getBiotype(method, processing="raw"):
00413     \textcolor{stringliteral}{"""}
00414 \textcolor{stringliteral}{    Get the biotype from the method and the processing}
00415 \textcolor{stringliteral}{    """}
00416     \textcolor{keywordflow}{if} (processing \textcolor{keywordflow}{in} PROCESSINGS\_BIOTYPE):
00417         transform\_biotype = PROCESSINGS\_BIOTYPE[processing]
00418         \textcolor{keywordflow}{if} (re.search(\textcolor{stringliteral}{'->'}, transform\_biotype)):
00419             modes = transform\_biotype.split(\textcolor{stringliteral}{"->"})
00420             biotype = re.sub(modes[0], modes[1], TYPES\_BIOTYPE[METHODS\_TYPE[metho
      d.lower()]])
00421         \textcolor{keywordflow}{else}:
00422             biotype = PROCESSINGS\_BIOTYPE[processing]
00423     \textcolor{keywordflow}{elif} (method == \textcolor{stringliteral}{"uniform"}):
00424         biotype = \textcolor{stringliteral}{"Discrete Copy number data"} \textcolor{comment}{# TODO Continuous is better for gro
      uping but posses problems with glyphs}
00425     \textcolor{keywordflow}{else}:
00426         biotype = TYPES\_BIOTYPE[METHODS\_TYPE[method.lower()]]
00427     \textcolor{keywordflow}{return} biotype
00428 
\end{DoxyCode}
